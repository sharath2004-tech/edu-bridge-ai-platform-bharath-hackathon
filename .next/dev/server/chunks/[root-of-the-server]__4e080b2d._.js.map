{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///E:/projects/edu-bridge-ai-platform/lib/mongodb.ts"],"sourcesContent":["import mongoose from 'mongoose';\n\nconst MONGODB_URI = process.env.MONGODB_URI as string;\n\nif (!MONGODB_URI) {\n  throw new Error(\n    'Please define the MONGODB_URI environment variable inside .env.local'\n  );\n}\n\n/**\n * Global is used here to maintain a cached connection across hot reloads\n * in development. This prevents connections growing exponentially\n * during API Route usage.\n */\ninterface MongooseCache {\n  conn: typeof mongoose | null;\n  promise: Promise<typeof mongoose> | null;\n}\n\ndeclare global {\n  var mongoose: MongooseCache | undefined;\n}\n\nlet cached: MongooseCache = global.mongoose || { conn: null, promise: null };\n\nif (!global.mongoose) {\n  global.mongoose = cached;\n}\n\nasync function connectDB(): Promise<typeof mongoose> {\n  if (cached.conn) {\n    return cached.conn;\n  }\n\n  if (!cached.promise) {\n    const opts = {\n      bufferCommands: false,\n      serverSelectionTimeoutMS: 30000,\n      socketTimeoutMS: 75000,\n      connectTimeoutMS: 30000,\n      maxPoolSize: 10,\n      minPoolSize: 1,\n      retryWrites: true,\n      retryReads: true,\n      // Disable TLS validation to fix Node.js 22 SSL error\n      tls: true,\n      tlsAllowInvalidCertificates: true,\n      tlsAllowInvalidHostnames: true,\n    };\n\n    cached.promise = mongoose.connect(MONGODB_URI, opts).then((mongoose) => {\n      console.log('✅ MongoDB connected successfully');\n      return mongoose;\n    }).catch((err) => {\n      console.error('❌ MongoDB connection error:', err.message);\n      cached.promise = null;\n      throw err;\n    });\n  }\n\n  try {\n    cached.conn = await cached.promise;\n  } catch (e) {\n    cached.promise = null;\n    console.error('❌ MongoDB connection error:', e);\n    throw e;\n  }\n\n  return cached.conn;\n}\n\nexport default connectDB;\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,cAAc,QAAQ,GAAG,CAAC,WAAW;AAE3C,IAAI,CAAC,aAAa;IAChB,MAAM,IAAI,MACR;AAEJ;AAgBA,IAAI,SAAwB,OAAO,QAAQ,IAAI;IAAE,MAAM;IAAM,SAAS;AAAK;AAE3E,IAAI,CAAC,OAAO,QAAQ,EAAE;IACpB,OAAO,QAAQ,GAAG;AACpB;AAEA,eAAe;IACb,IAAI,OAAO,IAAI,EAAE;QACf,OAAO,OAAO,IAAI;IACpB;IAEA,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,MAAM,OAAO;YACX,gBAAgB;YAChB,0BAA0B;YAC1B,iBAAiB;YACjB,kBAAkB;YAClB,aAAa;YACb,aAAa;YACb,aAAa;YACb,YAAY;YACZ,qDAAqD;YACrD,KAAK;YACL,6BAA6B;YAC7B,0BAA0B;QAC5B;QAEA,OAAO,OAAO,GAAG,oHAAQ,CAAC,OAAO,CAAC,aAAa,MAAM,IAAI,CAAC,CAAC;YACzD,QAAQ,GAAG,CAAC;YACZ,OAAO;QACT,GAAG,KAAK,CAAC,CAAC;YACR,QAAQ,KAAK,CAAC,+BAA+B,IAAI,OAAO;YACxD,OAAO,OAAO,GAAG;YACjB,MAAM;QACR;IACF;IAEA,IAAI;QACF,OAAO,IAAI,GAAG,MAAM,OAAO,OAAO;IACpC,EAAE,OAAO,GAAG;QACV,OAAO,OAAO,GAAG;QACjB,QAAQ,KAAK,CAAC,+BAA+B;QAC7C,MAAM;IACR;IAEA,OAAO,OAAO,IAAI;AACpB;uCAEe"}},
    {"offset": {"line": 105, "column": 0}, "map": {"version":3,"sources":["file:///E:/projects/edu-bridge-ai-platform/lib/models/Class.ts"],"sourcesContent":["import mongoose, { Document, Schema } from 'mongoose';\n\nexport interface IClass extends Document {\n  _id: string;\n  schoolId: mongoose.Types.ObjectId;\n  className: string; // e.g., \"LKG\", \"1st\", \"2nd\", \"10th\"\n  section: string; // e.g., \"A\", \"B\", \"C\"\n  classTeacherId?: mongoose.Types.ObjectId;\n  academicYear?: string; // e.g., \"2024-2025\"\n  strength?: number; // Total students in this class\n  createdAt: Date;\n  updatedAt: Date;\n}\n\nconst ClassSchema = new Schema<IClass>(\n  {\n    schoolId: {\n      type: Schema.Types.ObjectId,\n      ref: 'School',\n      required: [true, 'School ID is required'],\n      index: true,\n    },\n    className: {\n      type: String,\n      required: [true, 'Class name is required'],\n      trim: true,\n      // LKG, UKG, 1st, 2nd, 3rd, 4th, 5th, 6th, 7th, 8th, 9th, 10th, 11th, 12th\n    },\n    section: {\n      type: String,\n      required: [true, 'Section is required'],\n      trim: true,\n      uppercase: true,\n      // A, B, C, D, E, etc.\n    },\n    classTeacherId: {\n      type: Schema.Types.ObjectId,\n      ref: 'User',\n      index: true,\n    },\n    academicYear: {\n      type: String,\n      trim: true,\n    },\n    strength: {\n      type: Number,\n      default: 0,\n      min: 0,\n    },\n  },\n  {\n    timestamps: true,\n  }\n);\n\n// Compound index to ensure unique class-section per school\nClassSchema.index({ schoolId: 1, className: 1, section: 1 }, { unique: true });\n\n// Index for querying by class teacher\nClassSchema.index({ classTeacherId: 1 });\n\nconst Class = mongoose.models.Class || mongoose.model<IClass>('Class', ClassSchema);\n\nexport default Class;\n"],"names":[],"mappings":";;;;AAAA;;AAcA,MAAM,cAAc,IAAI,mHAAM,CAC5B;IACE,UAAU;QACR,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;YAAC;YAAM;SAAwB;QACzC,OAAO;IACT;IACA,WAAW;QACT,MAAM;QACN,UAAU;YAAC;YAAM;SAAyB;QAC1C,MAAM;IAER;IACA,SAAS;QACP,MAAM;QACN,UAAU;YAAC;YAAM;SAAsB;QACvC,MAAM;QACN,WAAW;IAEb;IACA,gBAAgB;QACd,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,OAAO;IACT;IACA,cAAc;QACZ,MAAM;QACN,MAAM;IACR;IACA,UAAU;QACR,MAAM;QACN,SAAS;QACT,KAAK;IACP;AACF,GACA;IACE,YAAY;AACd;AAGF,2DAA2D;AAC3D,YAAY,KAAK,CAAC;IAAE,UAAU;IAAG,WAAW;IAAG,SAAS;AAAE,GAAG;IAAE,QAAQ;AAAK;AAE5E,sCAAsC;AACtC,YAAY,KAAK,CAAC;IAAE,gBAAgB;AAAE;AAEtC,MAAM,QAAQ,oHAAQ,CAAC,MAAM,CAAC,KAAK,IAAI,oHAAQ,CAAC,KAAK,CAAS,SAAS;uCAExD"}},
    {"offset": {"line": 173, "column": 0}, "map": {"version":3,"sources":["file:///E:/projects/edu-bridge-ai-platform/lib/models/Subject.ts"],"sourcesContent":["import mongoose, { Document, Schema } from 'mongoose';\n\nexport interface ISubject extends Document {\n  _id: string;\n  schoolId: mongoose.Types.ObjectId;\n  classId: mongoose.Types.ObjectId;\n  subjectName: string;\n  subjectCode?: string; // Optional subject code like \"MAT101\"\n  teacherId?: mongoose.Types.ObjectId;\n  description?: string;\n  totalLessons?: number;\n  isActive: boolean;\n  createdAt: Date;\n  updatedAt: Date;\n}\n\nconst SubjectSchema = new Schema<ISubject>(\n  {\n    schoolId: {\n      type: Schema.Types.ObjectId,\n      ref: 'School',\n      required: [true, 'School ID is required'],\n      index: true,\n    },\n    classId: {\n      type: Schema.Types.ObjectId,\n      ref: 'Class',\n      required: [true, 'Class ID is required'],\n      index: true,\n    },\n    subjectName: {\n      type: String,\n      required: [true, 'Subject name is required'],\n      trim: true,\n    },\n    subjectCode: {\n      type: String,\n      trim: true,\n      uppercase: true,\n    },\n    teacherId: {\n      type: Schema.Types.ObjectId,\n      ref: 'User',\n      index: true,\n    },\n    description: {\n      type: String,\n      trim: true,\n      maxlength: 500,\n    },\n    totalLessons: {\n      type: Number,\n      min: 0,\n    },\n    isActive: {\n      type: Boolean,\n      default: true,\n    },\n  },\n  {\n    timestamps: true,\n  }\n);\n\n// Compound index to ensure unique subject per class in a school\nSubjectSchema.index({ schoolId: 1, classId: 1, subjectName: 1 }, { unique: true });\n\n// Index for querying by teacher\nSubjectSchema.index({ teacherId: 1 });\n\nconst Subject = mongoose.models.Subject || mongoose.model<ISubject>('Subject', SubjectSchema);\n\nexport default Subject;\n"],"names":[],"mappings":";;;;AAAA;;AAgBA,MAAM,gBAAgB,IAAI,mHAAM,CAC9B;IACE,UAAU;QACR,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;YAAC;YAAM;SAAwB;QACzC,OAAO;IACT;IACA,SAAS;QACP,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;YAAC;YAAM;SAAuB;QACxC,OAAO;IACT;IACA,aAAa;QACX,MAAM;QACN,UAAU;YAAC;YAAM;SAA2B;QAC5C,MAAM;IACR;IACA,aAAa;QACX,MAAM;QACN,MAAM;QACN,WAAW;IACb;IACA,WAAW;QACT,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,OAAO;IACT;IACA,aAAa;QACX,MAAM;QACN,MAAM;QACN,WAAW;IACb;IACA,cAAc;QACZ,MAAM;QACN,KAAK;IACP;IACA,UAAU;QACR,MAAM;QACN,SAAS;IACX;AACF,GACA;IACE,YAAY;AACd;AAGF,gEAAgE;AAChE,cAAc,KAAK,CAAC;IAAE,UAAU;IAAG,SAAS;IAAG,aAAa;AAAE,GAAG;IAAE,QAAQ;AAAK;AAEhF,gCAAgC;AAChC,cAAc,KAAK,CAAC;IAAE,WAAW;AAAE;AAEnC,MAAM,UAAU,oHAAQ,CAAC,MAAM,CAAC,OAAO,IAAI,oHAAQ,CAAC,KAAK,CAAW,WAAW;uCAEhE"}},
    {"offset": {"line": 256, "column": 0}, "map": {"version":3,"sources":["file:///E:/projects/edu-bridge-ai-platform/app/api/super-admin/classes/route.ts"],"sourcesContent":["import connectDB from '@/lib/mongodb'\nimport Class from '@/lib/models/Class'\nimport Subject from '@/lib/models/Subject'\nimport { NextRequest, NextResponse } from 'next/server'\n\nexport async function GET(request: NextRequest) {\n  try {\n    await connectDB()\n\n    const { searchParams } = new URL(request.url)\n    const schoolId = searchParams.get('schoolId')\n\n    const query: any = {}\n    if (schoolId && schoolId !== 'all') {\n      query.schoolId = schoolId\n    }\n\n    const classes = await Class.find(query)\n      .populate('schoolId', 'name code')\n      .populate('classTeacherId', 'name email')\n      .select('-__v')\n      .sort({ className: 1, section: 1 })\n      .lean()\n\n    // Get subject count for each class\n    const classesWithSubjects = await Promise.all(\n      classes.map(async (classItem) => {\n        const subjectCount = await Subject.countDocuments({ classId: classItem._id })\n        return {\n          ...classItem,\n          subjectCount\n        }\n      })\n    )\n\n    return NextResponse.json({\n      success: true,\n      classes: classesWithSubjects,\n      count: classesWithSubjects.length\n    })\n  } catch (error: any) {\n    console.error('Error fetching classes:', error)\n    return NextResponse.json(\n      { success: false, error: error.message },\n      { status: 500 }\n    )\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;AAEO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,IAAA,2HAAS;QAEf,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,MAAM,WAAW,aAAa,GAAG,CAAC;QAElC,MAAM,QAAa,CAAC;QACpB,IAAI,YAAY,aAAa,OAAO;YAClC,MAAM,QAAQ,GAAG;QACnB;QAEA,MAAM,UAAU,MAAM,mIAAK,CAAC,IAAI,CAAC,OAC9B,QAAQ,CAAC,YAAY,aACrB,QAAQ,CAAC,kBAAkB,cAC3B,MAAM,CAAC,QACP,IAAI,CAAC;YAAE,WAAW;YAAG,SAAS;QAAE,GAChC,IAAI;QAEP,mCAAmC;QACnC,MAAM,sBAAsB,MAAM,QAAQ,GAAG,CAC3C,QAAQ,GAAG,CAAC,OAAO;YACjB,MAAM,eAAe,MAAM,qIAAO,CAAC,cAAc,CAAC;gBAAE,SAAS,UAAU,GAAG;YAAC;YAC3E,OAAO;gBACL,GAAG,SAAS;gBACZ;YACF;QACF;QAGF,OAAO,+QAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,SAAS;YACT,OAAO,oBAAoB,MAAM;QACnC;IACF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,2BAA2B;QACzC,OAAO,+QAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAO,OAAO,MAAM,OAAO;QAAC,GACvC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}