{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///E:/projects/edu-bridge-ai-platform/app/api/chatbot/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { authenticateAndAuthorize } from '@/lib/middleware/auth';\n\n// Simple AI chatbot for educational assistance\n// Accessible to all authenticated users from any school\nexport async function POST(req: NextRequest) {\n  try {\n    // Authenticate user - all roles can access chatbot\n    const authResult = await authenticateAndAuthorize(req, [\n      'super-admin',\n      'principal',\n      'teacher',\n      'student',\n    ]);\n\n    if (!authResult.success) {\n      return NextResponse.json(\n        { error: authResult.error },\n        { status: authResult.status }\n      );\n    }\n\n    const user = authResult.user!;\n    const { message, conversationHistory } = await req.json();\n\n    if (!message || message.trim().length === 0) {\n      return NextResponse.json(\n        { error: 'Message is required' },\n        { status: 400 }\n      );\n    }\n\n    // Build context based on user role\n    const roleContext = getRoleContext(user.role, user.name);\n\n    // Simple rule-based responses (can be enhanced with AI API later)\n    const response = generateResponse(message, roleContext, conversationHistory);\n\n    return NextResponse.json({\n      success: true,\n      response,\n      timestamp: new Date().toISOString(),\n    });\n  } catch (error: any) {\n    console.error('Chatbot error:', error);\n    return NextResponse.json(\n      { error: 'Failed to process chatbot request' },\n      { status: 500 }\n    );\n  }\n}\n\nfunction getRoleContext(role: string, name: string): string {\n  const contexts: Record<string, string> = {\n    student: `You are an educational assistant helping ${name}, a student. Provide clear explanations, study tips, and guidance on coursework.`,\n    teacher: `You are an educational assistant helping ${name}, a teacher. Provide teaching strategies, classroom management tips, and content creation guidance.`,\n    principal: `You are an administrative assistant helping ${name}, a principal. Provide insights on school management, enrollment, and educational leadership.`,\n    'super-admin': `You are an administrative assistant helping ${name}, a super admin. Provide platform management and multi-school oversight guidance.`,\n  };\n\n  return contexts[role] || contexts['student'];\n}\n\nfunction generateResponse(\n  message: string,\n  context: string,\n  history?: any[]\n): string {\n  const lowerMessage = message.toLowerCase();\n\n  // Educational keywords\n  if (\n    lowerMessage.includes('course') ||\n    lowerMessage.includes('learn') ||\n    lowerMessage.includes('study')\n  ) {\n    return \"I can help you with your courses! You can browse available courses in the Courses section. Each course includes lessons, quizzes, and progress tracking. Would you like tips on effective studying?\";\n  }\n\n  if (\n    lowerMessage.includes('quiz') ||\n    lowerMessage.includes('test') ||\n    lowerMessage.includes('exam')\n  ) {\n    return \"For quizzes and tests, I recommend: 1) Review course materials regularly, 2) Practice with sample questions, 3) Take notes during lessons, 4) Don't rush - read questions carefully. You can find quizzes in your enrolled courses. Need specific study strategies?\";\n  }\n\n  if (\n    lowerMessage.includes('assignment') ||\n    lowerMessage.includes('homework')\n  ) {\n    return \"For assignments, make sure to: 1) Read the instructions carefully, 2) Start early to avoid last-minute stress, 3) Break large assignments into smaller tasks, 4) Ask your teacher if you need clarification. Check your dashboard for pending assignments.\";\n  }\n\n  if (\n    lowerMessage.includes('grade') ||\n    lowerMessage.includes('score') ||\n    lowerMessage.includes('performance')\n  ) {\n    return \"You can view your grades and performance analytics in the Analytics section of your dashboard. It shows your progress, quiz scores, and course completion rates. Focus on consistent learning rather than just grades!\";\n  }\n\n  if (\n    lowerMessage.includes('teacher') ||\n    lowerMessage.includes('instructor')\n  ) {\n    return \"You can view your teachers and their contact information in the appropriate section. If you need help with a specific subject, reach out to your subject teacher through the platform's messaging system.\";\n  }\n\n  if (\n    lowerMessage.includes('enroll') ||\n    lowerMessage.includes('register') ||\n    lowerMessage.includes('join')\n  ) {\n    return \"To enroll in courses, browse the Courses section and click on any course you're interested in. You'll see course details, lessons, and an enrollment option. Your principal can also enroll you in required courses.\";\n  }\n\n  if (\n    lowerMessage.includes('help') ||\n    lowerMessage.includes('how to') ||\n    lowerMessage.includes('guide')\n  ) {\n    return \"I'm here to help! I can assist with: \\n- Course information and enrollment\\n- Study tips and exam preparation\\n- Understanding assignments and quizzes\\n- Navigating the platform\\n- Performance tracking\\n\\nWhat specific topic would you like help with?\";\n  }\n\n  if (\n    lowerMessage.includes('analytics') ||\n    lowerMessage.includes('progress') ||\n    lowerMessage.includes('dashboard')\n  ) {\n    return \"Your dashboard provides a comprehensive view of your learning journey! Check the Analytics section to see: course completion rates, quiz performance, study time, and areas for improvement. Regular review of your analytics helps you stay on track.\";\n  }\n\n  if (\n    lowerMessage.includes('community') ||\n    lowerMessage.includes('forum') ||\n    lowerMessage.includes('discussion')\n  ) {\n    return \"The Community section is a great place to connect with peers, ask questions, share knowledge, and participate in discussions. Collaborative learning enhances understanding - don't hesitate to engage!\";\n  }\n\n  if (lowerMessage.includes('thank') || lowerMessage.includes('thanks')) {\n    return \"You're welcome! I'm always here to help with your educational journey. Feel free to ask me anything about courses, studying, or using the platform. Happy learning! üìö\";\n  }\n\n  // Default response\n  return `Hello! I'm your educational assistant. I can help you with:\n\nüìö **Courses** - Browse, enroll, and learn\nüìù **Assignments & Quizzes** - Study tips and strategies  \nüìä **Analytics** - Track your progress\nüë• **Community** - Connect with peers\n‚öôÔ∏è **Platform Navigation** - Find your way around\n\nWhat would you like to know more about?`;\n}\n"],"names":[],"mappings":"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"}}]
}