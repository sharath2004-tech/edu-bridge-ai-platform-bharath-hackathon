{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///E:/projects/edu-bridge-ai-platform/lib/mongodb.ts"],"sourcesContent":["import mongoose from 'mongoose';\n\nconst MONGODB_URI = process.env.MONGODB_URI as string;\n\nif (!MONGODB_URI) {\n  throw new Error(\n    'Please define the MONGODB_URI environment variable inside .env.local'\n  );\n}\n\n/**\n * Global is used here to maintain a cached connection across hot reloads\n * in development. This prevents connections growing exponentially\n * during API Route usage.\n */\ninterface MongooseCache {\n  conn: typeof mongoose | null;\n  promise: Promise<typeof mongoose> | null;\n}\n\ndeclare global {\n  var mongoose: MongooseCache | undefined;\n}\n\nlet cached: MongooseCache = global.mongoose || { conn: null, promise: null };\n\nif (!global.mongoose) {\n  global.mongoose = cached;\n}\n\nasync function connectDB(): Promise<typeof mongoose> {\n  if (cached.conn) {\n    return cached.conn;\n  }\n\n  if (!cached.promise) {\n    const opts = {\n      bufferCommands: false,\n      serverSelectionTimeoutMS: 30000,\n      socketTimeoutMS: 75000,\n      connectTimeoutMS: 30000,\n      maxPoolSize: 10,\n      minPoolSize: 1,\n      retryWrites: true,\n      retryReads: true,\n      // Disable TLS validation to fix Node.js 22 SSL error\n      tls: true,\n      tlsAllowInvalidCertificates: true,\n      tlsAllowInvalidHostnames: true,\n    };\n\n    cached.promise = mongoose.connect(MONGODB_URI, opts).then((mongoose) => {\n      console.log('✅ MongoDB connected successfully');\n      return mongoose;\n    }).catch((err) => {\n      console.error('❌ MongoDB connection error:', err.message);\n      cached.promise = null;\n      throw err;\n    });\n  }\n\n  try {\n    cached.conn = await cached.promise;\n  } catch (e) {\n    cached.promise = null;\n    console.error('❌ MongoDB connection error:', e);\n    throw e;\n  }\n\n  return cached.conn;\n}\n\nexport default connectDB;\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,cAAc,QAAQ,GAAG,CAAC,WAAW;AAE3C,IAAI,CAAC,aAAa;IAChB,MAAM,IAAI,MACR;AAEJ;AAgBA,IAAI,SAAwB,OAAO,QAAQ,IAAI;IAAE,MAAM;IAAM,SAAS;AAAK;AAE3E,IAAI,CAAC,OAAO,QAAQ,EAAE;IACpB,OAAO,QAAQ,GAAG;AACpB;AAEA,eAAe;IACb,IAAI,OAAO,IAAI,EAAE;QACf,OAAO,OAAO,IAAI;IACpB;IAEA,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,MAAM,OAAO;YACX,gBAAgB;YAChB,0BAA0B;YAC1B,iBAAiB;YACjB,kBAAkB;YAClB,aAAa;YACb,aAAa;YACb,aAAa;YACb,YAAY;YACZ,qDAAqD;YACrD,KAAK;YACL,6BAA6B;YAC7B,0BAA0B;QAC5B;QAEA,OAAO,OAAO,GAAG,oHAAQ,CAAC,OAAO,CAAC,aAAa,MAAM,IAAI,CAAC,CAAC;YACzD,QAAQ,GAAG,CAAC;YACZ,OAAO;QACT,GAAG,KAAK,CAAC,CAAC;YACR,QAAQ,KAAK,CAAC,+BAA+B,IAAI,OAAO;YACxD,OAAO,OAAO,GAAG;YACjB,MAAM;QACR;IACF;IAEA,IAAI;QACF,OAAO,IAAI,GAAG,MAAM,OAAO,OAAO;IACpC,EAAE,OAAO,GAAG;QACV,OAAO,OAAO,GAAG;QACjB,QAAQ,KAAK,CAAC,+BAA+B;QAC7C,MAAM;IACR;IAEA,OAAO,OAAO,IAAI;AACpB;uCAEe"}},
    {"offset": {"line": 111, "column": 0}, "map": {"version":3,"sources":["file:///E:/projects/edu-bridge-ai-platform/lib/auth.ts"],"sourcesContent":["import { cookies } from 'next/headers';\n\nexport type Session = { id: string; role: 'student'|'teacher'|'admin'; name: string; email: string }\n\nexport async function getSession(): Promise<Session | null> {\n  const cookieStore = await cookies()\n  const c = cookieStore.get('edubridge_session')?.value\n  if (!c) return null\n  try {\n    return JSON.parse(c)\n  } catch {\n    return null\n  }\n}\n\nexport async function requireRole(role: Session['role']): Promise<Session | null> {\n  const s = await getSession()\n  if (!s || s.role !== role) {\n    return null\n  }\n  return s\n}\n"],"names":[],"mappings":";;;;;;AAAA;;AAIO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,2QAAO;IACjC,MAAM,IAAI,YAAY,GAAG,CAAC,sBAAsB;IAChD,IAAI,CAAC,GAAG,OAAO;IACf,IAAI;QACF,OAAO,KAAK,KAAK,CAAC;IACpB,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAEO,eAAe,YAAY,IAAqB;IACrD,MAAM,IAAI,MAAM;IAChB,IAAI,CAAC,KAAK,EAAE,IAAI,KAAK,MAAM;QACzB,OAAO;IACT;IACA,OAAO;AACT"}},
    {"offset": {"line": 140, "column": 0}, "map": {"version":3,"sources":["file:///E:/projects/edu-bridge-ai-platform/lib/models/Mark.ts"],"sourcesContent":["import mongoose, { Document, Schema } from 'mongoose';\n\nexport interface IMark extends Document {\n  studentId: mongoose.Types.ObjectId;\n  schoolId: mongoose.Types.ObjectId;\n  examId: mongoose.Types.ObjectId;\n  subjectId: mongoose.Types.ObjectId;\n  marksScored: number;\n  totalMarks?: number;\n  percentage?: number;\n  grade?: string;\n  remarks?: string;\n  markedBy?: mongoose.Types.ObjectId; // Teacher who entered marks\n  createdAt: Date;\n  updatedAt: Date;\n}\n\nconst MarkSchema = new Schema<IMark>(\n  {\n    studentId: {\n      type: Schema.Types.ObjectId,\n      ref: 'User',\n      required: [true, 'Student ID is required'],\n      index: true,\n    },\n    schoolId: {\n      type: Schema.Types.ObjectId,\n      ref: 'School',\n      required: [true, 'School ID is required'],\n      index: true,\n    },\n    examId: {\n      type: Schema.Types.ObjectId,\n      ref: 'Exam',\n      required: [true, 'Exam ID is required'],\n      index: true,\n    },\n    subjectId: {\n      type: Schema.Types.ObjectId,\n      ref: 'Subject',\n      required: [true, 'Subject ID is required'],\n      index: true,\n    },\n    marksScored: {\n      type: Number,\n      required: [true, 'Marks scored is required'],\n      min: 0,\n    },\n    totalMarks: {\n      type: Number,\n      min: 1,\n    },\n    percentage: {\n      type: Number,\n      min: 0,\n      max: 100,\n    },\n    grade: {\n      type: String,\n      trim: true,\n    },\n    remarks: {\n      type: String,\n      trim: true,\n      maxlength: 500,\n    },\n    markedBy: {\n      type: Schema.Types.ObjectId,\n      ref: 'User',\n    },\n  },\n  {\n    timestamps: true,\n  }\n);\n\n// Compound indexes for efficient queries\nMarkSchema.index({ schoolId: 1, examId: 1 });\nMarkSchema.index({ studentId: 1, examId: 1, subjectId: 1 }, { unique: true });\nMarkSchema.index({ examId: 1, subjectId: 1 });\n\n// Pre-save hook to calculate percentage and grade\nMarkSchema.pre('save', function () {\n  if (this.marksScored !== undefined && this.totalMarks !== undefined) {\n    this.percentage = (this.marksScored / this.totalMarks) * 100;\n    \n    // Calculate grade based on percentage\n    if (this.percentage >= 90) this.grade = 'A+';\n    else if (this.percentage >= 80) this.grade = 'A';\n    else if (this.percentage >= 70) this.grade = 'B+';\n    else if (this.percentage >= 60) this.grade = 'B';\n    else if (this.percentage >= 50) this.grade = 'C';\n    else if (this.percentage >= 40) this.grade = 'D';\n    else this.grade = 'F';\n  }\n});\n\nexport default mongoose.models.Mark || mongoose.model<IMark>('Mark', MarkSchema);\n"],"names":[],"mappings":";;;;AAAA;;AAiBA,MAAM,aAAa,IAAI,mHAAM,CAC3B;IACE,WAAW;QACT,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;YAAC;YAAM;SAAyB;QAC1C,OAAO;IACT;IACA,UAAU;QACR,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;YAAC;YAAM;SAAwB;QACzC,OAAO;IACT;IACA,QAAQ;QACN,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;YAAC;YAAM;SAAsB;QACvC,OAAO;IACT;IACA,WAAW;QACT,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;YAAC;YAAM;SAAyB;QAC1C,OAAO;IACT;IACA,aAAa;QACX,MAAM;QACN,UAAU;YAAC;YAAM;SAA2B;QAC5C,KAAK;IACP;IACA,YAAY;QACV,MAAM;QACN,KAAK;IACP;IACA,YAAY;QACV,MAAM;QACN,KAAK;QACL,KAAK;IACP;IACA,OAAO;QACL,MAAM;QACN,MAAM;IACR;IACA,SAAS;QACP,MAAM;QACN,MAAM;QACN,WAAW;IACb;IACA,UAAU;QACR,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;IACP;AACF,GACA;IACE,YAAY;AACd;AAGF,yCAAyC;AACzC,WAAW,KAAK,CAAC;IAAE,UAAU;IAAG,QAAQ;AAAE;AAC1C,WAAW,KAAK,CAAC;IAAE,WAAW;IAAG,QAAQ;IAAG,WAAW;AAAE,GAAG;IAAE,QAAQ;AAAK;AAC3E,WAAW,KAAK,CAAC;IAAE,QAAQ;IAAG,WAAW;AAAE;AAE3C,kDAAkD;AAClD,WAAW,GAAG,CAAC,QAAQ;IACrB,IAAI,IAAI,CAAC,WAAW,KAAK,aAAa,IAAI,CAAC,UAAU,KAAK,WAAW;QACnE,IAAI,CAAC,UAAU,GAAG,AAAC,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,UAAU,GAAI;QAEzD,sCAAsC;QACtC,IAAI,IAAI,CAAC,UAAU,IAAI,IAAI,IAAI,CAAC,KAAK,GAAG;aACnC,IAAI,IAAI,CAAC,UAAU,IAAI,IAAI,IAAI,CAAC,KAAK,GAAG;aACxC,IAAI,IAAI,CAAC,UAAU,IAAI,IAAI,IAAI,CAAC,KAAK,GAAG;aACxC,IAAI,IAAI,CAAC,UAAU,IAAI,IAAI,IAAI,CAAC,KAAK,GAAG;aACxC,IAAI,IAAI,CAAC,UAAU,IAAI,IAAI,IAAI,CAAC,KAAK,GAAG;aACxC,IAAI,IAAI,CAAC,UAAU,IAAI,IAAI,IAAI,CAAC,KAAK,GAAG;aACxC,IAAI,CAAC,KAAK,GAAG;IACpB;AACF;uCAEe,oHAAQ,CAAC,MAAM,CAAC,IAAI,IAAI,oHAAQ,CAAC,KAAK,CAAQ,QAAQ"}},
    {"offset": {"line": 251, "column": 0}, "map": {"version":3,"sources":["file:///E:/projects/edu-bridge-ai-platform/app/api/teacher/marks/route.ts"],"sourcesContent":["import connectDB from '@/lib/mongodb'\nimport { getSession } from '@/lib/auth'\nimport Mark from '@/lib/models/Mark'\nimport { NextRequest, NextResponse } from 'next/server'\n\nexport async function GET(request: NextRequest) {\n  try {\n    const session = await getSession()\n    if (!session || (session.role !== 'teacher' && session.role !== 'principal')) {\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 })\n    }\n\n    await connectDB()\n\n    const { searchParams } = new URL(request.url)\n    const classId = searchParams.get('classId')\n    const examId = searchParams.get('examId')\n    const subjectId = searchParams.get('subjectId')\n\n    if (!classId || !examId || !subjectId) {\n      return NextResponse.json({ success: false, error: 'Missing required parameters' }, { status: 400 })\n    }\n\n    const marks = await Mark.find({\n      examId,\n      subjectId,\n      schoolId: session.schoolId\n    })\n      .populate('studentId', 'name rollNo email')\n      .select('studentId marksScored totalMarks percentage grade remarks')\n      .lean()\n\n    return NextResponse.json({\n      success: true,\n      marks\n    })\n  } catch (error: any) {\n    console.error('Error fetching marks:', error)\n    return NextResponse.json(\n      { success: false, error: error.message },\n      { status: 500 }\n    )\n  }\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const session = await getSession()\n    if (!session || (session.role !== 'teacher' && session.role !== 'principal')) {\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 })\n    }\n\n    await connectDB()\n\n    const body = await request.json()\n    const { marks } = body\n\n    if (!marks || !Array.isArray(marks)) {\n      return NextResponse.json({ success: false, error: 'Invalid marks data' }, { status: 400 })\n    }\n\n    // Update or create marks\n    const operations = marks.map(mark => ({\n      updateOne: {\n        filter: {\n          studentId: mark.studentId,\n          examId: mark.examId,\n          subjectId: mark.subjectId,\n          schoolId: session.schoolId\n        },\n        update: {\n          $set: {\n            marksScored: mark.marksScored,\n            totalMarks: mark.totalMarks,\n            markedBy: session.userId\n          }\n        },\n        upsert: true\n      }\n    }))\n\n    await Mark.bulkWrite(operations)\n\n    return NextResponse.json({\n      success: true,\n      message: 'Marks saved successfully'\n    })\n  } catch (error: any) {\n    console.error('Error saving marks:', error)\n    return NextResponse.json(\n      { success: false, error: error.message },\n      { status: 500 }\n    )\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;AACA;;;;;AAEO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,UAAU,MAAM,IAAA,2HAAU;QAChC,IAAI,CAAC,WAAY,QAAQ,IAAI,KAAK,aAAa,QAAQ,IAAI,KAAK,aAAc;YAC5E,OAAO,+QAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;gBAAO,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACpF;QAEA,MAAM,IAAA,2HAAS;QAEf,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,MAAM,UAAU,aAAa,GAAG,CAAC;QACjC,MAAM,SAAS,aAAa,GAAG,CAAC;QAChC,MAAM,YAAY,aAAa,GAAG,CAAC;QAEnC,IAAI,CAAC,WAAW,CAAC,UAAU,CAAC,WAAW;YACrC,OAAO,+QAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;gBAAO,OAAO;YAA8B,GAAG;gBAAE,QAAQ;YAAI;QACnG;QAEA,MAAM,QAAQ,MAAM,kIAAI,CAAC,IAAI,CAAC;YAC5B;YACA;YACA,UAAU,QAAQ,QAAQ;QAC5B,GACG,QAAQ,CAAC,aAAa,qBACtB,MAAM,CAAC,6DACP,IAAI;QAEP,OAAO,+QAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT;QACF;IACF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,yBAAyB;QACvC,OAAO,+QAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAO,OAAO,MAAM,OAAO;QAAC,GACvC;YAAE,QAAQ;QAAI;IAElB;AACF;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,UAAU,MAAM,IAAA,2HAAU;QAChC,IAAI,CAAC,WAAY,QAAQ,IAAI,KAAK,aAAa,QAAQ,IAAI,KAAK,aAAc;YAC5E,OAAO,+QAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;gBAAO,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACpF;QAEA,MAAM,IAAA,2HAAS;QAEf,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,KAAK,EAAE,GAAG;QAElB,IAAI,CAAC,SAAS,CAAC,MAAM,OAAO,CAAC,QAAQ;YACnC,OAAO,+QAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;gBAAO,OAAO;YAAqB,GAAG;gBAAE,QAAQ;YAAI;QAC1F;QAEA,yBAAyB;QACzB,MAAM,aAAa,MAAM,GAAG,CAAC,CAAA,OAAQ,CAAC;gBACpC,WAAW;oBACT,QAAQ;wBACN,WAAW,KAAK,SAAS;wBACzB,QAAQ,KAAK,MAAM;wBACnB,WAAW,KAAK,SAAS;wBACzB,UAAU,QAAQ,QAAQ;oBAC5B;oBACA,QAAQ;wBACN,MAAM;4BACJ,aAAa,KAAK,WAAW;4BAC7B,YAAY,KAAK,UAAU;4BAC3B,UAAU,QAAQ,MAAM;wBAC1B;oBACF;oBACA,QAAQ;gBACV;YACF,CAAC;QAED,MAAM,kIAAI,CAAC,SAAS,CAAC;QAErB,OAAO,+QAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,SAAS;QACX;IACF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,uBAAuB;QACrC,OAAO,+QAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAO,OAAO,MAAM,OAAO;QAAC,GACvC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}