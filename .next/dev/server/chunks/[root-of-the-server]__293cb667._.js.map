{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///E:/projects/edu-bridge-ai-platform/lib/permissions.ts"],"sourcesContent":["/**\n * Role-Based Access Control (RBAC) System\n * \n * Role Hierarchy:\n * 1. Super Admin - Platform owner, manages all schools\n * 2. Principal - School-level admin, manages their school\n * 3. Teacher - Manages assigned classes and subjects\n * 4. Student - View-only access to their own data\n */\n\nexport type UserRole = 'super-admin' | 'principal' | 'teacher' | 'student';\n\nexport interface Permission {\n  resource: string;\n  action: 'create' | 'read' | 'update' | 'delete' | 'manage';\n  scope?: 'all' | 'school' | 'own' | 'assigned';\n}\n\n// Define permissions for each role\nexport const rolePermissions: Record<UserRole, Permission[]> = {\n  'super-admin': [\n    // Full platform access\n    { resource: 'schools', action: 'manage', scope: 'all' },\n    { resource: 'users', action: 'manage', scope: 'all' },\n    { resource: 'principals', action: 'create', scope: 'all' },\n    { resource: 'principals', action: 'manage', scope: 'all' },\n    { resource: 'billing', action: 'manage', scope: 'all' },\n    { resource: 'analytics', action: 'read', scope: 'all' },\n    { resource: 'reports', action: 'read', scope: 'all' },\n    { resource: 'school-registrations', action: 'manage', scope: 'all' },\n  ],\n  \n  'principal': [\n    // School-level management\n    { resource: 'school', action: 'read', scope: 'own' },\n    { resource: 'school', action: 'update', scope: 'own' },\n    { resource: 'teachers', action: 'create', scope: 'school' },\n    { resource: 'teachers', action: 'manage', scope: 'school' },\n    { resource: 'students', action: 'create', scope: 'school' },\n    { resource: 'students', action: 'manage', scope: 'school' },\n    { resource: 'classes', action: 'manage', scope: 'school' },\n    { resource: 'subjects', action: 'manage', scope: 'school' },\n    { resource: 'attendance', action: 'read', scope: 'school' },\n    { resource: 'marks', action: 'read', scope: 'school' },\n    { resource: 'reports', action: 'read', scope: 'school' },\n    { resource: 'timetable', action: 'manage', scope: 'school' },\n    { resource: 'courses', action: 'manage', scope: 'school' },\n  ],\n  \n  'teacher': [\n    // Class and subject specific access\n    { resource: 'school', action: 'read', scope: 'own' }, // Read-only school info\n    { resource: 'students', action: 'read', scope: 'assigned' }, // Only their class students\n    { resource: 'classes', action: 'read', scope: 'assigned' },\n    { resource: 'subjects', action: 'read', scope: 'assigned' },\n    { resource: 'homework', action: 'manage', scope: 'assigned' },\n    { resource: 'attendance', action: 'create', scope: 'assigned' },\n    { resource: 'attendance', action: 'read', scope: 'assigned' },\n    { resource: 'marks', action: 'create', scope: 'assigned' },\n    { resource: 'marks', action: 'update', scope: 'assigned' },\n    { resource: 'marks', action: 'read', scope: 'assigned' },\n    { resource: 'timetable', action: 'read', scope: 'assigned' },\n    { resource: 'courses', action: 'read', scope: 'assigned' },\n    { resource: 'quizzes', action: 'read', scope: 'assigned' }, // View quiz responses\n  ],\n  \n  'student': [\n    // Personal dashboard only\n    { resource: 'profile', action: 'read', scope: 'own' },\n    { resource: 'profile', action: 'update', scope: 'own' },\n    { resource: 'class', action: 'read', scope: 'own' },\n    { resource: 'subjects', action: 'read', scope: 'own' },\n    { resource: 'teachers', action: 'read', scope: 'own' },\n    { resource: 'homework', action: 'read', scope: 'own' },\n    { resource: 'attendance', action: 'read', scope: 'own' },\n    { resource: 'marks', action: 'read', scope: 'own' },\n    { resource: 'timetable', action: 'read', scope: 'own' },\n    { resource: 'courses', action: 'read', scope: 'own' },\n    { resource: 'quizzes', action: 'read', scope: 'own' },\n    { resource: 'quizzes', action: 'create', scope: 'own' }, // Submit quiz responses\n    { resource: 'school', action: 'read', scope: 'own' }, // Basic school info only\n  ],\n};\n\n/**\n * Check if a user has permission to perform an action\n */\nexport function hasPermission(\n  userRole: UserRole,\n  resource: string,\n  action: 'create' | 'read' | 'update' | 'delete' | 'manage',\n  scope?: 'all' | 'school' | 'own' | 'assigned'\n): boolean {\n  const permissions = rolePermissions[userRole];\n  \n  return permissions.some(permission => {\n    // Check if resource matches\n    const resourceMatch = permission.resource === resource;\n    \n    // Check if action matches (manage includes all actions)\n    const actionMatch = \n      permission.action === action || \n      permission.action === 'manage';\n    \n    // Check if scope matches (if scope is specified)\n    const scopeMatch = !scope || permission.scope === scope || permission.scope === 'all';\n    \n    return resourceMatch && actionMatch && scopeMatch;\n  });\n}\n\n/**\n * Check if user can access a school's data\n */\nexport function canAccessSchool(\n  userRole: UserRole,\n  userSchoolId: string | undefined,\n  targetSchoolId: string\n): boolean {\n  // Super admin can access all schools\n  if (userRole === 'super-admin') {\n    return true;\n  }\n  \n  // Others can only access their own school\n  return userSchoolId === targetSchoolId;\n}\n\n/**\n * Check if user can access another user's data\n */\nexport function canAccessUser(\n  userRole: UserRole,\n  userId: string,\n  targetUserId: string,\n  userSchoolId: string | undefined,\n  targetUserSchoolId: string | undefined,\n  targetUserRole?: UserRole\n): boolean {\n  // Super admin can access all users\n  if (userRole === 'super-admin') {\n    return true;\n  }\n  \n  // Users can always access their own data\n  if (userId === targetUserId) {\n    return true;\n  }\n  \n  // Principal can access all users in their school\n  if (userRole === 'principal' && userSchoolId === targetUserSchoolId) {\n    return true;\n  }\n  \n  // Teachers can access students in their school (will be further filtered by assigned classes)\n  if (\n    userRole === 'teacher' && \n    targetUserRole === 'student' && \n    userSchoolId === targetUserSchoolId\n  ) {\n    return true;\n  }\n  \n  return false;\n}\n\n/**\n * Filter data based on user's role and scope\n */\nexport function getAccessibleSchoolIds(\n  userRole: UserRole,\n  userSchoolId: string | undefined\n): string[] | 'all' {\n  if (userRole === 'super-admin') {\n    return 'all';\n  }\n  \n  if (userSchoolId) {\n    return [userSchoolId];\n  }\n  \n  return [];\n}\n\n/**\n * Get user-friendly role names\n */\nexport const roleLabels: Record<UserRole, string> = {\n  'super-admin': 'Super Administrator',\n  'principal': 'Principal / Head of School',\n  'teacher': 'Teacher',\n  'student': 'Student',\n};\n\n/**\n * Get role descriptions\n */\nexport const roleDescriptions: Record<UserRole, string> = {\n  'super-admin': 'Platform owner with full access to all schools and features',\n  'principal': 'School administrator with full control over their school',\n  'teacher': 'Can manage assigned classes, subjects, and student data',\n  'student': 'View-only access to personal academic information',\n};\n\n/**\n * Get dashboard route based on role\n */\nexport function getDashboardRoute(role: UserRole): string {\n  switch (role) {\n    case 'super-admin':\n      return '/admin/dashboard';\n    case 'principal':\n      return '/principal/dashboard';\n    case 'teacher':\n      return '/teacher/dashboard';\n    case 'student':\n      return '/student/dashboard';\n    default:\n      return '/';\n  }\n}\n\n/**\n * Check if role can create users of target role\n */\nexport function canCreateRole(\n  userRole: UserRole,\n  targetRole: UserRole\n): boolean {\n  if (userRole === 'super-admin') {\n    // Super admin can create principals and approve schools\n    return ['principal', 'super-admin'].includes(targetRole);\n  }\n  \n  if (userRole === 'principal') {\n    // Principal can create teachers and students\n    return ['teacher', 'student'].includes(targetRole);\n  }\n  \n  return false;\n}\n\n/**\n * Middleware helper for API routes\n */\nexport function requireRole(allowedRoles: UserRole[]) {\n  return (userRole: UserRole) => {\n    return allowedRoles.includes(userRole);\n  };\n}\n\n/**\n * Check if user has elevated privileges\n */\nexport function isAdmin(role: UserRole): boolean {\n  return ['super-admin', 'principal'].includes(role);\n}\n\n/**\n * Check if user is super admin\n */\nexport function isSuperAdmin(role: UserRole): boolean {\n  return role === 'super-admin';\n}\n\n/**\n * Check if user is principal\n */\nexport function isPrincipal(role: UserRole): boolean {\n  return role === 'principal';\n}\n\n/**\n * Check if user is teacher\n */\nexport function isTeacher(role: UserRole): boolean {\n  return role === 'teacher';\n}\n\n/**\n * Check if user is student\n */\nexport function isStudent(role: UserRole): boolean {\n  return role === 'student';\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 455, "column": 0}, "map": {"version":3,"sources":["file:///E:/projects/edu-bridge-ai-platform/lib/auth-middleware.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { UserRole, canAccessSchool, hasPermission } from './permissions';\n\nexport interface AuthUser {\n  id: string;\n  role: UserRole;\n  name: string;\n  email: string;\n  schoolId?: string;\n}\n\n/**\n * Get authenticated user from request cookies\n */\nexport function getAuthUser(request: NextRequest): AuthUser | null {\n  try {\n    const cookie = request.cookies.get('edubridge_session');\n    if (!cookie?.value) {\n      return null;\n    }\n    \n    const session = JSON.parse(cookie.value);\n    return {\n      id: session.id,\n      role: session.role as UserRole,\n      name: session.name,\n      email: session.email,\n      schoolId: session.schoolId,\n    };\n  } catch (error) {\n    return null;\n  }\n}\n\n/**\n * Require authentication - returns 401 if not authenticated\n */\nexport function requireAuth(request: NextRequest): AuthUser | NextResponse {\n  const user = getAuthUser(request);\n  \n  if (!user) {\n    return NextResponse.json(\n      { success: false, error: 'Authentication required' },\n      { status: 401 }\n    );\n  }\n  \n  return user;\n}\n\n/**\n * Require specific role(s) - returns 403 if not authorized\n */\nexport function requireRoles(\n  user: AuthUser,\n  allowedRoles: UserRole[]\n): true | NextResponse {\n  if (!allowedRoles.includes(user.role)) {\n    return NextResponse.json(\n      { \n        success: false, \n        error: 'Insufficient permissions',\n        message: `This action requires one of the following roles: ${allowedRoles.join(', ')}`\n      },\n      { status: 403 }\n    );\n  }\n  \n  return true;\n}\n\n/**\n * Require permission for a resource and action\n */\nexport function requirePermission(\n  user: AuthUser,\n  resource: string,\n  action: 'create' | 'read' | 'update' | 'delete' | 'manage',\n  scope?: 'all' | 'school' | 'own' | 'assigned'\n): true | NextResponse {\n  if (!hasPermission(user.role, resource, action, scope)) {\n    return NextResponse.json(\n      { \n        success: false, \n        error: 'Insufficient permissions',\n        message: `You don't have permission to ${action} ${resource}`\n      },\n      { status: 403 }\n    );\n  }\n  \n  return true;\n}\n\n/**\n * Require school access - returns 403 if user can't access the school\n */\nexport function requireSchoolAccess(\n  user: AuthUser,\n  targetSchoolId: string\n): true | NextResponse {\n  if (!canAccessSchool(user.role, user.schoolId, targetSchoolId)) {\n    return NextResponse.json(\n      { \n        success: false, \n        error: 'Access denied',\n        message: 'You do not have access to this school'\n      },\n      { status: 403 }\n    );\n  }\n  \n  return true;\n}\n\n/**\n * Require same school - ensures user and target are in same school\n */\nexport function requireSameSchool(\n  user: AuthUser,\n  targetSchoolId: string | undefined\n): true | NextResponse {\n  // Super admin can access all schools\n  if (user.role === 'super-admin') {\n    return true;\n  }\n  \n  if (!user.schoolId || !targetSchoolId) {\n    return NextResponse.json(\n      { \n        success: false, \n        error: 'School information missing',\n      },\n      { status: 400 }\n    );\n  }\n  \n  if (user.schoolId !== targetSchoolId) {\n    return NextResponse.json(\n      { \n        success: false, \n        error: 'Access denied',\n        message: 'You can only access users in your school'\n      },\n      { status: 403 }\n    );\n  }\n  \n  return true;\n}\n\n/**\n * Helper to handle auth checks in API routes\n * Returns user if all checks pass, otherwise returns NextResponse error\n */\nexport function authenticateAndAuthorize(\n  request: NextRequest,\n  options: {\n    requiredRoles?: UserRole[];\n    resource?: string;\n    action?: 'create' | 'read' | 'update' | 'delete' | 'manage';\n    scope?: 'all' | 'school' | 'own' | 'assigned';\n  } = {}\n): AuthUser | NextResponse {\n  // Check authentication\n  const authResult = requireAuth(request);\n  if (authResult instanceof NextResponse) {\n    return authResult;\n  }\n  \n  const user = authResult;\n  \n  // Check role if specified\n  if (options.requiredRoles) {\n    const roleCheck = requireRoles(user, options.requiredRoles);\n    if (roleCheck instanceof NextResponse) {\n      return roleCheck;\n    }\n  }\n  \n  // Check permission if specified\n  if (options.resource && options.action) {\n    const permCheck = requirePermission(\n      user,\n      options.resource,\n      options.action,\n      options.scope\n    );\n    if (permCheck instanceof NextResponse) {\n      return permCheck;\n    }\n  }\n  \n  return user;\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 592, "column": 0}, "map": {"version":3,"sources":["file:///E:/projects/edu-bridge-ai-platform/app/api/chatbot/route.ts"],"sourcesContent":["import { authenticateAndAuthorize } from '@/lib/auth-middleware';\nimport { NextRequest, NextResponse } from 'next/server';\n\n// Simple AI chatbot for educational assistance\n// Accessible to all authenticated users from any school\nexport async function POST(req: NextRequest) {\n  try {\n    // Authenticate user - all roles can access chatbot\n    const authResult = authenticateAndAuthorize(req, {\n      requiredRoles: ['super-admin', 'principal', 'teacher', 'student'],\n    });\n\n    if (authResult instanceof NextResponse) {\n      return authResult;\n    }\n\n    const user = authResult;\n    const { message, conversationHistory } = await req.json();\n\n    if (!message || message.trim().length === 0) {\n      return NextResponse.json(\n        { error: 'Message is required' },\n        { status: 400 }\n      );\n    }\n\n    // Build context based on user role\n    const roleContext = getRoleContext(user.role, user.name);\n\n    // Simple rule-based responses (can be enhanced with AI API later)\n    const response = generateResponse(message, roleContext, conversationHistory);\n\n    return NextResponse.json({\n      success: true,\n      response,\n      timestamp: new Date().toISOString(),\n    });\n  } catch (error: any) {\n    console.error('Chatbot error:', error);\n    return NextResponse.json(\n      { error: 'Failed to process chatbot request' },\n      { status: 500 }\n    );\n  }\n}\n\nfunction getRoleContext(role: string, name: string): string {\n  const contexts: Record<string, string> = {\n    student: `You are an educational assistant helping ${name}, a student. Provide clear explanations, study tips, and guidance on coursework.`,\n    teacher: `You are an educational assistant helping ${name}, a teacher. Provide teaching strategies, classroom management tips, and content creation guidance.`,\n    principal: `You are an administrative assistant helping ${name}, a principal. Provide insights on school management, enrollment, and educational leadership.`,\n    'super-admin': `You are an administrative assistant helping ${name}, a super admin. Provide platform management and multi-school oversight guidance.`,\n  };\n\n  return contexts[role] || contexts['student'];\n}\n\nfunction generateResponse(\n  message: string,\n  context: string,\n  history?: any[]\n): string {\n  const lowerMessage = message.toLowerCase();\n\n  // Educational keywords\n  if (\n    lowerMessage.includes('course') ||\n    lowerMessage.includes('learn') ||\n    lowerMessage.includes('study')\n  ) {\n    return \"I can help you with your courses! You can browse available courses in the Courses section. Each course includes lessons, quizzes, and progress tracking. Would you like tips on effective studying?\";\n  }\n\n  if (\n    lowerMessage.includes('quiz') ||\n    lowerMessage.includes('test') ||\n    lowerMessage.includes('exam')\n  ) {\n    return \"For quizzes and tests, I recommend: 1) Review course materials regularly, 2) Practice with sample questions, 3) Take notes during lessons, 4) Don't rush - read questions carefully. You can find quizzes in your enrolled courses. Need specific study strategies?\";\n  }\n\n  if (\n    lowerMessage.includes('assignment') ||\n    lowerMessage.includes('homework')\n  ) {\n    return \"For assignments, make sure to: 1) Read the instructions carefully, 2) Start early to avoid last-minute stress, 3) Break large assignments into smaller tasks, 4) Ask your teacher if you need clarification. Check your dashboard for pending assignments.\";\n  }\n\n  if (\n    lowerMessage.includes('grade') ||\n    lowerMessage.includes('score') ||\n    lowerMessage.includes('performance')\n  ) {\n    return \"You can view your grades and performance analytics in the Analytics section of your dashboard. It shows your progress, quiz scores, and course completion rates. Focus on consistent learning rather than just grades!\";\n  }\n\n  if (\n    lowerMessage.includes('teacher') ||\n    lowerMessage.includes('instructor')\n  ) {\n    return \"You can view your teachers and their contact information in the appropriate section. If you need help with a specific subject, reach out to your subject teacher through the platform's messaging system.\";\n  }\n\n  if (\n    lowerMessage.includes('enroll') ||\n    lowerMessage.includes('register') ||\n    lowerMessage.includes('join')\n  ) {\n    return \"To enroll in courses, browse the Courses section and click on any course you're interested in. You'll see course details, lessons, and an enrollment option. Your principal can also enroll you in required courses.\";\n  }\n\n  if (\n    lowerMessage.includes('help') ||\n    lowerMessage.includes('how to') ||\n    lowerMessage.includes('guide')\n  ) {\n    return \"I'm here to help! I can assist with: \\n- Course information and enrollment\\n- Study tips and exam preparation\\n- Understanding assignments and quizzes\\n- Navigating the platform\\n- Performance tracking\\n\\nWhat specific topic would you like help with?\";\n  }\n\n  if (\n    lowerMessage.includes('analytics') ||\n    lowerMessage.includes('progress') ||\n    lowerMessage.includes('dashboard')\n  ) {\n    return \"Your dashboard provides a comprehensive view of your learning journey! Check the Analytics section to see: course completion rates, quiz performance, study time, and areas for improvement. Regular review of your analytics helps you stay on track.\";\n  }\n\n  if (\n    lowerMessage.includes('community') ||\n    lowerMessage.includes('forum') ||\n    lowerMessage.includes('discussion')\n  ) {\n    return \"The Community section is a great place to connect with peers, ask questions, share knowledge, and participate in discussions. Collaborative learning enhances understanding - don't hesitate to engage!\";\n  }\n\n  if (lowerMessage.includes('thank') || lowerMessage.includes('thanks')) {\n    return \"You're welcome! I'm always here to help with your educational journey. Feel free to ask me anything about courses, studying, or using the platform. Happy learning! üìö\";\n  }\n\n  // Default response\n  return `Hello! I'm your educational assistant. I can help you with:\n\nüìö **Courses** - Browse, enroll, and learn\nüìù **Assignments & Quizzes** - Study tips and strategies  \nüìä **Analytics** - Track your progress\nüë• **Community** - Connect with peers\n‚öôÔ∏è **Platform Navigation** - Find your way around\n\nWhat would you like to know more about?`;\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAIO,eAAe,KAAK,GAAgB;IACzC,IAAI;QACF,mDAAmD;QACnD,MAAM,aAAa,IAAA,uJAAwB,EAAC,KAAK;YAC/C,eAAe;gBAAC;gBAAe;gBAAa;gBAAW;aAAU;QACnE;QAEA,IAAI,sBAAsB,+QAAY,EAAE;YACtC,OAAO;QACT;QAEA,MAAM,OAAO;QACb,MAAM,EAAE,OAAO,EAAE,mBAAmB,EAAE,GAAG,MAAM,IAAI,IAAI;QAEvD,IAAI,CAAC,WAAW,QAAQ,IAAI,GAAG,MAAM,KAAK,GAAG;YAC3C,OAAO,+QAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAsB,GAC/B;gBAAE,QAAQ;YAAI;QAElB;QAEA,mCAAmC;QACnC,MAAM,cAAc,eAAe,KAAK,IAAI,EAAE,KAAK,IAAI;QAEvD,kEAAkE;QAClE,MAAM,WAAW,iBAAiB,SAAS,aAAa;QAExD,OAAO,+QAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT;YACA,WAAW,IAAI,OAAO,WAAW;QACnC;IACF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,kBAAkB;QAChC,OAAO,+QAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAoC,GAC7C;YAAE,QAAQ;QAAI;IAElB;AACF;AAEA,SAAS,eAAe,IAAY,EAAE,IAAY;IAChD,MAAM,WAAmC;QACvC,SAAS,CAAC,yCAAyC,EAAE,KAAK,gFAAgF,CAAC;QAC3I,SAAS,CAAC,yCAAyC,EAAE,KAAK,mGAAmG,CAAC;QAC9J,WAAW,CAAC,4CAA4C,EAAE,KAAK,6FAA6F,CAAC;QAC7J,eAAe,CAAC,4CAA4C,EAAE,KAAK,iFAAiF,CAAC;IACvJ;IAEA,OAAO,QAAQ,CAAC,KAAK,IAAI,QAAQ,CAAC,UAAU;AAC9C;AAEA,SAAS,iBACP,OAAe,EACf,OAAe,EACf,OAAe;IAEf,MAAM,eAAe,QAAQ,WAAW;IAExC,uBAAuB;IACvB,IACE,aAAa,QAAQ,CAAC,aACtB,aAAa,QAAQ,CAAC,YACtB,aAAa,QAAQ,CAAC,UACtB;QACA,OAAO;IACT;IAEA,IACE,aAAa,QAAQ,CAAC,WACtB,aAAa,QAAQ,CAAC,WACtB,aAAa,QAAQ,CAAC,SACtB;QACA,OAAO;IACT;IAEA,IACE,aAAa,QAAQ,CAAC,iBACtB,aAAa,QAAQ,CAAC,aACtB;QACA,OAAO;IACT;IAEA,IACE,aAAa,QAAQ,CAAC,YACtB,aAAa,QAAQ,CAAC,YACtB,aAAa,QAAQ,CAAC,gBACtB;QACA,OAAO;IACT;IAEA,IACE,aAAa,QAAQ,CAAC,cACtB,aAAa,QAAQ,CAAC,eACtB;QACA,OAAO;IACT;IAEA,IACE,aAAa,QAAQ,CAAC,aACtB,aAAa,QAAQ,CAAC,eACtB,aAAa,QAAQ,CAAC,SACtB;QACA,OAAO;IACT;IAEA,IACE,aAAa,QAAQ,CAAC,WACtB,aAAa,QAAQ,CAAC,aACtB,aAAa,QAAQ,CAAC,UACtB;QACA,OAAO;IACT;IAEA,IACE,aAAa,QAAQ,CAAC,gBACtB,aAAa,QAAQ,CAAC,eACtB,aAAa,QAAQ,CAAC,cACtB;QACA,OAAO;IACT;IAEA,IACE,aAAa,QAAQ,CAAC,gBACtB,aAAa,QAAQ,CAAC,YACtB,aAAa,QAAQ,CAAC,eACtB;QACA,OAAO;IACT;IAEA,IAAI,aAAa,QAAQ,CAAC,YAAY,aAAa,QAAQ,CAAC,WAAW;QACrE,OAAO;IACT;IAEA,mBAAmB;IACnB,OAAO,CAAC;;;;;;;;uCAQ6B,CAAC;AACxC"}}]
}