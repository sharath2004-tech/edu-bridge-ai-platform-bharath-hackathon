{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///E:/projects/edu-bridge-ai-platform/lib/mongodb.ts"],"sourcesContent":["import mongoose from 'mongoose';\n\nconst MONGODB_URI = process.env.MONGODB_URI as string;\n\nif (!MONGODB_URI) {\n  throw new Error(\n    'Please define the MONGODB_URI environment variable inside .env.local'\n  );\n}\n\n/**\n * Global is used here to maintain a cached connection across hot reloads\n * in development. This prevents connections growing exponentially\n * during API Route usage.\n */\ninterface MongooseCache {\n  conn: typeof mongoose | null;\n  promise: Promise<typeof mongoose> | null;\n}\n\ndeclare global {\n  var mongoose: MongooseCache | undefined;\n}\n\nlet cached: MongooseCache = global.mongoose || { conn: null, promise: null };\n\nif (!global.mongoose) {\n  global.mongoose = cached;\n}\n\nasync function connectDB(): Promise<typeof mongoose> {\n  if (cached.conn) {\n    return cached.conn;\n  }\n\n  if (!cached.promise) {\n    const opts = {\n      bufferCommands: false,\n      serverSelectionTimeoutMS: 30000,\n      socketTimeoutMS: 75000,\n      connectTimeoutMS: 30000,\n      maxPoolSize: 10,\n      minPoolSize: 1,\n      retryWrites: true,\n      retryReads: true,\n      // Disable TLS validation to fix Node.js 22 SSL error\n      tls: true,\n      tlsAllowInvalidCertificates: true,\n      tlsAllowInvalidHostnames: true,\n    };\n\n    cached.promise = mongoose.connect(MONGODB_URI, opts).then((mongoose) => {\n      console.log('✅ MongoDB connected successfully');\n      return mongoose;\n    }).catch((err) => {\n      console.error('❌ MongoDB connection error:', err.message);\n      cached.promise = null;\n      throw err;\n    });\n  }\n\n  try {\n    cached.conn = await cached.promise;\n  } catch (e) {\n    cached.promise = null;\n    console.error('❌ MongoDB connection error:', e);\n    throw e;\n  }\n\n  return cached.conn;\n}\n\nexport default connectDB;\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,cAAc,QAAQ,GAAG,CAAC,WAAW;AAE3C,IAAI,CAAC,aAAa;IAChB,MAAM,IAAI,MACR;AAEJ;AAgBA,IAAI,SAAwB,OAAO,QAAQ,IAAI;IAAE,MAAM;IAAM,SAAS;AAAK;AAE3E,IAAI,CAAC,OAAO,QAAQ,EAAE;IACpB,OAAO,QAAQ,GAAG;AACpB;AAEA,eAAe;IACb,IAAI,OAAO,IAAI,EAAE;QACf,OAAO,OAAO,IAAI;IACpB;IAEA,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,MAAM,OAAO;YACX,gBAAgB;YAChB,0BAA0B;YAC1B,iBAAiB;YACjB,kBAAkB;YAClB,aAAa;YACb,aAAa;YACb,aAAa;YACb,YAAY;YACZ,qDAAqD;YACrD,KAAK;YACL,6BAA6B;YAC7B,0BAA0B;QAC5B;QAEA,OAAO,OAAO,GAAG,oHAAQ,CAAC,OAAO,CAAC,aAAa,MAAM,IAAI,CAAC,CAAC;YACzD,QAAQ,GAAG,CAAC;YACZ,OAAO;QACT,GAAG,KAAK,CAAC,CAAC;YACR,QAAQ,KAAK,CAAC,+BAA+B,IAAI,OAAO;YACxD,OAAO,OAAO,GAAG;YACjB,MAAM;QACR;IACF;IAEA,IAAI;QACF,OAAO,IAAI,GAAG,MAAM,OAAO,OAAO;IACpC,EAAE,OAAO,GAAG;QACV,OAAO,OAAO,GAAG;QACjB,QAAQ,KAAK,CAAC,+BAA+B;QAC7C,MAAM;IACR;IAEA,OAAO,OAAO,IAAI;AACpB;uCAEe"}},
    {"offset": {"line": 105, "column": 0}, "map": {"version":3,"sources":["file:///E:/projects/edu-bridge-ai-platform/lib/models/Class.ts"],"sourcesContent":["import mongoose, { Document, Schema } from 'mongoose';\n\nexport interface IClass extends Document {\n  _id: string;\n  schoolId: mongoose.Types.ObjectId;\n  className: string; // e.g., \"LKG\", \"1st\", \"2nd\", \"10th\"\n  section: string; // e.g., \"A\", \"B\", \"C\"\n  classTeacherId?: mongoose.Types.ObjectId;\n  academicYear?: string; // e.g., \"2024-2025\"\n  strength?: number; // Total students in this class\n  createdAt: Date;\n  updatedAt: Date;\n}\n\nconst ClassSchema = new Schema<IClass>(\n  {\n    schoolId: {\n      type: Schema.Types.ObjectId,\n      ref: 'School',\n      required: [true, 'School ID is required'],\n      index: true,\n    },\n    className: {\n      type: String,\n      required: [true, 'Class name is required'],\n      trim: true,\n      // LKG, UKG, 1st, 2nd, 3rd, 4th, 5th, 6th, 7th, 8th, 9th, 10th, 11th, 12th\n    },\n    section: {\n      type: String,\n      required: [true, 'Section is required'],\n      trim: true,\n      uppercase: true,\n      // A, B, C, D, E, etc.\n    },\n    classTeacherId: {\n      type: Schema.Types.ObjectId,\n      ref: 'User',\n      index: true,\n    },\n    academicYear: {\n      type: String,\n      trim: true,\n    },\n    strength: {\n      type: Number,\n      default: 0,\n      min: 0,\n    },\n  },\n  {\n    timestamps: true,\n  }\n);\n\n// Compound index to ensure unique class-section per school\nClassSchema.index({ schoolId: 1, className: 1, section: 1 }, { unique: true });\n\n// Index for querying by class teacher\nClassSchema.index({ classTeacherId: 1 });\n\nconst Class = mongoose.models.Class || mongoose.model<IClass>('Class', ClassSchema);\n\nexport default Class;\n"],"names":[],"mappings":";;;;AAAA;;AAcA,MAAM,cAAc,IAAI,mHAAM,CAC5B;IACE,UAAU;QACR,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;YAAC;YAAM;SAAwB;QACzC,OAAO;IACT;IACA,WAAW;QACT,MAAM;QACN,UAAU;YAAC;YAAM;SAAyB;QAC1C,MAAM;IAER;IACA,SAAS;QACP,MAAM;QACN,UAAU;YAAC;YAAM;SAAsB;QACvC,MAAM;QACN,WAAW;IAEb;IACA,gBAAgB;QACd,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,OAAO;IACT;IACA,cAAc;QACZ,MAAM;QACN,MAAM;IACR;IACA,UAAU;QACR,MAAM;QACN,SAAS;QACT,KAAK;IACP;AACF,GACA;IACE,YAAY;AACd;AAGF,2DAA2D;AAC3D,YAAY,KAAK,CAAC;IAAE,UAAU;IAAG,WAAW;IAAG,SAAS;AAAE,GAAG;IAAE,QAAQ;AAAK;AAE5E,sCAAsC;AACtC,YAAY,KAAK,CAAC;IAAE,gBAAgB;AAAE;AAEtC,MAAM,QAAQ,oHAAQ,CAAC,MAAM,CAAC,KAAK,IAAI,oHAAQ,CAAC,KAAK,CAAS,SAAS;uCAExD"}},
    {"offset": {"line": 173, "column": 0}, "map": {"version":3,"sources":["file:///E:/projects/edu-bridge-ai-platform/lib/models/Exam.ts"],"sourcesContent":["import mongoose, { Document, Schema } from 'mongoose';\n\nexport interface IExam extends Document {\n  _id: string;\n  schoolId: mongoose.Types.ObjectId;\n  classId: mongoose.Types.ObjectId;\n  examName: string;\n  examType: 'unit-test' | 'mid-term' | 'final' | 'quarterly' | 'half-yearly' | 'annual' | 'other';\n  date: Date;\n  term?: string; // e.g., \"Term 1\", \"Term 2\"\n  academicYear?: string;\n  totalMarks?: number;\n  duration?: number; // in minutes\n  subjects?: mongoose.Types.ObjectId[]; // Array of subject IDs\n  instructions?: string;\n  isActive: boolean;\n  createdAt: Date;\n  updatedAt: Date;\n}\n\nconst ExamSchema = new Schema<IExam>(\n  {\n    schoolId: {\n      type: Schema.Types.ObjectId,\n      ref: 'School',\n      required: [true, 'School ID is required'],\n      index: true,\n    },\n    classId: {\n      type: Schema.Types.ObjectId,\n      ref: 'Class',\n      required: [true, 'Class ID is required'],\n      index: true,\n    },\n    examName: {\n      type: String,\n      required: [true, 'Exam name is required'],\n      trim: true,\n    },\n    examType: {\n      type: String,\n      enum: ['unit-test', 'mid-term', 'final', 'quarterly', 'half-yearly', 'annual', 'other'],\n      default: 'unit-test',\n    },\n    date: {\n      type: Date,\n      required: [true, 'Exam date is required'],\n      index: true,\n    },\n    term: {\n      type: String,\n      trim: true,\n    },\n    academicYear: {\n      type: String,\n      trim: true,\n    },\n    totalMarks: {\n      type: Number,\n      min: 0,\n    },\n    duration: {\n      type: Number,\n      min: 0,\n    },\n    subjects: [{\n      type: Schema.Types.ObjectId,\n      ref: 'Subject',\n    }],\n    instructions: {\n      type: String,\n      trim: true,\n      maxlength: 1000,\n    },\n    isActive: {\n      type: Boolean,\n      default: true,\n    },\n  },\n  {\n    timestamps: true,\n  }\n);\n\n// Index for querying exams by school and class\nExamSchema.index({ schoolId: 1, classId: 1, date: -1 });\n\n// Index for querying by date\nExamSchema.index({ date: 1 });\n\nconst Exam = mongoose.models.Exam || mongoose.model<IExam>('Exam', ExamSchema);\n\nexport default Exam;\n"],"names":[],"mappings":";;;;AAAA;;AAoBA,MAAM,aAAa,IAAI,mHAAM,CAC3B;IACE,UAAU;QACR,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;YAAC;YAAM;SAAwB;QACzC,OAAO;IACT;IACA,SAAS;QACP,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;YAAC;YAAM;SAAuB;QACxC,OAAO;IACT;IACA,UAAU;QACR,MAAM;QACN,UAAU;YAAC;YAAM;SAAwB;QACzC,MAAM;IACR;IACA,UAAU;QACR,MAAM;QACN,MAAM;YAAC;YAAa;YAAY;YAAS;YAAa;YAAe;YAAU;SAAQ;QACvF,SAAS;IACX;IACA,MAAM;QACJ,MAAM;QACN,UAAU;YAAC;YAAM;SAAwB;QACzC,OAAO;IACT;IACA,MAAM;QACJ,MAAM;QACN,MAAM;IACR;IACA,cAAc;QACZ,MAAM;QACN,MAAM;IACR;IACA,YAAY;QACV,MAAM;QACN,KAAK;IACP;IACA,UAAU;QACR,MAAM;QACN,KAAK;IACP;IACA,UAAU;QAAC;YACT,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;YAC3B,KAAK;QACP;KAAE;IACF,cAAc;QACZ,MAAM;QACN,MAAM;QACN,WAAW;IACb;IACA,UAAU;QACR,MAAM;QACN,SAAS;IACX;AACF,GACA;IACE,YAAY;AACd;AAGF,+CAA+C;AAC/C,WAAW,KAAK,CAAC;IAAE,UAAU;IAAG,SAAS;IAAG,MAAM,CAAC;AAAE;AAErD,6BAA6B;AAC7B,WAAW,KAAK,CAAC;IAAE,MAAM;AAAE;AAE3B,MAAM,OAAO,oHAAQ,CAAC,MAAM,CAAC,IAAI,IAAI,oHAAQ,CAAC,KAAK,CAAQ,QAAQ;uCAEpD"}},
    {"offset": {"line": 277, "column": 0}, "map": {"version":3,"sources":["file:///E:/projects/edu-bridge-ai-platform/lib/models/School.ts"],"sourcesContent":["import mongoose, { Document, Model, Schema } from 'mongoose';\n\nexport interface ISchool extends Document {\n  _id: string;\n  name: string;\n  code: string; // Unique school code for registration\n  email: string;\n  phone?: string;\n  address: {\n    street?: string;\n    city: string;\n    state: string;\n    country: string;\n    zipCode?: string;\n  };\n  principal?: {\n    name: string;\n    email: string;\n    phone?: string;\n  };\n  logo?: string;\n  website?: string;\n  established?: Date;\n  type: 'primary' | 'secondary' | 'higher-secondary' | 'university' | 'institute';\n  board?: string; // CBSE, ICSE, State Board, etc.\n  isActive: boolean;\n  subscription?: {\n    plan: 'free' | 'basic' | 'premium' | 'enterprise';\n    startDate: Date;\n    endDate?: Date;\n    maxStudents?: number;\n    maxTeachers?: number;\n  };\n  stats?: {\n    totalStudents: number;\n    totalTeachers: number;\n    totalCourses: number;\n  };\n  createdAt: Date;\n  updatedAt: Date;\n}\n\nconst SchoolSchema = new Schema<ISchool>(\n  {\n    name: {\n      type: String,\n      required: [true, 'School name is required'],\n      trim: true,\n      maxlength: [200, 'School name cannot exceed 200 characters'],\n    },\n    code: {\n      type: String,\n      required: [true, 'School code is required'],\n      unique: true,\n      uppercase: true,\n      trim: true,\n      match: [/^[A-Z0-9]{4,10}$/, 'School code must be 4-10 alphanumeric characters'],\n    },\n    email: {\n      type: String,\n      required: [true, 'School email is required'],\n      unique: true,\n      lowercase: true,\n      trim: true,\n      match: [\n        /^\\w+([\\.-]?\\w+)*@\\w+([\\.-]?\\w+)*(\\.\\w{2,3})+$/,\n        'Please provide a valid email',\n      ],\n    },\n    phone: {\n      type: String,\n      trim: true,\n    },\n    address: {\n      street: String,\n      city: {\n        type: String,\n        required: [true, 'City is required'],\n      },\n      state: {\n        type: String,\n        required: [true, 'State is required'],\n      },\n      country: {\n        type: String,\n        required: [true, 'Country is required'],\n        default: 'India',\n      },\n      zipCode: String,\n    },\n    principal: {\n      name: String,\n      email: String,\n      phone: String,\n    },\n    logo: {\n      type: String,\n      default: '',\n    },\n    website: {\n      type: String,\n      trim: true,\n    },\n    established: {\n      type: Date,\n    },\n    type: {\n      type: String,\n      enum: ['primary', 'secondary', 'higher-secondary', 'university', 'institute'],\n      default: 'secondary',\n      required: true,\n    },\n    board: {\n      type: String,\n      default: 'CBSE',\n    },\n    isActive: {\n      type: Boolean,\n      default: true,\n    },\n    subscription: {\n      plan: {\n        type: String,\n        enum: ['free', 'basic', 'premium', 'enterprise'],\n        default: 'free',\n      },\n      startDate: {\n        type: Date,\n        default: Date.now,\n      },\n      endDate: Date,\n      maxStudents: {\n        type: Number,\n        default: 100,\n      },\n      maxTeachers: {\n        type: Number,\n        default: 10,\n      },\n    },\n    stats: {\n      totalStudents: {\n        type: Number,\n        default: 0,\n      },\n      totalTeachers: {\n        type: Number,\n        default: 0,\n      },\n      totalCourses: {\n        type: Number,\n        default: 0,\n      },\n    },\n  },\n  {\n    timestamps: true,\n  }\n);\n\n// Indexes for better query performance\n// Note: code and email already have indexes from schema definitions\nSchoolSchema.index({ isActive: 1 });\nSchoolSchema.index({ 'subscription.plan': 1 });\n\nconst School: Model<ISchool> =\n  mongoose.models.School || mongoose.model<ISchool>('School', SchoolSchema);\n\nexport default School;\n"],"names":[],"mappings":";;;;AAAA;;AA0CA,MAAM,eAAe,IAAI,mHAAM,CAC7B;IACE,MAAM;QACJ,MAAM;QACN,UAAU;YAAC;YAAM;SAA0B;QAC3C,MAAM;QACN,WAAW;YAAC;YAAK;SAA2C;IAC9D;IACA,MAAM;QACJ,MAAM;QACN,UAAU;YAAC;YAAM;SAA0B;QAC3C,QAAQ;QACR,WAAW;QACX,MAAM;QACN,OAAO;YAAC;YAAoB;SAAmD;IACjF;IACA,OAAO;QACL,MAAM;QACN,UAAU;YAAC;YAAM;SAA2B;QAC5C,QAAQ;QACR,WAAW;QACX,MAAM;QACN,OAAO;YACL;YACA;SACD;IACH;IACA,OAAO;QACL,MAAM;QACN,MAAM;IACR;IACA,SAAS;QACP,QAAQ;QACR,MAAM;YACJ,MAAM;YACN,UAAU;gBAAC;gBAAM;aAAmB;QACtC;QACA,OAAO;YACL,MAAM;YACN,UAAU;gBAAC;gBAAM;aAAoB;QACvC;QACA,SAAS;YACP,MAAM;YACN,UAAU;gBAAC;gBAAM;aAAsB;YACvC,SAAS;QACX;QACA,SAAS;IACX;IACA,WAAW;QACT,MAAM;QACN,OAAO;QACP,OAAO;IACT;IACA,MAAM;QACJ,MAAM;QACN,SAAS;IACX;IACA,SAAS;QACP,MAAM;QACN,MAAM;IACR;IACA,aAAa;QACX,MAAM;IACR;IACA,MAAM;QACJ,MAAM;QACN,MAAM;YAAC;YAAW;YAAa;YAAoB;YAAc;SAAY;QAC7E,SAAS;QACT,UAAU;IACZ;IACA,OAAO;QACL,MAAM;QACN,SAAS;IACX;IACA,UAAU;QACR,MAAM;QACN,SAAS;IACX;IACA,cAAc;QACZ,MAAM;YACJ,MAAM;YACN,MAAM;gBAAC;gBAAQ;gBAAS;gBAAW;aAAa;YAChD,SAAS;QACX;QACA,WAAW;YACT,MAAM;YACN,SAAS,KAAK,GAAG;QACnB;QACA,SAAS;QACT,aAAa;YACX,MAAM;YACN,SAAS;QACX;QACA,aAAa;YACX,MAAM;YACN,SAAS;QACX;IACF;IACA,OAAO;QACL,eAAe;YACb,MAAM;YACN,SAAS;QACX;QACA,eAAe;YACb,MAAM;YACN,SAAS;QACX;QACA,cAAc;YACZ,MAAM;YACN,SAAS;QACX;IACF;AACF,GACA;IACE,YAAY;AACd;AAGF,uCAAuC;AACvC,oEAAoE;AACpE,aAAa,KAAK,CAAC;IAAE,UAAU;AAAE;AACjC,aAAa,KAAK,CAAC;IAAE,qBAAqB;AAAE;AAE5C,MAAM,SACJ,oHAAQ,CAAC,MAAM,CAAC,MAAM,IAAI,oHAAQ,CAAC,KAAK,CAAU,UAAU;uCAE/C"}},
    {"offset": {"line": 446, "column": 0}, "map": {"version":3,"sources":["file:///E:/projects/edu-bridge-ai-platform/lib/models/Subject.ts"],"sourcesContent":["import mongoose, { Document, Schema } from 'mongoose';\n\nexport interface ISubject extends Document {\n  _id: string;\n  schoolId: mongoose.Types.ObjectId;\n  classId: mongoose.Types.ObjectId;\n  subjectName: string;\n  subjectCode?: string; // Optional subject code like \"MAT101\"\n  teacherId?: mongoose.Types.ObjectId;\n  description?: string;\n  totalLessons?: number;\n  isActive: boolean;\n  createdAt: Date;\n  updatedAt: Date;\n}\n\nconst SubjectSchema = new Schema<ISubject>(\n  {\n    schoolId: {\n      type: Schema.Types.ObjectId,\n      ref: 'School',\n      required: [true, 'School ID is required'],\n      index: true,\n    },\n    classId: {\n      type: Schema.Types.ObjectId,\n      ref: 'Class',\n      required: [true, 'Class ID is required'],\n      index: true,\n    },\n    subjectName: {\n      type: String,\n      required: [true, 'Subject name is required'],\n      trim: true,\n    },\n    subjectCode: {\n      type: String,\n      trim: true,\n      uppercase: true,\n    },\n    teacherId: {\n      type: Schema.Types.ObjectId,\n      ref: 'User',\n      index: true,\n    },\n    description: {\n      type: String,\n      trim: true,\n      maxlength: 500,\n    },\n    totalLessons: {\n      type: Number,\n      min: 0,\n    },\n    isActive: {\n      type: Boolean,\n      default: true,\n    },\n  },\n  {\n    timestamps: true,\n  }\n);\n\n// Compound index to ensure unique subject per class in a school\nSubjectSchema.index({ schoolId: 1, classId: 1, subjectName: 1 }, { unique: true });\n\n// Index for querying by teacher\nSubjectSchema.index({ teacherId: 1 });\n\nconst Subject = mongoose.models.Subject || mongoose.model<ISubject>('Subject', SubjectSchema);\n\nexport default Subject;\n"],"names":[],"mappings":";;;;AAAA;;AAgBA,MAAM,gBAAgB,IAAI,mHAAM,CAC9B;IACE,UAAU;QACR,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;YAAC;YAAM;SAAwB;QACzC,OAAO;IACT;IACA,SAAS;QACP,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;YAAC;YAAM;SAAuB;QACxC,OAAO;IACT;IACA,aAAa;QACX,MAAM;QACN,UAAU;YAAC;YAAM;SAA2B;QAC5C,MAAM;IACR;IACA,aAAa;QACX,MAAM;QACN,MAAM;QACN,WAAW;IACb;IACA,WAAW;QACT,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,OAAO;IACT;IACA,aAAa;QACX,MAAM;QACN,MAAM;QACN,WAAW;IACb;IACA,cAAc;QACZ,MAAM;QACN,KAAK;IACP;IACA,UAAU;QACR,MAAM;QACN,SAAS;IACX;AACF,GACA;IACE,YAAY;AACd;AAGF,gEAAgE;AAChE,cAAc,KAAK,CAAC;IAAE,UAAU;IAAG,SAAS;IAAG,aAAa;AAAE,GAAG;IAAE,QAAQ;AAAK;AAEhF,gCAAgC;AAChC,cAAc,KAAK,CAAC;IAAE,WAAW;AAAE;AAEnC,MAAM,UAAU,oHAAQ,CAAC,MAAM,CAAC,OAAO,IAAI,oHAAQ,CAAC,KAAK,CAAW,WAAW;uCAEhE"}},
    {"offset": {"line": 523, "column": 0}, "map": {"version":3,"sources":["file:///E:/projects/edu-bridge-ai-platform/lib/models/User.ts"],"sourcesContent":["import mongoose, { Document, Model, Schema } from 'mongoose';\n\nexport interface IUser extends Document {\n  _id: string;\n  name: string;\n  email: string;\n  password: string;\n  role: 'super-admin' | 'principal' | 'teacher' | 'student';\n  schoolId?: mongoose.Types.ObjectId;\n  avatar?: string;\n  bio?: string;\n  phone?: string;\n  isActive: boolean;\n  // Teacher-specific fields\n  subjectSpecialization?: string;\n  teacherRole?: 'Teacher' | 'HOD' | 'Vice Principal';\n  assignedClasses?: mongoose.Types.ObjectId[]; // Array of Class IDs\n  assignedSubjects?: mongoose.Types.ObjectId[]; // Array of Subject IDs\n  // Student-specific fields\n  classId?: mongoose.Types.ObjectId; // Reference to Class model\n  rollNo?: number;\n  parentName?: string;\n  parentPhone?: string;\n  // Legacy fields (for backward compatibility)\n  className?: string; // e.g., '10-A'\n  section?: string; // e.g., 'A', 'B', 'C', 'D', 'E'\n  rollNumber?: string;\n  enrolledCourses?: mongoose.Types.ObjectId[];\n  // Teacher fields\n  createdCourses?: mongoose.Types.ObjectId[];\n  progress?: {\n    courseId: mongoose.Types.ObjectId;\n    completedLessons: number;\n    totalLessons: number;\n    lastAccessed: Date;\n  }[];\n  createdAt: Date;\n  updatedAt: Date;\n}\n\nconst UserSchema = new Schema<IUser>(\n  {\n    name: {\n      type: String,\n      required: [true, 'Please provide a name'],\n      trim: true,\n      maxlength: [100, 'Name cannot be more than 100 characters'],\n    },\n    email: {\n      type: String,\n      required: [true, 'Please provide an email'],\n      unique: true,\n      lowercase: true,\n      trim: true,\n      match: [\n        /^\\w+([\\.-]?\\w+)*@\\w+([\\.-]?\\w+)*(\\.\\w{2,3})+$/,\n        'Please provide a valid email',\n      ],\n    },\n    password: {\n      type: String,\n      required: [true, 'Please provide a password'],\n      minlength: [6, 'Password must be at least 6 characters'],\n      select: false, // Don't return password by default\n    },\n    role: {\n      type: String,\n      enum: ['super-admin', 'principal', 'teacher', 'student'],\n      default: 'student',\n      required: true,\n    },\n    schoolId: {\n      type: Schema.Types.ObjectId,\n      ref: 'School',\n    },\n    avatar: {\n      type: String,\n      default: '',\n    },\n    bio: {\n      type: String,\n      maxlength: [500, 'Bio cannot be more than 500 characters'],\n    },\n    phone: {\n      type: String,\n      trim: true,\n    },\n    isActive: {\n      type: Boolean,\n      default: true,\n    },\n    // Teacher-specific fields\n    subjectSpecialization: {\n      type: String,\n      trim: true,\n    },\n    teacherRole: {\n      type: String,\n      enum: ['Teacher', 'HOD', 'Vice Principal'],\n    },\n    assignedClasses: [\n      {\n        type: Schema.Types.ObjectId,\n        ref: 'Class',\n      },\n    ],\n    assignedSubjects: [\n      {\n        type: Schema.Types.ObjectId,\n        ref: 'Subject',\n      },\n    ],\n    // Student-specific fields\n    classId: {\n      type: Schema.Types.ObjectId,\n      ref: 'Class',\n      index: true,\n    },\n    rollNo: {\n      type: Number,\n      min: 1,\n    },\n    parentName: {\n      type: String,\n      trim: true,\n    },\n    parentPhone: {\n      type: String,\n      trim: true,\n    },\n    // Legacy fields (backward compatibility)\n    className: {\n      type: String,\n      trim: true,\n    },\n    section: {\n      type: String,\n      trim: true,\n    },\n    rollNumber: {\n      type: String,\n      trim: true,\n    },\n    enrolledCourses: [\n      {\n        type: Schema.Types.ObjectId,\n        ref: 'Course',\n      },\n    ],\n    createdCourses: [\n      {\n        type: Schema.Types.ObjectId,\n        ref: 'Course',\n      },\n    ],\n    progress: [\n      {\n        courseId: {\n          type: Schema.Types.ObjectId,\n          ref: 'Course',\n        },\n        completedLessons: {\n          type: Number,\n          default: 0,\n        },\n        totalLessons: {\n          type: Number,\n          default: 0,\n        },\n        lastAccessed: {\n          type: Date,\n          default: Date.now,\n        },\n      },\n    ],\n  },\n  {\n    timestamps: true,\n  }\n);\n\n// Indexes for better query performance\nUserSchema.index({ role: 1 });\nUserSchema.index({ schoolId: 1, role: 1 });\n// email already has unique index from schema definition\n\nconst User: Model<IUser> =\n  mongoose.models.User || mongoose.model<IUser>('User', UserSchema);\n\nexport default User;\n"],"names":[],"mappings":";;;;AAAA;;AAwCA,MAAM,aAAa,IAAI,mHAAM,CAC3B;IACE,MAAM;QACJ,MAAM;QACN,UAAU;YAAC;YAAM;SAAwB;QACzC,MAAM;QACN,WAAW;YAAC;YAAK;SAA0C;IAC7D;IACA,OAAO;QACL,MAAM;QACN,UAAU;YAAC;YAAM;SAA0B;QAC3C,QAAQ;QACR,WAAW;QACX,MAAM;QACN,OAAO;YACL;YACA;SACD;IACH;IACA,UAAU;QACR,MAAM;QACN,UAAU;YAAC;YAAM;SAA4B;QAC7C,WAAW;YAAC;YAAG;SAAyC;QACxD,QAAQ;IACV;IACA,MAAM;QACJ,MAAM;QACN,MAAM;YAAC;YAAe;YAAa;YAAW;SAAU;QACxD,SAAS;QACT,UAAU;IACZ;IACA,UAAU;QACR,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;IACP;IACA,QAAQ;QACN,MAAM;QACN,SAAS;IACX;IACA,KAAK;QACH,MAAM;QACN,WAAW;YAAC;YAAK;SAAyC;IAC5D;IACA,OAAO;QACL,MAAM;QACN,MAAM;IACR;IACA,UAAU;QACR,MAAM;QACN,SAAS;IACX;IACA,0BAA0B;IAC1B,uBAAuB;QACrB,MAAM;QACN,MAAM;IACR;IACA,aAAa;QACX,MAAM;QACN,MAAM;YAAC;YAAW;YAAO;SAAiB;IAC5C;IACA,iBAAiB;QACf;YACE,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;YAC3B,KAAK;QACP;KACD;IACD,kBAAkB;QAChB;YACE,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;YAC3B,KAAK;QACP;KACD;IACD,0BAA0B;IAC1B,SAAS;QACP,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,OAAO;IACT;IACA,QAAQ;QACN,MAAM;QACN,KAAK;IACP;IACA,YAAY;QACV,MAAM;QACN,MAAM;IACR;IACA,aAAa;QACX,MAAM;QACN,MAAM;IACR;IACA,yCAAyC;IACzC,WAAW;QACT,MAAM;QACN,MAAM;IACR;IACA,SAAS;QACP,MAAM;QACN,MAAM;IACR;IACA,YAAY;QACV,MAAM;QACN,MAAM;IACR;IACA,iBAAiB;QACf;YACE,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;YAC3B,KAAK;QACP;KACD;IACD,gBAAgB;QACd;YACE,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;YAC3B,KAAK;QACP;KACD;IACD,UAAU;QACR;YACE,UAAU;gBACR,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;gBAC3B,KAAK;YACP;YACA,kBAAkB;gBAChB,MAAM;gBACN,SAAS;YACX;YACA,cAAc;gBACZ,MAAM;gBACN,SAAS;YACX;YACA,cAAc;gBACZ,MAAM;gBACN,SAAS,KAAK,GAAG;YACnB;QACF;KACD;AACH,GACA;IACE,YAAY;AACd;AAGF,uCAAuC;AACvC,WAAW,KAAK,CAAC;IAAE,MAAM;AAAE;AAC3B,WAAW,KAAK,CAAC;IAAE,UAAU;IAAG,MAAM;AAAE;AACxC,wDAAwD;AAExD,MAAM,OACJ,oHAAQ,CAAC,MAAM,CAAC,IAAI,IAAI,oHAAQ,CAAC,KAAK,CAAQ,QAAQ;uCAEzC"}},
    {"offset": {"line": 714, "column": 0}, "map": {"version":3,"sources":["file:///E:/projects/edu-bridge-ai-platform/app/api/super-admin/analytics/route.ts"],"sourcesContent":["import connectDB from '@/lib/mongodb'\nimport Class from '@/lib/models/Class'\nimport Exam from '@/lib/models/Exam'\nimport School from '@/lib/models/School'\nimport Subject from '@/lib/models/Subject'\nimport User from '@/lib/models/User'\nimport { NextRequest, NextResponse } from 'next/server'\n\nexport async function GET(request: NextRequest) {\n  try {\n    await connectDB()\n\n    // Basic stats\n    const [\n      totalSchools,\n      activeSchools,\n      totalStudents,\n      totalTeachers,\n      totalPrincipals,\n      totalClasses,\n      totalSubjects,\n      totalExams\n    ] = await Promise.all([\n      School.countDocuments(),\n      School.countDocuments({ isActive: true }),\n      User.countDocuments({ role: 'student' }),\n      User.countDocuments({ role: 'teacher' }),\n      User.countDocuments({ role: 'principal' }),\n      Class.countDocuments(),\n      Subject.countDocuments(),\n      Exam.countDocuments()\n    ])\n\n    // Students per school\n    const studentsBySchoolData = await User.aggregate([\n      { $match: { role: 'student' } },\n      {\n        $lookup: {\n          from: 'schools',\n          localField: 'schoolId',\n          foreignField: '_id',\n          as: 'school'\n        }\n      },\n      { $unwind: '$school' },\n      {\n        $group: {\n          _id: '$school.name',\n          students: { $sum: 1 }\n        }\n      },\n      { $project: { school: '$_id', students: 1, _id: 0 } },\n      { $sort: { school: 1 } }\n    ])\n\n    // Teachers per school\n    const teachersBySchoolData = await User.aggregate([\n      { $match: { role: 'teacher' } },\n      {\n        $lookup: {\n          from: 'schools',\n          localField: 'schoolId',\n          foreignField: '_id',\n          as: 'school'\n        }\n      },\n      { $unwind: '$school' },\n      {\n        $group: {\n          _id: '$school.name',\n          teachers: { $sum: 1 }\n        }\n      },\n      { $project: { school: '$_id', teachers: 1, _id: 0 } },\n      { $sort: { school: 1 } }\n    ])\n\n    // Students by grade (using className from Class)\n    const studentsByGradeData = await User.aggregate([\n      { $match: { role: 'student' } },\n      {\n        $lookup: {\n          from: 'classes',\n          localField: 'classId',\n          foreignField: '_id',\n          as: 'class'\n        }\n      },\n      { $unwind: '$class' },\n      {\n        $group: {\n          _id: '$class.className',\n          students: { $sum: 1 }\n        }\n      },\n      { $project: { grade: '$_id', students: 1, _id: 0 } },\n      { $sort: { grade: 1 } }\n    ])\n\n    // Schools by board\n    const schoolsByBoardData = await School.aggregate([\n      {\n        $group: {\n          _id: '$board',\n          count: { $sum: 1 }\n        }\n      },\n      { $project: { name: '$_id', value: '$count', _id: 0 } }\n    ])\n\n    // Calculate average class size\n    const classStrengths = await Class.aggregate([\n      {\n        $group: {\n          _id: null,\n          avgStrength: { $avg: '$strength' }\n        }\n      }\n    ])\n    const avgClassSize = classStrengths[0]?.avgStrength \n      ? Math.round(classStrengths[0].avgStrength) \n      : 0\n\n    // Student-teacher ratio\n    const studentTeacherRatio = totalTeachers > 0 \n      ? `${Math.round(totalStudents / totalTeachers)}:1`\n      : '0:1'\n\n    const analytics = {\n      stats: {\n        totalSchools,\n        activeSchools,\n        totalStudents,\n        totalTeachers,\n        totalPrincipals,\n        totalClasses,\n        totalSubjects,\n        totalExams,\n        avgClassSize,\n        studentTeacherRatio\n      },\n      studentsBySchool: studentsBySchoolData,\n      teachersBySchool: teachersBySchoolData,\n      studentsByGrade: studentsByGradeData,\n      schoolsByBoard: schoolsByBoardData\n    }\n\n    return NextResponse.json({\n      success: true,\n      analytics\n    })\n  } catch (error: any) {\n    console.error('Error fetching analytics:', error)\n    return NextResponse.json(\n      { success: false, error: error.message },\n      { status: 500 }\n    )\n  }\n}\n"],"names":[],"mappings":"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"}}]
}