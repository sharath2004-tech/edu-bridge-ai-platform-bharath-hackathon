{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///E:/projects/edu-bridge-ai-platform/lib/permissions.ts"],"sourcesContent":["/**\n * Role-Based Access Control (RBAC) System\n * \n * Role Hierarchy:\n * 1. Super Admin - Platform owner, manages all schools\n * 2. Principal - School-level admin, manages their school\n * 3. Teacher - Manages assigned classes and subjects\n * 4. Student - View-only access to their own data\n */\n\nexport type UserRole = 'super-admin' | 'principal' | 'teacher' | 'student';\n\nexport interface Permission {\n  resource: string;\n  action: 'create' | 'read' | 'update' | 'delete' | 'manage';\n  scope?: 'all' | 'school' | 'own' | 'assigned';\n}\n\n// Define permissions for each role\nexport const rolePermissions: Record<UserRole, Permission[]> = {\n  'super-admin': [\n    // Full platform access\n    { resource: 'schools', action: 'manage', scope: 'all' },\n    { resource: 'users', action: 'manage', scope: 'all' },\n    { resource: 'principals', action: 'create', scope: 'all' },\n    { resource: 'principals', action: 'manage', scope: 'all' },\n    { resource: 'billing', action: 'manage', scope: 'all' },\n    { resource: 'analytics', action: 'read', scope: 'all' },\n    { resource: 'reports', action: 'read', scope: 'all' },\n    { resource: 'school-registrations', action: 'manage', scope: 'all' },\n  ],\n  \n  'principal': [\n    // School-level management\n    { resource: 'school', action: 'read', scope: 'own' },\n    { resource: 'school', action: 'update', scope: 'own' },\n    { resource: 'teachers', action: 'create', scope: 'school' },\n    { resource: 'teachers', action: 'manage', scope: 'school' },\n    { resource: 'students', action: 'create', scope: 'school' },\n    { resource: 'students', action: 'manage', scope: 'school' },\n    { resource: 'classes', action: 'manage', scope: 'school' },\n    { resource: 'subjects', action: 'manage', scope: 'school' },\n    { resource: 'attendance', action: 'read', scope: 'school' },\n    { resource: 'marks', action: 'read', scope: 'school' },\n    { resource: 'reports', action: 'read', scope: 'school' },\n    { resource: 'stats', action: 'read', scope: 'school' },\n    { resource: 'analytics', action: 'read', scope: 'school' },\n    { resource: 'timetable', action: 'manage', scope: 'school' },\n    { resource: 'courses', action: 'manage', scope: 'school' },\n  ],\n  \n  'teacher': [\n    // Class and subject specific access\n    { resource: 'school', action: 'read', scope: 'own' }, // Read-only school info\n    { resource: 'students', action: 'read', scope: 'assigned' }, // Only their class students\n    { resource: 'classes', action: 'read', scope: 'assigned' },\n    { resource: 'subjects', action: 'read', scope: 'assigned' },\n    { resource: 'homework', action: 'manage', scope: 'assigned' },\n    { resource: 'attendance', action: 'create', scope: 'assigned' },\n    { resource: 'attendance', action: 'read', scope: 'assigned' },\n    { resource: 'marks', action: 'create', scope: 'assigned' },\n    { resource: 'marks', action: 'update', scope: 'assigned' },\n    { resource: 'marks', action: 'read', scope: 'assigned' },\n    { resource: 'timetable', action: 'read', scope: 'assigned' },\n    { resource: 'courses', action: 'read', scope: 'assigned' },\n    { resource: 'quizzes', action: 'read', scope: 'assigned' }, // View quiz responses\n  ],\n  \n  'student': [\n    // Personal dashboard only\n    { resource: 'profile', action: 'read', scope: 'own' },\n    { resource: 'profile', action: 'update', scope: 'own' },\n    { resource: 'class', action: 'read', scope: 'own' },\n    { resource: 'subjects', action: 'read', scope: 'own' },\n    { resource: 'teachers', action: 'read', scope: 'own' },\n    { resource: 'homework', action: 'read', scope: 'own' },\n    { resource: 'attendance', action: 'read', scope: 'own' },\n    { resource: 'marks', action: 'read', scope: 'own' },\n    { resource: 'timetable', action: 'read', scope: 'own' },\n    { resource: 'courses', action: 'read', scope: 'own' },\n    { resource: 'quizzes', action: 'read', scope: 'own' },\n    { resource: 'quizzes', action: 'create', scope: 'own' }, // Submit quiz responses\n    { resource: 'school', action: 'read', scope: 'own' }, // Basic school info only\n  ],\n};\n\n/**\n * Check if a user has permission to perform an action\n */\nexport function hasPermission(\n  userRole: UserRole,\n  resource: string,\n  action: 'create' | 'read' | 'update' | 'delete' | 'manage',\n  scope?: 'all' | 'school' | 'own' | 'assigned'\n): boolean {\n  const permissions = rolePermissions[userRole];\n  \n  return permissions.some(permission => {\n    // Check if resource matches\n    const resourceMatch = permission.resource === resource;\n    \n    // Check if action matches (manage includes all actions)\n    const actionMatch = \n      permission.action === action || \n      permission.action === 'manage';\n    \n    // Check if scope matches (if scope is specified)\n    const scopeMatch = !scope || permission.scope === scope || permission.scope === 'all';\n    \n    return resourceMatch && actionMatch && scopeMatch;\n  });\n}\n\n/**\n * Check if user can access a school's data\n */\nexport function canAccessSchool(\n  userRole: UserRole,\n  userSchoolId: string | undefined,\n  targetSchoolId: string\n): boolean {\n  // Super admin can access all schools\n  if (userRole === 'super-admin') {\n    return true;\n  }\n  \n  // Others can only access their own school\n  return userSchoolId === targetSchoolId;\n}\n\n/**\n * Check if user can access another user's data\n */\nexport function canAccessUser(\n  userRole: UserRole,\n  userId: string,\n  targetUserId: string,\n  userSchoolId: string | undefined,\n  targetUserSchoolId: string | undefined,\n  targetUserRole?: UserRole\n): boolean {\n  // Super admin can access all users\n  if (userRole === 'super-admin') {\n    return true;\n  }\n  \n  // Users can always access their own data\n  if (userId === targetUserId) {\n    return true;\n  }\n  \n  // Principal can access all users in their school\n  if (userRole === 'principal' && userSchoolId === targetUserSchoolId) {\n    return true;\n  }\n  \n  // Teachers can access students in their school (will be further filtered by assigned classes)\n  if (\n    userRole === 'teacher' && \n    targetUserRole === 'student' && \n    userSchoolId === targetUserSchoolId\n  ) {\n    return true;\n  }\n  \n  return false;\n}\n\n/**\n * Filter data based on user's role and scope\n */\nexport function getAccessibleSchoolIds(\n  userRole: UserRole,\n  userSchoolId: string | undefined\n): string[] | 'all' {\n  if (userRole === 'super-admin') {\n    return 'all';\n  }\n  \n  if (userSchoolId) {\n    return [userSchoolId];\n  }\n  \n  return [];\n}\n\n/**\n * Get user-friendly role names\n */\nexport const roleLabels: Record<UserRole, string> = {\n  'super-admin': 'Super Administrator',\n  'principal': 'Principal / Head of School',\n  'teacher': 'Teacher',\n  'student': 'Student',\n};\n\n/**\n * Get role descriptions\n */\nexport const roleDescriptions: Record<UserRole, string> = {\n  'super-admin': 'Platform owner with full access to all schools and features',\n  'principal': 'School administrator with full control over their school',\n  'teacher': 'Can manage assigned classes, subjects, and student data',\n  'student': 'View-only access to personal academic information',\n};\n\n/**\n * Get dashboard route based on role\n */\nexport function getDashboardRoute(role: UserRole): string {\n  switch (role) {\n    case 'super-admin':\n      return '/admin/dashboard';\n    case 'principal':\n      return '/principal/dashboard';\n    case 'teacher':\n      return '/teacher/dashboard';\n    case 'student':\n      return '/student/dashboard';\n    default:\n      return '/';\n  }\n}\n\n/**\n * Check if role can create users of target role\n */\nexport function canCreateRole(\n  userRole: UserRole,\n  targetRole: UserRole\n): boolean {\n  if (userRole === 'super-admin') {\n    // Super admin can create principals and approve schools\n    return ['principal', 'super-admin'].includes(targetRole);\n  }\n  \n  if (userRole === 'principal') {\n    // Principal can create teachers and students\n    return ['teacher', 'student'].includes(targetRole);\n  }\n  \n  return false;\n}\n\n/**\n * Middleware helper for API routes\n */\nexport function requireRole(allowedRoles: UserRole[]) {\n  return (userRole: UserRole) => {\n    return allowedRoles.includes(userRole);\n  };\n}\n\n/**\n * Check if user has elevated privileges\n */\nexport function isAdmin(role: UserRole): boolean {\n  return ['super-admin', 'principal'].includes(role);\n}\n\n/**\n * Check if user is super admin\n */\nexport function isSuperAdmin(role: UserRole): boolean {\n  return role === 'super-admin';\n}\n\n/**\n * Check if user is principal\n */\nexport function isPrincipal(role: UserRole): boolean {\n  return role === 'principal';\n}\n\n/**\n * Check if user is teacher\n */\nexport function isTeacher(role: UserRole): boolean {\n  return role === 'teacher';\n}\n\n/**\n * Check if user is student\n */\nexport function isStudent(role: UserRole): boolean {\n  return role === 'student';\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 465, "column": 0}, "map": {"version":3,"sources":["file:///E:/projects/edu-bridge-ai-platform/lib/auth-middleware.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { UserRole, canAccessSchool, hasPermission } from './permissions';\n\nexport interface AuthUser {\n  id: string;\n  role: UserRole;\n  name: string;\n  email: string;\n  schoolId?: string;\n}\n\n/**\n * Get authenticated user from request cookies\n */\nexport function getAuthUser(request: NextRequest): AuthUser | null {\n  try {\n    const cookie = request.cookies.get('edubridge_session');\n    if (!cookie?.value) {\n      return null;\n    }\n    \n    const session = JSON.parse(cookie.value);\n    return {\n      id: session.id,\n      role: session.role as UserRole,\n      name: session.name,\n      email: session.email,\n      schoolId: session.schoolId,\n    };\n  } catch (error) {\n    return null;\n  }\n}\n\n/**\n * Require authentication - returns 401 if not authenticated\n */\nexport function requireAuth(request: NextRequest): AuthUser | NextResponse {\n  const user = getAuthUser(request);\n  \n  if (!user) {\n    return NextResponse.json(\n      { success: false, error: 'Authentication required' },\n      { status: 401 }\n    );\n  }\n  \n  return user;\n}\n\n/**\n * Require specific role(s) - returns 403 if not authorized\n */\nexport function requireRoles(\n  user: AuthUser,\n  allowedRoles: UserRole[]\n): true | NextResponse {\n  if (!allowedRoles.includes(user.role)) {\n    return NextResponse.json(\n      { \n        success: false, \n        error: 'Insufficient permissions',\n        message: `This action requires one of the following roles: ${allowedRoles.join(', ')}`\n      },\n      { status: 403 }\n    );\n  }\n  \n  return true;\n}\n\n/**\n * Require permission for a resource and action\n */\nexport function requirePermission(\n  user: AuthUser,\n  resource: string,\n  action: 'create' | 'read' | 'update' | 'delete' | 'manage',\n  scope?: 'all' | 'school' | 'own' | 'assigned'\n): true | NextResponse {\n  if (!hasPermission(user.role, resource, action, scope)) {\n    return NextResponse.json(\n      { \n        success: false, \n        error: 'Insufficient permissions',\n        message: `You don't have permission to ${action} ${resource}`\n      },\n      { status: 403 }\n    );\n  }\n  \n  return true;\n}\n\n/**\n * Require school access - returns 403 if user can't access the school\n */\nexport function requireSchoolAccess(\n  user: AuthUser,\n  targetSchoolId: string\n): true | NextResponse {\n  if (!canAccessSchool(user.role, user.schoolId, targetSchoolId)) {\n    return NextResponse.json(\n      { \n        success: false, \n        error: 'Access denied',\n        message: 'You do not have access to this school'\n      },\n      { status: 403 }\n    );\n  }\n  \n  return true;\n}\n\n/**\n * Require same school - ensures user and target are in same school\n */\nexport function requireSameSchool(\n  user: AuthUser,\n  targetSchoolId: string | undefined\n): true | NextResponse {\n  // Super admin can access all schools\n  if (user.role === 'super-admin') {\n    return true;\n  }\n  \n  if (!user.schoolId || !targetSchoolId) {\n    return NextResponse.json(\n      { \n        success: false, \n        error: 'School information missing',\n      },\n      { status: 400 }\n    );\n  }\n  \n  if (user.schoolId !== targetSchoolId) {\n    return NextResponse.json(\n      { \n        success: false, \n        error: 'Access denied',\n        message: 'You can only access users in your school'\n      },\n      { status: 403 }\n    );\n  }\n  \n  return true;\n}\n\n/**\n * Helper to handle auth checks in API routes\n * Returns user if all checks pass, otherwise returns NextResponse error\n */\nexport function authenticateAndAuthorize(\n  request: NextRequest,\n  options: {\n    requiredRoles?: UserRole[];\n    resource?: string;\n    action?: 'create' | 'read' | 'update' | 'delete' | 'manage';\n    scope?: 'all' | 'school' | 'own' | 'assigned';\n  } = {}\n): AuthUser | NextResponse {\n  // Check authentication\n  const authResult = requireAuth(request);\n  if (authResult instanceof NextResponse) {\n    return authResult;\n  }\n  \n  const user = authResult;\n  \n  // Check role if specified\n  if (options.requiredRoles) {\n    const roleCheck = requireRoles(user, options.requiredRoles);\n    if (roleCheck instanceof NextResponse) {\n      return roleCheck;\n    }\n  }\n  \n  // Check permission if specified\n  if (options.resource && options.action) {\n    const permCheck = requirePermission(\n      user,\n      options.resource,\n      options.action,\n      options.scope\n    );\n    if (permCheck instanceof NextResponse) {\n      return permCheck;\n    }\n  }\n  \n  return user;\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 608, "column": 0}, "map": {"version":3,"sources":["file:///E:/projects/edu-bridge-ai-platform/lib/models/School.ts"],"sourcesContent":["import mongoose, { Document, Model, Schema } from 'mongoose';\n\nexport interface ISchool extends Document {\n  _id: string;\n  name: string;\n  code: string; // Unique school code for registration\n  email: string;\n  phone?: string;\n  address: {\n    street?: string;\n    city: string;\n    state: string;\n    country: string;\n    zipCode?: string;\n  };\n  principal?: {\n    name: string;\n    email: string;\n    phone?: string;\n  };\n  logo?: string;\n  website?: string;\n  established?: Date;\n  type: 'primary' | 'secondary' | 'higher-secondary' | 'university' | 'institute';\n  board?: string; // CBSE, ICSE, State Board, etc.\n  isActive: boolean;\n  subscription?: {\n    plan: 'free' | 'basic' | 'premium' | 'enterprise';\n    startDate: Date;\n    endDate?: Date;\n    maxStudents?: number;\n    maxTeachers?: number;\n  };\n  stats?: {\n    totalStudents: number;\n    totalTeachers: number;\n    totalCourses: number;\n  };\n  createdAt: Date;\n  updatedAt: Date;\n}\n\nconst SchoolSchema = new Schema<ISchool>(\n  {\n    name: {\n      type: String,\n      required: [true, 'School name is required'],\n      trim: true,\n      maxlength: [200, 'School name cannot exceed 200 characters'],\n    },\n    code: {\n      type: String,\n      required: [true, 'School code is required'],\n      unique: true,\n      uppercase: true,\n      trim: true,\n      match: [/^[A-Z0-9]{4,10}$/, 'School code must be 4-10 alphanumeric characters'],\n    },\n    email: {\n      type: String,\n      required: [true, 'School email is required'],\n      unique: true,\n      lowercase: true,\n      trim: true,\n      match: [\n        /^\\w+([\\.-]?\\w+)*@\\w+([\\.-]?\\w+)*(\\.\\w{2,3})+$/,\n        'Please provide a valid email',\n      ],\n    },\n    phone: {\n      type: String,\n      trim: true,\n    },\n    address: {\n      street: String,\n      city: {\n        type: String,\n        required: [true, 'City is required'],\n      },\n      state: {\n        type: String,\n        required: [true, 'State is required'],\n      },\n      country: {\n        type: String,\n        required: [true, 'Country is required'],\n        default: 'India',\n      },\n      zipCode: String,\n    },\n    principal: {\n      name: String,\n      email: String,\n      phone: String,\n    },\n    logo: {\n      type: String,\n      default: '',\n    },\n    website: {\n      type: String,\n      trim: true,\n    },\n    established: {\n      type: Date,\n    },\n    type: {\n      type: String,\n      enum: ['primary', 'secondary', 'higher-secondary', 'university', 'institute'],\n      default: 'secondary',\n      required: true,\n    },\n    board: {\n      type: String,\n      default: 'CBSE',\n    },\n    isActive: {\n      type: Boolean,\n      default: true,\n    },\n    subscription: {\n      plan: {\n        type: String,\n        enum: ['free', 'basic', 'premium', 'enterprise'],\n        default: 'free',\n      },\n      startDate: {\n        type: Date,\n        default: Date.now,\n      },\n      endDate: Date,\n      maxStudents: {\n        type: Number,\n        default: 100,\n      },\n      maxTeachers: {\n        type: Number,\n        default: 10,\n      },\n    },\n    stats: {\n      totalStudents: {\n        type: Number,\n        default: 0,\n      },\n      totalTeachers: {\n        type: Number,\n        default: 0,\n      },\n      totalCourses: {\n        type: Number,\n        default: 0,\n      },\n    },\n  },\n  {\n    timestamps: true,\n  }\n);\n\n// Indexes for better query performance\n// Note: code and email already have indexes from schema definitions\nSchoolSchema.index({ isActive: 1 });\nSchoolSchema.index({ 'subscription.plan': 1 });\n\nconst School: Model<ISchool> =\n  mongoose.models.School || mongoose.model<ISchool>('School', SchoolSchema);\n\nexport default School;\n"],"names":[],"mappings":";;;;AAAA;;AA0CA,MAAM,eAAe,IAAI,mHAAM,CAC7B;IACE,MAAM;QACJ,MAAM;QACN,UAAU;YAAC;YAAM;SAA0B;QAC3C,MAAM;QACN,WAAW;YAAC;YAAK;SAA2C;IAC9D;IACA,MAAM;QACJ,MAAM;QACN,UAAU;YAAC;YAAM;SAA0B;QAC3C,QAAQ;QACR,WAAW;QACX,MAAM;QACN,OAAO;YAAC;YAAoB;SAAmD;IACjF;IACA,OAAO;QACL,MAAM;QACN,UAAU;YAAC;YAAM;SAA2B;QAC5C,QAAQ;QACR,WAAW;QACX,MAAM;QACN,OAAO;YACL;YACA;SACD;IACH;IACA,OAAO;QACL,MAAM;QACN,MAAM;IACR;IACA,SAAS;QACP,QAAQ;QACR,MAAM;YACJ,MAAM;YACN,UAAU;gBAAC;gBAAM;aAAmB;QACtC;QACA,OAAO;YACL,MAAM;YACN,UAAU;gBAAC;gBAAM;aAAoB;QACvC;QACA,SAAS;YACP,MAAM;YACN,UAAU;gBAAC;gBAAM;aAAsB;YACvC,SAAS;QACX;QACA,SAAS;IACX;IACA,WAAW;QACT,MAAM;QACN,OAAO;QACP,OAAO;IACT;IACA,MAAM;QACJ,MAAM;QACN,SAAS;IACX;IACA,SAAS;QACP,MAAM;QACN,MAAM;IACR;IACA,aAAa;QACX,MAAM;IACR;IACA,MAAM;QACJ,MAAM;QACN,MAAM;YAAC;YAAW;YAAa;YAAoB;YAAc;SAAY;QAC7E,SAAS;QACT,UAAU;IACZ;IACA,OAAO;QACL,MAAM;QACN,SAAS;IACX;IACA,UAAU;QACR,MAAM;QACN,SAAS;IACX;IACA,cAAc;QACZ,MAAM;YACJ,MAAM;YACN,MAAM;gBAAC;gBAAQ;gBAAS;gBAAW;aAAa;YAChD,SAAS;QACX;QACA,WAAW;YACT,MAAM;YACN,SAAS,KAAK,GAAG;QACnB;QACA,SAAS;QACT,aAAa;YACX,MAAM;YACN,SAAS;QACX;QACA,aAAa;YACX,MAAM;YACN,SAAS;QACX;IACF;IACA,OAAO;QACL,eAAe;YACb,MAAM;YACN,SAAS;QACX;QACA,eAAe;YACb,MAAM;YACN,SAAS;QACX;QACA,cAAc;YACZ,MAAM;YACN,SAAS;QACX;IACF;AACF,GACA;IACE,YAAY;AACd;AAGF,uCAAuC;AACvC,oEAAoE;AACpE,aAAa,KAAK,CAAC;IAAE,UAAU;AAAE;AACjC,aAAa,KAAK,CAAC;IAAE,qBAAqB;AAAE;AAE5C,MAAM,SACJ,oHAAQ,CAAC,MAAM,CAAC,MAAM,IAAI,oHAAQ,CAAC,KAAK,CAAU,UAAU;uCAE/C"}},
    {"offset": {"line": 777, "column": 0}, "map": {"version":3,"sources":["file:///E:/projects/edu-bridge-ai-platform/lib/models/User.ts"],"sourcesContent":["import mongoose, { Document, Model, Schema } from 'mongoose';\n\nexport interface IUser extends Document {\n  _id: string;\n  name: string;\n  email: string;\n  password: string;\n  role: 'super-admin' | 'principal' | 'teacher' | 'student';\n  schoolId?: mongoose.Types.ObjectId;\n  avatar?: string;\n  bio?: string;\n  phone?: string;\n  isActive: boolean;\n  // Teacher-specific fields\n  subjectSpecialization?: string;\n  teacherRole?: 'Teacher' | 'HOD' | 'Vice Principal';\n  assignedClasses?: mongoose.Types.ObjectId[]; // Array of Class IDs\n  assignedSubjects?: mongoose.Types.ObjectId[]; // Array of Subject IDs\n  // Student-specific fields\n  classId?: mongoose.Types.ObjectId; // Reference to Class model\n  rollNo?: number;\n  parentName?: string;\n  parentPhone?: string;\n  // Legacy fields (for backward compatibility)\n  className?: string; // e.g., '10-A'\n  section?: string; // e.g., 'A', 'B', 'C', 'D', 'E'\n  rollNumber?: string;\n  enrolledCourses?: mongoose.Types.ObjectId[];\n  // Teacher fields\n  createdCourses?: mongoose.Types.ObjectId[];\n  progress?: {\n    courseId: mongoose.Types.ObjectId;\n    completedLessons: number;\n    totalLessons: number;\n    lastAccessed: Date;\n  }[];\n  createdAt: Date;\n  updatedAt: Date;\n}\n\nconst UserSchema = new Schema<IUser>(\n  {\n    name: {\n      type: String,\n      required: [true, 'Please provide a name'],\n      trim: true,\n      maxlength: [100, 'Name cannot be more than 100 characters'],\n    },\n    email: {\n      type: String,\n      required: [true, 'Please provide an email'],\n      unique: true,\n      lowercase: true,\n      trim: true,\n      match: [\n        /^\\w+([\\.-]?\\w+)*@\\w+([\\.-]?\\w+)*(\\.\\w{2,3})+$/,\n        'Please provide a valid email',\n      ],\n    },\n    password: {\n      type: String,\n      required: [true, 'Please provide a password'],\n      minlength: [6, 'Password must be at least 6 characters'],\n      select: false, // Don't return password by default\n    },\n    role: {\n      type: String,\n      enum: ['super-admin', 'principal', 'teacher', 'student'],\n      default: 'student',\n      required: true,\n    },\n    schoolId: {\n      type: Schema.Types.ObjectId,\n      ref: 'School',\n    },\n    avatar: {\n      type: String,\n      default: '',\n    },\n    bio: {\n      type: String,\n      maxlength: [500, 'Bio cannot be more than 500 characters'],\n    },\n    phone: {\n      type: String,\n      trim: true,\n    },\n    isActive: {\n      type: Boolean,\n      default: true,\n    },\n    // Teacher-specific fields\n    subjectSpecialization: {\n      type: String,\n      trim: true,\n    },\n    teacherRole: {\n      type: String,\n      enum: ['Teacher', 'HOD', 'Vice Principal'],\n    },\n    assignedClasses: [\n      {\n        type: Schema.Types.ObjectId,\n        ref: 'Class',\n      },\n    ],\n    assignedSubjects: [\n      {\n        type: Schema.Types.ObjectId,\n        ref: 'Subject',\n      },\n    ],\n    // Student-specific fields\n    classId: {\n      type: Schema.Types.ObjectId,\n      ref: 'Class',\n      index: true,\n    },\n    rollNo: {\n      type: Number,\n      min: 1,\n    },\n    parentName: {\n      type: String,\n      trim: true,\n    },\n    parentPhone: {\n      type: String,\n      trim: true,\n    },\n    // Legacy fields (backward compatibility)\n    className: {\n      type: String,\n      trim: true,\n    },\n    section: {\n      type: String,\n      trim: true,\n    },\n    rollNumber: {\n      type: String,\n      trim: true,\n    },\n    enrolledCourses: [\n      {\n        type: Schema.Types.ObjectId,\n        ref: 'Course',\n      },\n    ],\n    createdCourses: [\n      {\n        type: Schema.Types.ObjectId,\n        ref: 'Course',\n      },\n    ],\n    progress: [\n      {\n        courseId: {\n          type: Schema.Types.ObjectId,\n          ref: 'Course',\n        },\n        completedLessons: {\n          type: Number,\n          default: 0,\n        },\n        totalLessons: {\n          type: Number,\n          default: 0,\n        },\n        lastAccessed: {\n          type: Date,\n          default: Date.now,\n        },\n      },\n    ],\n  },\n  {\n    timestamps: true,\n  }\n);\n\n// Indexes for better query performance\nUserSchema.index({ role: 1 });\nUserSchema.index({ schoolId: 1, role: 1 });\n// email already has unique index from schema definition\n\nconst User: Model<IUser> =\n  mongoose.models.User || mongoose.model<IUser>('User', UserSchema);\n\nexport default User;\n"],"names":[],"mappings":";;;;AAAA;;AAwCA,MAAM,aAAa,IAAI,mHAAM,CAC3B;IACE,MAAM;QACJ,MAAM;QACN,UAAU;YAAC;YAAM;SAAwB;QACzC,MAAM;QACN,WAAW;YAAC;YAAK;SAA0C;IAC7D;IACA,OAAO;QACL,MAAM;QACN,UAAU;YAAC;YAAM;SAA0B;QAC3C,QAAQ;QACR,WAAW;QACX,MAAM;QACN,OAAO;YACL;YACA;SACD;IACH;IACA,UAAU;QACR,MAAM;QACN,UAAU;YAAC;YAAM;SAA4B;QAC7C,WAAW;YAAC;YAAG;SAAyC;QACxD,QAAQ;IACV;IACA,MAAM;QACJ,MAAM;QACN,MAAM;YAAC;YAAe;YAAa;YAAW;SAAU;QACxD,SAAS;QACT,UAAU;IACZ;IACA,UAAU;QACR,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;IACP;IACA,QAAQ;QACN,MAAM;QACN,SAAS;IACX;IACA,KAAK;QACH,MAAM;QACN,WAAW;YAAC;YAAK;SAAyC;IAC5D;IACA,OAAO;QACL,MAAM;QACN,MAAM;IACR;IACA,UAAU;QACR,MAAM;QACN,SAAS;IACX;IACA,0BAA0B;IAC1B,uBAAuB;QACrB,MAAM;QACN,MAAM;IACR;IACA,aAAa;QACX,MAAM;QACN,MAAM;YAAC;YAAW;YAAO;SAAiB;IAC5C;IACA,iBAAiB;QACf;YACE,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;YAC3B,KAAK;QACP;KACD;IACD,kBAAkB;QAChB;YACE,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;YAC3B,KAAK;QACP;KACD;IACD,0BAA0B;IAC1B,SAAS;QACP,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,OAAO;IACT;IACA,QAAQ;QACN,MAAM;QACN,KAAK;IACP;IACA,YAAY;QACV,MAAM;QACN,MAAM;IACR;IACA,aAAa;QACX,MAAM;QACN,MAAM;IACR;IACA,yCAAyC;IACzC,WAAW;QACT,MAAM;QACN,MAAM;IACR;IACA,SAAS;QACP,MAAM;QACN,MAAM;IACR;IACA,YAAY;QACV,MAAM;QACN,MAAM;IACR;IACA,iBAAiB;QACf;YACE,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;YAC3B,KAAK;QACP;KACD;IACD,gBAAgB;QACd;YACE,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;YAC3B,KAAK;QACP;KACD;IACD,UAAU;QACR;YACE,UAAU;gBACR,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;gBAC3B,KAAK;YACP;YACA,kBAAkB;gBAChB,MAAM;gBACN,SAAS;YACX;YACA,cAAc;gBACZ,MAAM;gBACN,SAAS;YACX;YACA,cAAc;gBACZ,MAAM;gBACN,SAAS,KAAK,GAAG;YACnB;QACF;KACD;AACH,GACA;IACE,YAAY;AACd;AAGF,uCAAuC;AACvC,WAAW,KAAK,CAAC;IAAE,MAAM;AAAE;AAC3B,WAAW,KAAK,CAAC;IAAE,UAAU;IAAG,MAAM;AAAE;AACxC,wDAAwD;AAExD,MAAM,OACJ,oHAAQ,CAAC,MAAM,CAAC,IAAI,IAAI,oHAAQ,CAAC,KAAK,CAAQ,QAAQ;uCAEzC"}},
    {"offset": {"line": 962, "column": 0}, "map": {"version":3,"sources":["file:///E:/projects/edu-bridge-ai-platform/lib/models/Class.ts"],"sourcesContent":["import mongoose, { Document, Schema } from 'mongoose';\n\nexport interface IClass extends Document {\n  _id: string;\n  schoolId: mongoose.Types.ObjectId;\n  className: string; // e.g., \"LKG\", \"1st\", \"2nd\", \"10th\"\n  section: string; // e.g., \"A\", \"B\", \"C\"\n  classTeacherId?: mongoose.Types.ObjectId;\n  academicYear?: string; // e.g., \"2024-2025\"\n  strength?: number; // Total students in this class\n  createdAt: Date;\n  updatedAt: Date;\n}\n\nconst ClassSchema = new Schema<IClass>(\n  {\n    schoolId: {\n      type: Schema.Types.ObjectId,\n      ref: 'School',\n      required: [true, 'School ID is required'],\n      index: true,\n    },\n    className: {\n      type: String,\n      required: [true, 'Class name is required'],\n      trim: true,\n      // LKG, UKG, 1st, 2nd, 3rd, 4th, 5th, 6th, 7th, 8th, 9th, 10th, 11th, 12th\n    },\n    section: {\n      type: String,\n      required: [true, 'Section is required'],\n      trim: true,\n      uppercase: true,\n      // A, B, C, D, E, etc.\n    },\n    classTeacherId: {\n      type: Schema.Types.ObjectId,\n      ref: 'User',\n      index: true,\n    },\n    academicYear: {\n      type: String,\n      trim: true,\n    },\n    strength: {\n      type: Number,\n      default: 0,\n      min: 0,\n    },\n  },\n  {\n    timestamps: true,\n  }\n);\n\n// Compound index to ensure unique class-section per school\nClassSchema.index({ schoolId: 1, className: 1, section: 1 }, { unique: true });\n\n// Index for querying by class teacher\nClassSchema.index({ classTeacherId: 1 });\n\nconst Class = mongoose.models.Class || mongoose.model<IClass>('Class', ClassSchema);\n\nexport default Class;\n"],"names":[],"mappings":";;;;AAAA;;AAcA,MAAM,cAAc,IAAI,mHAAM,CAC5B;IACE,UAAU;QACR,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;YAAC;YAAM;SAAwB;QACzC,OAAO;IACT;IACA,WAAW;QACT,MAAM;QACN,UAAU;YAAC;YAAM;SAAyB;QAC1C,MAAM;IAER;IACA,SAAS;QACP,MAAM;QACN,UAAU;YAAC;YAAM;SAAsB;QACvC,MAAM;QACN,WAAW;IAEb;IACA,gBAAgB;QACd,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,OAAO;IACT;IACA,cAAc;QACZ,MAAM;QACN,MAAM;IACR;IACA,UAAU;QACR,MAAM;QACN,SAAS;QACT,KAAK;IACP;AACF,GACA;IACE,YAAY;AACd;AAGF,2DAA2D;AAC3D,YAAY,KAAK,CAAC;IAAE,UAAU;IAAG,WAAW;IAAG,SAAS;AAAE,GAAG;IAAE,QAAQ;AAAK;AAE5E,sCAAsC;AACtC,YAAY,KAAK,CAAC;IAAE,gBAAgB;AAAE;AAEtC,MAAM,QAAQ,oHAAQ,CAAC,MAAM,CAAC,KAAK,IAAI,oHAAQ,CAAC,KAAK,CAAS,SAAS;uCAExD"}},
    {"offset": {"line": 1030, "column": 0}, "map": {"version":3,"sources":["file:///E:/projects/edu-bridge-ai-platform/lib/models/Subject.ts"],"sourcesContent":["import mongoose, { Document, Schema } from 'mongoose';\n\nexport interface ISubject extends Document {\n  _id: string;\n  schoolId: mongoose.Types.ObjectId;\n  classId: mongoose.Types.ObjectId;\n  subjectName: string;\n  subjectCode?: string; // Optional subject code like \"MAT101\"\n  teacherId?: mongoose.Types.ObjectId;\n  description?: string;\n  totalLessons?: number;\n  isActive: boolean;\n  createdAt: Date;\n  updatedAt: Date;\n}\n\nconst SubjectSchema = new Schema<ISubject>(\n  {\n    schoolId: {\n      type: Schema.Types.ObjectId,\n      ref: 'School',\n      required: [true, 'School ID is required'],\n      index: true,\n    },\n    classId: {\n      type: Schema.Types.ObjectId,\n      ref: 'Class',\n      required: [true, 'Class ID is required'],\n      index: true,\n    },\n    subjectName: {\n      type: String,\n      required: [true, 'Subject name is required'],\n      trim: true,\n    },\n    subjectCode: {\n      type: String,\n      trim: true,\n      uppercase: true,\n    },\n    teacherId: {\n      type: Schema.Types.ObjectId,\n      ref: 'User',\n      index: true,\n    },\n    description: {\n      type: String,\n      trim: true,\n      maxlength: 500,\n    },\n    totalLessons: {\n      type: Number,\n      min: 0,\n    },\n    isActive: {\n      type: Boolean,\n      default: true,\n    },\n  },\n  {\n    timestamps: true,\n  }\n);\n\n// Compound index to ensure unique subject per class in a school\nSubjectSchema.index({ schoolId: 1, classId: 1, subjectName: 1 }, { unique: true });\n\n// Index for querying by teacher\nSubjectSchema.index({ teacherId: 1 });\n\nconst Subject = mongoose.models.Subject || mongoose.model<ISubject>('Subject', SubjectSchema);\n\nexport default Subject;\n"],"names":[],"mappings":";;;;AAAA;;AAgBA,MAAM,gBAAgB,IAAI,mHAAM,CAC9B;IACE,UAAU;QACR,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;YAAC;YAAM;SAAwB;QACzC,OAAO;IACT;IACA,SAAS;QACP,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;YAAC;YAAM;SAAuB;QACxC,OAAO;IACT;IACA,aAAa;QACX,MAAM;QACN,UAAU;YAAC;YAAM;SAA2B;QAC5C,MAAM;IACR;IACA,aAAa;QACX,MAAM;QACN,MAAM;QACN,WAAW;IACb;IACA,WAAW;QACT,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,OAAO;IACT;IACA,aAAa;QACX,MAAM;QACN,MAAM;QACN,WAAW;IACb;IACA,cAAc;QACZ,MAAM;QACN,KAAK;IACP;IACA,UAAU;QACR,MAAM;QACN,SAAS;IACX;AACF,GACA;IACE,YAAY;AACd;AAGF,gEAAgE;AAChE,cAAc,KAAK,CAAC;IAAE,UAAU;IAAG,SAAS;IAAG,aAAa;AAAE,GAAG;IAAE,QAAQ;AAAK;AAEhF,gCAAgC;AAChC,cAAc,KAAK,CAAC;IAAE,WAAW;AAAE;AAEnC,MAAM,UAAU,oHAAQ,CAAC,MAAM,CAAC,OAAO,IAAI,oHAAQ,CAAC,KAAK,CAAW,WAAW;uCAEhE"}},
    {"offset": {"line": 1107, "column": 0}, "map": {"version":3,"sources":["file:///E:/projects/edu-bridge-ai-platform/lib/models/Attendance.ts"],"sourcesContent":["import mongoose, { Document, Schema } from 'mongoose';\n\nexport interface IAttendance extends Document {\n  studentId: mongoose.Types.ObjectId;\n  schoolId: mongoose.Types.ObjectId;\n  classId?: mongoose.Types.ObjectId;\n  date: Date;\n  status: 'Present' | 'Absent' | 'Late';\n  markedBy?: mongoose.Types.ObjectId; // Teacher or Principal who marked attendance\n  notes?: string;\n  // Legacy fields (backward compatibility)\n  className?: string;\n  section?: string;\n  createdAt: Date;\n  updatedAt: Date;\n}\n\nconst AttendanceSchema = new Schema<IAttendance>(\n  {\n    studentId: {\n      type: Schema.Types.ObjectId,\n      ref: 'User',\n      required: [true, 'Student ID is required'],\n      index: true,\n    },\n    schoolId: {\n      type: Schema.Types.ObjectId,\n      ref: 'School',\n      required: [true, 'School ID is required'],\n      index: true,\n    },\n    classId: {\n      type: Schema.Types.ObjectId,\n      ref: 'Class',\n      index: true,\n    },\n    className: {\n      type: String,\n      trim: true,\n      index: true,\n    },\n    section: {\n      type: String,\n      trim: true,\n    },\n    date: {\n      type: Date,\n      required: [true, 'Date is required'],\n      index: true,\n    },\n    status: {\n      type: String,\n      enum: ['Present', 'Absent', 'Late', 'present', 'absent', 'late', 'excused'],\n      required: [true, 'Status is required'],\n      default: 'Present',\n    },\n    markedBy: {\n      type: Schema.Types.ObjectId,\n      ref: 'User',\n    },\n    notes: {\n      type: String,\n      trim: true,\n      maxlength: 500,\n    },\n  },\n  {\n    timestamps: true,\n  }\n);\n\n// Compound indexes for efficient queries\nAttendanceSchema.index({ schoolId: 1, date: -1 });\nAttendanceSchema.index({ studentId: 1, date: -1 });\nAttendanceSchema.index({ schoolId: 1, className: 1, date: -1 });\n\n// Ensure one attendance record per student per day\nAttendanceSchema.index({ studentId: 1, date: 1 }, { unique: true });\n\nexport default mongoose.models.Attendance || mongoose.model<IAttendance>('Attendance', AttendanceSchema);\n"],"names":[],"mappings":";;;;AAAA;;AAiBA,MAAM,mBAAmB,IAAI,mHAAM,CACjC;IACE,WAAW;QACT,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;YAAC;YAAM;SAAyB;QAC1C,OAAO;IACT;IACA,UAAU;QACR,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;YAAC;YAAM;SAAwB;QACzC,OAAO;IACT;IACA,SAAS;QACP,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,OAAO;IACT;IACA,WAAW;QACT,MAAM;QACN,MAAM;QACN,OAAO;IACT;IACA,SAAS;QACP,MAAM;QACN,MAAM;IACR;IACA,MAAM;QACJ,MAAM;QACN,UAAU;YAAC;YAAM;SAAmB;QACpC,OAAO;IACT;IACA,QAAQ;QACN,MAAM;QACN,MAAM;YAAC;YAAW;YAAU;YAAQ;YAAW;YAAU;YAAQ;SAAU;QAC3E,UAAU;YAAC;YAAM;SAAqB;QACtC,SAAS;IACX;IACA,UAAU;QACR,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;IACP;IACA,OAAO;QACL,MAAM;QACN,MAAM;QACN,WAAW;IACb;AACF,GACA;IACE,YAAY;AACd;AAGF,yCAAyC;AACzC,iBAAiB,KAAK,CAAC;IAAE,UAAU;IAAG,MAAM,CAAC;AAAE;AAC/C,iBAAiB,KAAK,CAAC;IAAE,WAAW;IAAG,MAAM,CAAC;AAAE;AAChD,iBAAiB,KAAK,CAAC;IAAE,UAAU;IAAG,WAAW;IAAG,MAAM,CAAC;AAAE;AAE7D,mDAAmD;AACnD,iBAAiB,KAAK,CAAC;IAAE,WAAW;IAAG,MAAM;AAAE,GAAG;IAAE,QAAQ;AAAK;uCAElD,oHAAQ,CAAC,MAAM,CAAC,UAAU,IAAI,oHAAQ,CAAC,KAAK,CAAc,cAAc"}},
    {"offset": {"line": 1209, "column": 0}, "map": {"version":3,"sources":["file:///E:/projects/edu-bridge-ai-platform/lib/models/Exam.ts"],"sourcesContent":["import mongoose, { Document, Schema } from 'mongoose';\n\nexport interface IExam extends Document {\n  _id: string;\n  schoolId: mongoose.Types.ObjectId;\n  classId: mongoose.Types.ObjectId;\n  examName: string;\n  examType: 'unit-test' | 'mid-term' | 'final' | 'quarterly' | 'half-yearly' | 'annual' | 'other';\n  date: Date;\n  term?: string; // e.g., \"Term 1\", \"Term 2\"\n  academicYear?: string;\n  totalMarks?: number;\n  duration?: number; // in minutes\n  subjects?: mongoose.Types.ObjectId[]; // Array of subject IDs\n  instructions?: string;\n  isActive: boolean;\n  createdAt: Date;\n  updatedAt: Date;\n}\n\nconst ExamSchema = new Schema<IExam>(\n  {\n    schoolId: {\n      type: Schema.Types.ObjectId,\n      ref: 'School',\n      required: [true, 'School ID is required'],\n      index: true,\n    },\n    classId: {\n      type: Schema.Types.ObjectId,\n      ref: 'Class',\n      required: [true, 'Class ID is required'],\n      index: true,\n    },\n    examName: {\n      type: String,\n      required: [true, 'Exam name is required'],\n      trim: true,\n    },\n    examType: {\n      type: String,\n      enum: ['unit-test', 'mid-term', 'final', 'quarterly', 'half-yearly', 'annual', 'other'],\n      default: 'unit-test',\n    },\n    date: {\n      type: Date,\n      required: [true, 'Exam date is required'],\n      index: true,\n    },\n    term: {\n      type: String,\n      trim: true,\n    },\n    academicYear: {\n      type: String,\n      trim: true,\n    },\n    totalMarks: {\n      type: Number,\n      min: 0,\n    },\n    duration: {\n      type: Number,\n      min: 0,\n    },\n    subjects: [{\n      type: Schema.Types.ObjectId,\n      ref: 'Subject',\n    }],\n    instructions: {\n      type: String,\n      trim: true,\n      maxlength: 1000,\n    },\n    isActive: {\n      type: Boolean,\n      default: true,\n    },\n  },\n  {\n    timestamps: true,\n  }\n);\n\n// Index for querying exams by school and class\nExamSchema.index({ schoolId: 1, classId: 1, date: -1 });\n\n// Index for querying by date\nExamSchema.index({ date: 1 });\n\nconst Exam = mongoose.models.Exam || mongoose.model<IExam>('Exam', ExamSchema);\n\nexport default Exam;\n"],"names":[],"mappings":";;;;AAAA;;AAoBA,MAAM,aAAa,IAAI,mHAAM,CAC3B;IACE,UAAU;QACR,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;YAAC;YAAM;SAAwB;QACzC,OAAO;IACT;IACA,SAAS;QACP,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;YAAC;YAAM;SAAuB;QACxC,OAAO;IACT;IACA,UAAU;QACR,MAAM;QACN,UAAU;YAAC;YAAM;SAAwB;QACzC,MAAM;IACR;IACA,UAAU;QACR,MAAM;QACN,MAAM;YAAC;YAAa;YAAY;YAAS;YAAa;YAAe;YAAU;SAAQ;QACvF,SAAS;IACX;IACA,MAAM;QACJ,MAAM;QACN,UAAU;YAAC;YAAM;SAAwB;QACzC,OAAO;IACT;IACA,MAAM;QACJ,MAAM;QACN,MAAM;IACR;IACA,cAAc;QACZ,MAAM;QACN,MAAM;IACR;IACA,YAAY;QACV,MAAM;QACN,KAAK;IACP;IACA,UAAU;QACR,MAAM;QACN,KAAK;IACP;IACA,UAAU;QAAC;YACT,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;YAC3B,KAAK;QACP;KAAE;IACF,cAAc;QACZ,MAAM;QACN,MAAM;QACN,WAAW;IACb;IACA,UAAU;QACR,MAAM;QACN,SAAS;IACX;AACF,GACA;IACE,YAAY;AACd;AAGF,+CAA+C;AAC/C,WAAW,KAAK,CAAC;IAAE,UAAU;IAAG,SAAS;IAAG,MAAM,CAAC;AAAE;AAErD,6BAA6B;AAC7B,WAAW,KAAK,CAAC;IAAE,MAAM;AAAE;AAE3B,MAAM,OAAO,oHAAQ,CAAC,MAAM,CAAC,IAAI,IAAI,oHAAQ,CAAC,KAAK,CAAQ,QAAQ;uCAEpD"}},
    {"offset": {"line": 1313, "column": 0}, "map": {"version":3,"sources":["file:///E:/projects/edu-bridge-ai-platform/lib/models/Mark.ts"],"sourcesContent":["import mongoose, { Document, Schema } from 'mongoose';\n\nexport interface IMark extends Document {\n  studentId: mongoose.Types.ObjectId;\n  schoolId: mongoose.Types.ObjectId;\n  examId: mongoose.Types.ObjectId;\n  subjectId: mongoose.Types.ObjectId;\n  marksScored: number;\n  totalMarks?: number;\n  percentage?: number;\n  grade?: string;\n  remarks?: string;\n  markedBy?: mongoose.Types.ObjectId; // Teacher who entered marks\n  createdAt: Date;\n  updatedAt: Date;\n}\n\nconst MarkSchema = new Schema<IMark>(\n  {\n    studentId: {\n      type: Schema.Types.ObjectId,\n      ref: 'User',\n      required: [true, 'Student ID is required'],\n      index: true,\n    },\n    schoolId: {\n      type: Schema.Types.ObjectId,\n      ref: 'School',\n      required: [true, 'School ID is required'],\n      index: true,\n    },\n    examId: {\n      type: Schema.Types.ObjectId,\n      ref: 'Exam',\n      required: [true, 'Exam ID is required'],\n      index: true,\n    },\n    subjectId: {\n      type: Schema.Types.ObjectId,\n      ref: 'Subject',\n      required: [true, 'Subject ID is required'],\n      index: true,\n    },\n    marksScored: {\n      type: Number,\n      required: [true, 'Marks scored is required'],\n      min: 0,\n    },\n    totalMarks: {\n      type: Number,\n      min: 1,\n    },\n    percentage: {\n      type: Number,\n      min: 0,\n      max: 100,\n    },\n    grade: {\n      type: String,\n      trim: true,\n    },\n    remarks: {\n      type: String,\n      trim: true,\n      maxlength: 500,\n    },\n    markedBy: {\n      type: Schema.Types.ObjectId,\n      ref: 'User',\n    },\n  },\n  {\n    timestamps: true,\n  }\n);\n\n// Compound indexes for efficient queries\nMarkSchema.index({ schoolId: 1, examId: 1 });\nMarkSchema.index({ studentId: 1, examId: 1, subjectId: 1 }, { unique: true });\nMarkSchema.index({ examId: 1, subjectId: 1 });\n\n// Pre-save hook to calculate percentage and grade\nMarkSchema.pre('save', function () {\n  if (this.marksScored !== undefined && this.totalMarks !== undefined) {\n    this.percentage = (this.marksScored / this.totalMarks) * 100;\n    \n    // Calculate grade based on percentage\n    if (this.percentage >= 90) this.grade = 'A+';\n    else if (this.percentage >= 80) this.grade = 'A';\n    else if (this.percentage >= 70) this.grade = 'B+';\n    else if (this.percentage >= 60) this.grade = 'B';\n    else if (this.percentage >= 50) this.grade = 'C';\n    else if (this.percentage >= 40) this.grade = 'D';\n    else this.grade = 'F';\n  }\n});\n\nexport default mongoose.models.Mark || mongoose.model<IMark>('Mark', MarkSchema);\n"],"names":[],"mappings":";;;;AAAA;;AAiBA,MAAM,aAAa,IAAI,mHAAM,CAC3B;IACE,WAAW;QACT,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;YAAC;YAAM;SAAyB;QAC1C,OAAO;IACT;IACA,UAAU;QACR,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;YAAC;YAAM;SAAwB;QACzC,OAAO;IACT;IACA,QAAQ;QACN,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;YAAC;YAAM;SAAsB;QACvC,OAAO;IACT;IACA,WAAW;QACT,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;YAAC;YAAM;SAAyB;QAC1C,OAAO;IACT;IACA,aAAa;QACX,MAAM;QACN,UAAU;YAAC;YAAM;SAA2B;QAC5C,KAAK;IACP;IACA,YAAY;QACV,MAAM;QACN,KAAK;IACP;IACA,YAAY;QACV,MAAM;QACN,KAAK;QACL,KAAK;IACP;IACA,OAAO;QACL,MAAM;QACN,MAAM;IACR;IACA,SAAS;QACP,MAAM;QACN,MAAM;QACN,WAAW;IACb;IACA,UAAU;QACR,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;IACP;AACF,GACA;IACE,YAAY;AACd;AAGF,yCAAyC;AACzC,WAAW,KAAK,CAAC;IAAE,UAAU;IAAG,QAAQ;AAAE;AAC1C,WAAW,KAAK,CAAC;IAAE,WAAW;IAAG,QAAQ;IAAG,WAAW;AAAE,GAAG;IAAE,QAAQ;AAAK;AAC3E,WAAW,KAAK,CAAC;IAAE,QAAQ;IAAG,WAAW;AAAE;AAE3C,kDAAkD;AAClD,WAAW,GAAG,CAAC,QAAQ;IACrB,IAAI,IAAI,CAAC,WAAW,KAAK,aAAa,IAAI,CAAC,UAAU,KAAK,WAAW;QACnE,IAAI,CAAC,UAAU,GAAG,AAAC,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,UAAU,GAAI;QAEzD,sCAAsC;QACtC,IAAI,IAAI,CAAC,UAAU,IAAI,IAAI,IAAI,CAAC,KAAK,GAAG;aACnC,IAAI,IAAI,CAAC,UAAU,IAAI,IAAI,IAAI,CAAC,KAAK,GAAG;aACxC,IAAI,IAAI,CAAC,UAAU,IAAI,IAAI,IAAI,CAAC,KAAK,GAAG;aACxC,IAAI,IAAI,CAAC,UAAU,IAAI,IAAI,IAAI,CAAC,KAAK,GAAG;aACxC,IAAI,IAAI,CAAC,UAAU,IAAI,IAAI,IAAI,CAAC,KAAK,GAAG;aACxC,IAAI,IAAI,CAAC,UAAU,IAAI,IAAI,IAAI,CAAC,KAAK,GAAG;aACxC,IAAI,CAAC,KAAK,GAAG;IACpB;AACF;uCAEe,oHAAQ,CAAC,MAAM,CAAC,IAAI,IAAI,oHAAQ,CAAC,KAAK,CAAQ,QAAQ"}},
    {"offset": {"line": 1424, "column": 0}, "map": {"version":3,"sources":["file:///E:/projects/edu-bridge-ai-platform/lib/models/Content.ts"],"sourcesContent":["import mongoose, { Document, Model, Schema } from 'mongoose'\n\nexport type ContentType = 'video' | 'audio' | 'pdf' | 'text'\n\nexport interface IContent extends Document {\n  _id: string\n  title: string\n  description?: string\n  type: ContentType\n  url?: string // storage URL for video/audio/pdf\n  text?: string // inline text content when type=text\n  section: mongoose.Types.ObjectId\n  owner: mongoose.Types.ObjectId // teacher who uploaded\n  createdAt: Date\n  updatedAt: Date\n}\n\nconst ContentSchema = new Schema<IContent>({\n  title: { type: String, required: true },\n  description: { type: String },\n  type: { type: String, enum: ['video','audio','pdf','text'], required: true },\n  url: { type: String },\n  text: { type: String },\n  section: { type: Schema.Types.ObjectId, ref: 'Section', required: true },\n  owner: { type: Schema.Types.ObjectId, ref: 'User', required: true },\n}, { timestamps: true })\n\nContentSchema.index({ section: 1, createdAt: -1 })\n\nconst Content: Model<IContent> = mongoose.models.Content || mongoose.model<IContent>('Content', ContentSchema)\nexport default Content\n"],"names":[],"mappings":";;;;AAAA;;AAiBA,MAAM,gBAAgB,IAAI,mHAAM,CAAW;IACzC,OAAO;QAAE,MAAM;QAAQ,UAAU;IAAK;IACtC,aAAa;QAAE,MAAM;IAAO;IAC5B,MAAM;QAAE,MAAM;QAAQ,MAAM;YAAC;YAAQ;YAAQ;YAAM;SAAO;QAAE,UAAU;IAAK;IAC3E,KAAK;QAAE,MAAM;IAAO;IACpB,MAAM;QAAE,MAAM;IAAO;IACrB,SAAS;QAAE,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAAE,KAAK;QAAW,UAAU;IAAK;IACvE,OAAO;QAAE,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAAE,KAAK;QAAQ,UAAU;IAAK;AACpE,GAAG;IAAE,YAAY;AAAK;AAEtB,cAAc,KAAK,CAAC;IAAE,SAAS;IAAG,WAAW,CAAC;AAAE;AAEhD,MAAM,UAA2B,oHAAQ,CAAC,MAAM,CAAC,OAAO,IAAI,oHAAQ,CAAC,KAAK,CAAW,WAAW;uCACjF"}},
    {"offset": {"line": 1477, "column": 0}, "map": {"version":3,"sources":["file:///E:/projects/edu-bridge-ai-platform/lib/models/Course.ts"],"sourcesContent":["import mongoose, { Document, Model, Schema } from 'mongoose';\n\nexport interface ICourse extends Document {\n  _id: string;\n  title: string;\n  description: string;\n  instructor: mongoose.Types.ObjectId;\n  schoolId?: mongoose.Types.ObjectId;\n  category: string;\n  level: 'beginner' | 'intermediate' | 'advanced';\n  thumbnail?: string;\n  price: number;\n  duration: number; // in minutes\n  classes?: string[]; // Array of class names this course is assigned to\n  isPublished?: boolean;\n  createdBy?: mongoose.Types.ObjectId;\n  lessons: {\n    title: string;\n    description: string;\n    content: string;\n    videoUrl?: string;\n    duration: number;\n    order: number;\n  }[];\n  quizzes: {\n    title: string;\n    questions: {\n      question: string;\n      options: string[];\n      correctAnswer: number;\n      explanation?: string;\n    }[];\n    passingScore: number;\n  }[];\n  sections: mongoose.Types.ObjectId[]; // Sections this course is assigned to\n  enrolledStudents: mongoose.Types.ObjectId[];\n  rating: number;\n  reviews: {\n    user: mongoose.Types.ObjectId;\n    rating: number;\n    comment: string;\n    createdAt: Date;\n  }[];\n  status: 'draft' | 'published' | 'archived';\n  tags: string[];\n  createdAt: Date;\n  updatedAt: Date;\n}\n\nconst CourseSchema = new Schema<ICourse>(\n  {\n    title: {\n      type: String,\n      required: [true, 'Please provide a course title'],\n      trim: true,\n      maxlength: [200, 'Title cannot be more than 200 characters'],\n    },\n    description: {\n      type: String,\n      required: [true, 'Please provide a course description'],\n      maxlength: [2000, 'Description cannot be more than 2000 characters'],\n    },\n    instructor: {\n      type: Schema.Types.ObjectId,\n      ref: 'User',\n      required: true,\n    },\n    schoolId: {\n      type: Schema.Types.ObjectId,\n      ref: 'School',\n    },\n    createdBy: {\n      type: Schema.Types.ObjectId,\n      ref: 'User',\n    },\n    classes: [\n      {\n        type: String,\n        trim: true,\n      },\n    ],\n    isPublished: {\n      type: Boolean,\n      default: false,\n    },\n    category: {\n      type: String,\n      required: [true, 'Please specify a category'],\n      trim: true,\n    },\n    level: {\n      type: String,\n      enum: ['beginner', 'intermediate', 'advanced'],\n      default: 'beginner',\n    },\n    thumbnail: {\n      type: String,\n      default: '',\n    },\n    price: {\n      type: Number,\n      default: 0,\n      min: [0, 'Price cannot be negative'],\n    },\n    duration: {\n      type: Number,\n      required: true,\n      min: [0, 'Duration cannot be negative'],\n    },\n    lessons: [\n      {\n        title: {\n          type: String,\n          required: true,\n        },\n        description: String,\n        content: {\n          type: String,\n          required: true,\n        },\n        videoUrl: String,\n        duration: {\n          type: Number,\n          required: true,\n        },\n        order: {\n          type: Number,\n          required: true,\n        },\n      },\n    ],\n    quizzes: [\n      {\n        title: {\n          type: String,\n          required: true,\n        },\n        questions: [\n          {\n            question: {\n              type: String,\n              required: true,\n            },\n            options: {\n              type: [String],\n              required: true,\n              validate: {\n                validator: (v: string[]) => v.length >= 2,\n                message: 'At least 2 options are required',\n              },\n            },\n            correctAnswer: {\n              type: Number,\n              required: true,\n            },\n            explanation: String,\n          },\n        ],\n        passingScore: {\n          type: Number,\n          default: 70,\n          min: 0,\n          max: 100,\n        },\n      },\n    ],\n    sections: [\n      {\n        type: Schema.Types.ObjectId,\n        ref: 'Section',\n      },\n    ],\n    enrolledStudents: [\n      {\n        type: Schema.Types.ObjectId,\n        ref: 'User',\n      },\n    ],\n    rating: {\n      type: Number,\n      default: 0,\n      min: 0,\n      max: 5,\n    },\n    reviews: [\n      {\n        user: {\n          type: Schema.Types.ObjectId,\n          ref: 'User',\n          required: true,\n        },\n        rating: {\n          type: Number,\n          required: true,\n          min: 1,\n          max: 5,\n        },\n        comment: {\n          type: String,\n          maxlength: [1000, 'Comment cannot be more than 1000 characters'],\n        },\n        createdAt: {\n          type: Date,\n          default: Date.now,\n        },\n      },\n    ],\n    status: {\n      type: String,\n      enum: ['draft', 'published', 'archived'],\n      default: 'draft',\n    },\n    tags: {\n      type: [String],\n      default: [],\n    },\n  },\n  {\n    timestamps: true,\n  }\n);\n\n// Indexes for better query performance\nCourseSchema.index({ title: 'text', description: 'text' });\nCourseSchema.index({ instructor: 1 });\nCourseSchema.index({ schoolId: 1 });\nCourseSchema.index({ category: 1, level: 1 });\nCourseSchema.index({ status: 1 });\nCourseSchema.index({ rating: -1 });\n\nconst Course: Model<ICourse> =\n  mongoose.models.Course || mongoose.model<ICourse>('Course', CourseSchema);\n\nexport default Course;\n"],"names":[],"mappings":";;;;AAAA;;AAiDA,MAAM,eAAe,IAAI,mHAAM,CAC7B;IACE,OAAO;QACL,MAAM;QACN,UAAU;YAAC;YAAM;SAAgC;QACjD,MAAM;QACN,WAAW;YAAC;YAAK;SAA2C;IAC9D;IACA,aAAa;QACX,MAAM;QACN,UAAU;YAAC;YAAM;SAAsC;QACvD,WAAW;YAAC;YAAM;SAAkD;IACtE;IACA,YAAY;QACV,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;IACZ;IACA,UAAU;QACR,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;IACP;IACA,WAAW;QACT,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;IACP;IACA,SAAS;QACP;YACE,MAAM;YACN,MAAM;QACR;KACD;IACD,aAAa;QACX,MAAM;QACN,SAAS;IACX;IACA,UAAU;QACR,MAAM;QACN,UAAU;YAAC;YAAM;SAA4B;QAC7C,MAAM;IACR;IACA,OAAO;QACL,MAAM;QACN,MAAM;YAAC;YAAY;YAAgB;SAAW;QAC9C,SAAS;IACX;IACA,WAAW;QACT,MAAM;QACN,SAAS;IACX;IACA,OAAO;QACL,MAAM;QACN,SAAS;QACT,KAAK;YAAC;YAAG;SAA2B;IACtC;IACA,UAAU;QACR,MAAM;QACN,UAAU;QACV,KAAK;YAAC;YAAG;SAA8B;IACzC;IACA,SAAS;QACP;YACE,OAAO;gBACL,MAAM;gBACN,UAAU;YACZ;YACA,aAAa;YACb,SAAS;gBACP,MAAM;gBACN,UAAU;YACZ;YACA,UAAU;YACV,UAAU;gBACR,MAAM;gBACN,UAAU;YACZ;YACA,OAAO;gBACL,MAAM;gBACN,UAAU;YACZ;QACF;KACD;IACD,SAAS;QACP;YACE,OAAO;gBACL,MAAM;gBACN,UAAU;YACZ;YACA,WAAW;gBACT;oBACE,UAAU;wBACR,MAAM;wBACN,UAAU;oBACZ;oBACA,SAAS;wBACP,MAAM;4BAAC;yBAAO;wBACd,UAAU;wBACV,UAAU;4BACR,WAAW,CAAC,IAAgB,EAAE,MAAM,IAAI;4BACxC,SAAS;wBACX;oBACF;oBACA,eAAe;wBACb,MAAM;wBACN,UAAU;oBACZ;oBACA,aAAa;gBACf;aACD;YACD,cAAc;gBACZ,MAAM;gBACN,SAAS;gBACT,KAAK;gBACL,KAAK;YACP;QACF;KACD;IACD,UAAU;QACR;YACE,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;YAC3B,KAAK;QACP;KACD;IACD,kBAAkB;QAChB;YACE,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;YAC3B,KAAK;QACP;KACD;IACD,QAAQ;QACN,MAAM;QACN,SAAS;QACT,KAAK;QACL,KAAK;IACP;IACA,SAAS;QACP;YACE,MAAM;gBACJ,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;gBAC3B,KAAK;gBACL,UAAU;YACZ;YACA,QAAQ;gBACN,MAAM;gBACN,UAAU;gBACV,KAAK;gBACL,KAAK;YACP;YACA,SAAS;gBACP,MAAM;gBACN,WAAW;oBAAC;oBAAM;iBAA8C;YAClE;YACA,WAAW;gBACT,MAAM;gBACN,SAAS,KAAK,GAAG;YACnB;QACF;KACD;IACD,QAAQ;QACN,MAAM;QACN,MAAM;YAAC;YAAS;YAAa;SAAW;QACxC,SAAS;IACX;IACA,MAAM;QACJ,MAAM;YAAC;SAAO;QACd,SAAS,EAAE;IACb;AACF,GACA;IACE,YAAY;AACd;AAGF,uCAAuC;AACvC,aAAa,KAAK,CAAC;IAAE,OAAO;IAAQ,aAAa;AAAO;AACxD,aAAa,KAAK,CAAC;IAAE,YAAY;AAAE;AACnC,aAAa,KAAK,CAAC;IAAE,UAAU;AAAE;AACjC,aAAa,KAAK,CAAC;IAAE,UAAU;IAAG,OAAO;AAAE;AAC3C,aAAa,KAAK,CAAC;IAAE,QAAQ;AAAE;AAC/B,aAAa,KAAK,CAAC;IAAE,QAAQ,CAAC;AAAE;AAEhC,MAAM,SACJ,oHAAQ,CAAC,MAAM,CAAC,MAAM,IAAI,oHAAQ,CAAC,KAAK,CAAU,UAAU;uCAE/C"}},
    {"offset": {"line": 1715, "column": 0}, "map": {"version":3,"sources":["file:///E:/projects/edu-bridge-ai-platform/lib/models/OfflineContent.ts"],"sourcesContent":["import mongoose, { Document } from 'mongoose'\n\nexport interface IOfflineContent extends Document {\n  userId: mongoose.Schema.Types.ObjectId\n  courseId: mongoose.Schema.Types.ObjectId\n  lessonId?: mongoose.Schema.Types.ObjectId\n  contentType: 'video' | 'pdf' | 'notes' | 'quiz'\n  fileName: string\n  fileSize: number\n  downloadedAt: Date\n  lastAccessedAt: Date\n  syncStatus: 'pending' | 'synced' | 'outdated'\n}\n\nconst OfflineContentSchema = new mongoose.Schema({\n  userId: { type: mongoose.Schema.Types.ObjectId, ref: 'User', required: true },\n  courseId: { type: mongoose.Schema.Types.ObjectId, ref: 'Course', required: true },\n  lessonId: { type: mongoose.Schema.Types.ObjectId },\n  contentType: { type: String, enum: ['video', 'pdf', 'notes', 'quiz'], required: true },\n  fileName: { type: String, required: true },\n  fileSize: { type: Number, required: true },\n  downloadedAt: { type: Date, default: Date.now },\n  lastAccessedAt: { type: Date, default: Date.now },\n  syncStatus: { type: String, enum: ['pending', 'synced', 'outdated'], default: 'synced' }\n}, { timestamps: true })\n\nOfflineContentSchema.index({ userId: 1, courseId: 1 })\nOfflineContentSchema.index({ syncStatus: 1 })\n\nexport default mongoose.models.OfflineContent || mongoose.model<IOfflineContent>('OfflineContent', OfflineContentSchema)\n"],"names":[],"mappings":";;;;AAAA;;AAcA,MAAM,uBAAuB,IAAI,oHAAQ,CAAC,MAAM,CAAC;IAC/C,QAAQ;QAAE,MAAM,oHAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,QAAQ;QAAE,KAAK;QAAQ,UAAU;IAAK;IAC5E,UAAU;QAAE,MAAM,oHAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,QAAQ;QAAE,KAAK;QAAU,UAAU;IAAK;IAChF,UAAU;QAAE,MAAM,oHAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,QAAQ;IAAC;IACjD,aAAa;QAAE,MAAM;QAAQ,MAAM;YAAC;YAAS;YAAO;YAAS;SAAO;QAAE,UAAU;IAAK;IACrF,UAAU;QAAE,MAAM;QAAQ,UAAU;IAAK;IACzC,UAAU;QAAE,MAAM;QAAQ,UAAU;IAAK;IACzC,cAAc;QAAE,MAAM;QAAM,SAAS,KAAK,GAAG;IAAC;IAC9C,gBAAgB;QAAE,MAAM;QAAM,SAAS,KAAK,GAAG;IAAC;IAChD,YAAY;QAAE,MAAM;QAAQ,MAAM;YAAC;YAAW;YAAU;SAAW;QAAE,SAAS;IAAS;AACzF,GAAG;IAAE,YAAY;AAAK;AAEtB,qBAAqB,KAAK,CAAC;IAAE,QAAQ;IAAG,UAAU;AAAE;AACpD,qBAAqB,KAAK,CAAC;IAAE,YAAY;AAAE;uCAE5B,oHAAQ,CAAC,MAAM,CAAC,cAAc,IAAI,oHAAQ,CAAC,KAAK,CAAkB,kBAAkB"}},
    {"offset": {"line": 1785, "column": 0}, "map": {"version":3,"sources":["file:///E:/projects/edu-bridge-ai-platform/lib/models/Section.ts"],"sourcesContent":["import mongoose, { Document, Model, Schema } from 'mongoose'\n\nexport interface ISection extends Document {\n  _id: string\n  name: string\n  owner: mongoose.Types.ObjectId // teacher/admin who created\n  students: mongoose.Types.ObjectId[]\n  createdAt: Date\n  updatedAt: Date\n}\n\nconst SectionSchema = new Schema<ISection>({\n  name: { type: String, required: true, trim: true },\n  owner: { type: Schema.Types.ObjectId, ref: 'User', required: true },\n  students: [{ type: Schema.Types.ObjectId, ref: 'User' }],\n}, { timestamps: true })\n\nSectionSchema.index({ owner: 1, name: 1 }, { unique: true })\n\nconst Section: Model<ISection> = mongoose.models.Section || mongoose.model<ISection>('Section', SectionSchema)\nexport default Section\n"],"names":[],"mappings":";;;;AAAA;;AAWA,MAAM,gBAAgB,IAAI,mHAAM,CAAW;IACzC,MAAM;QAAE,MAAM;QAAQ,UAAU;QAAM,MAAM;IAAK;IACjD,OAAO;QAAE,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAAE,KAAK;QAAQ,UAAU;IAAK;IAClE,UAAU;QAAC;YAAE,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;YAAE,KAAK;QAAO;KAAE;AAC1D,GAAG;IAAE,YAAY;AAAK;AAEtB,cAAc,KAAK,CAAC;IAAE,OAAO;IAAG,MAAM;AAAE,GAAG;IAAE,QAAQ;AAAK;AAE1D,MAAM,UAA2B,oHAAQ,CAAC,MAAM,CAAC,OAAO,IAAI,oHAAQ,CAAC,KAAK,CAAW,WAAW;uCACjF"}},
    {"offset": {"line": 1823, "column": 0}, "map": {"version":3,"sources":["file:///E:/projects/edu-bridge-ai-platform/lib/models/ChatMessage.ts"],"sourcesContent":["import mongoose, { Document, Model, Schema } from 'mongoose'\n\nexport interface IChatMessage extends Document {\n  _id: string\n  userId: mongoose.Types.ObjectId\n  userName: string\n  role: 'user' | 'assistant'\n  content: string\n  language: string\n  quizMode: boolean\n  timestamp: Date\n}\n\nconst ChatMessageSchema = new Schema<IChatMessage>({\n  userId: { type: Schema.Types.ObjectId, ref: 'User', required: true },\n  userName: { type: String, required: true },\n  role: { type: String, enum: ['user', 'assistant'], required: true },\n  content: { type: String, required: true },\n  language: { type: String, default: 'english' },\n  quizMode: { type: Boolean, default: false },\n  timestamp: { type: Date, default: Date.now }\n}, { timestamps: true })\n\n// Indexes for performance\nChatMessageSchema.index({ userId: 1, timestamp: -1 })\nChatMessageSchema.index({ userName: 1, timestamp: -1 })\nChatMessageSchema.index({ quizMode: 1 })\n\nconst ChatMessage: Model<IChatMessage> = mongoose.models.ChatMessage || mongoose.model<IChatMessage>('ChatMessage', ChatMessageSchema)\nexport default ChatMessage\n"],"names":[],"mappings":";;;;AAAA;;AAaA,MAAM,oBAAoB,IAAI,mHAAM,CAAe;IACjD,QAAQ;QAAE,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAAE,KAAK;QAAQ,UAAU;IAAK;IACnE,UAAU;QAAE,MAAM;QAAQ,UAAU;IAAK;IACzC,MAAM;QAAE,MAAM;QAAQ,MAAM;YAAC;YAAQ;SAAY;QAAE,UAAU;IAAK;IAClE,SAAS;QAAE,MAAM;QAAQ,UAAU;IAAK;IACxC,UAAU;QAAE,MAAM;QAAQ,SAAS;IAAU;IAC7C,UAAU;QAAE,MAAM;QAAS,SAAS;IAAM;IAC1C,WAAW;QAAE,MAAM;QAAM,SAAS,KAAK,GAAG;IAAC;AAC7C,GAAG;IAAE,YAAY;AAAK;AAEtB,0BAA0B;AAC1B,kBAAkB,KAAK,CAAC;IAAE,QAAQ;IAAG,WAAW,CAAC;AAAE;AACnD,kBAAkB,KAAK,CAAC;IAAE,UAAU;IAAG,WAAW,CAAC;AAAE;AACrD,kBAAkB,KAAK,CAAC;IAAE,UAAU;AAAE;AAEtC,MAAM,cAAmC,oHAAQ,CAAC,MAAM,CAAC,WAAW,IAAI,oHAAQ,CAAC,KAAK,CAAe,eAAe;uCACrG"}},
    {"offset": {"line": 1884, "column": 0}, "map": {"version":3,"sources":["file:///E:/projects/edu-bridge-ai-platform/lib/models/Gamification.ts"],"sourcesContent":["import mongoose, { Document } from 'mongoose'\n\nexport interface IGamification extends Document {\n  userId: mongoose.Schema.Types.ObjectId\n  xp: number\n  level: number\n  streak: number\n  lastActivityDate: Date\n  badges: Array<{\n    id: string\n    name: string\n    description: string\n    icon: string\n    earnedAt: Date\n  }>\n  achievements: Array<{\n    id: string\n    title: string\n    progress: number\n    target: number\n    completed: boolean\n  }>\n}\n\nconst GamificationSchema = new mongoose.Schema({\n  userId: { type: mongoose.Schema.Types.ObjectId, ref: 'User', required: true, unique: true },\n  xp: { type: Number, default: 0 },\n  level: { type: Number, default: 1 },\n  streak: { type: Number, default: 0 },\n  lastActivityDate: { type: Date, default: null },\n  badges: [{\n    id: { type: String, required: true },\n    name: { type: String, required: true },\n    description: String,\n    icon: String,\n    earnedAt: { type: Date, default: Date.now }\n  }],\n  achievements: [{\n    id: { type: String, required: true },\n    title: { type: String, required: true },\n    progress: { type: Number, default: 0 },\n    target: { type: Number, required: true },\n    completed: { type: Boolean, default: false }\n  }]\n}, { timestamps: true })\n\nGamificationSchema.index({ userId: 1 })\nGamificationSchema.index({ xp: -1 })\nGamificationSchema.index({ level: -1 })\n\nexport default mongoose.models.Gamification || mongoose.model<IGamification>('Gamification', GamificationSchema)\n"],"names":[],"mappings":";;;;AAAA;;AAwBA,MAAM,qBAAqB,IAAI,oHAAQ,CAAC,MAAM,CAAC;IAC7C,QAAQ;QAAE,MAAM,oHAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,QAAQ;QAAE,KAAK;QAAQ,UAAU;QAAM,QAAQ;IAAK;IAC1F,IAAI;QAAE,MAAM;QAAQ,SAAS;IAAE;IAC/B,OAAO;QAAE,MAAM;QAAQ,SAAS;IAAE;IAClC,QAAQ;QAAE,MAAM;QAAQ,SAAS;IAAE;IACnC,kBAAkB;QAAE,MAAM;QAAM,SAAS;IAAK;IAC9C,QAAQ;QAAC;YACP,IAAI;gBAAE,MAAM;gBAAQ,UAAU;YAAK;YACnC,MAAM;gBAAE,MAAM;gBAAQ,UAAU;YAAK;YACrC,aAAa;YACb,MAAM;YACN,UAAU;gBAAE,MAAM;gBAAM,SAAS,KAAK,GAAG;YAAC;QAC5C;KAAE;IACF,cAAc;QAAC;YACb,IAAI;gBAAE,MAAM;gBAAQ,UAAU;YAAK;YACnC,OAAO;gBAAE,MAAM;gBAAQ,UAAU;YAAK;YACtC,UAAU;gBAAE,MAAM;gBAAQ,SAAS;YAAE;YACrC,QAAQ;gBAAE,MAAM;gBAAQ,UAAU;YAAK;YACvC,WAAW;gBAAE,MAAM;gBAAS,SAAS;YAAM;QAC7C;KAAE;AACJ,GAAG;IAAE,YAAY;AAAK;AAEtB,mBAAmB,KAAK,CAAC;IAAE,QAAQ;AAAE;AACrC,mBAAmB,KAAK,CAAC;IAAE,IAAI,CAAC;AAAE;AAClC,mBAAmB,KAAK,CAAC;IAAE,OAAO,CAAC;AAAE;uCAEtB,oHAAQ,CAAC,MAAM,CAAC,YAAY,IAAI,oHAAQ,CAAC,KAAK,CAAgB,gBAAgB"}},
    {"offset": {"line": 1972, "column": 0}, "map": {"version":3,"sources":["file:///E:/projects/edu-bridge-ai-platform/lib/models/index.ts"],"sourcesContent":["// Core Models\nexport { default as School } from './School';\nexport type { ISchool } from './School';\nexport { default as User } from './User';\nexport type { IUser } from './User';\n\n// Academic Structure Models\nexport { default as Class } from './Class';\nexport type { IClass } from './Class';\nexport { default as Subject } from './Subject';\nexport type { ISubject } from './Subject';\n\n// Assessment Models\nexport { default as Attendance } from './Attendance';\nexport type { IAttendance } from './Attendance';\nexport { default as Exam } from './Exam';\nexport type { IExam } from './Exam';\nexport { default as Mark } from './Mark';\nexport type { IMark } from './Mark';\n\n// Learning Management Models\nexport { default as Content } from './Content';\nexport type { IContent } from './Content';\nexport { default as Course } from './Course';\nexport type { ICourse } from './Course';\nexport { default as OfflineContent } from './OfflineContent';\nexport type { IOfflineContent } from './OfflineContent';\nexport { default as Section } from './Section';\nexport type { ISection } from './Section';\n\n// Engagement Models\nexport { default as ChatMessage } from './ChatMessage';\nexport type { IChatMessage } from './ChatMessage';\nexport { default as Gamification } from './Gamification';\nexport type { IGamification } from './Gamification';\n\n"],"names":[],"mappings":"AAAA,cAAc;;AACd;AAEA;AAGA,4BAA4B;AAC5B;AAEA;AAGA,oBAAoB;AACpB;AAEA;AAEA;AAGA,6BAA6B;AAC7B;AAEA;AAEA;AAEA;AAGA,oBAAoB;AACpB;AAEA"}},
    {"offset": {"line": 2035, "column": 0}, "map": {"version":3,"sources":["file:///E:/projects/edu-bridge-ai-platform/lib/mongodb.ts"],"sourcesContent":["import mongoose from 'mongoose';\n\nconst MONGODB_URI = process.env.MONGODB_URI as string;\n\nif (!MONGODB_URI) {\n  throw new Error(\n    'Please define the MONGODB_URI environment variable inside .env.local'\n  );\n}\n\n/**\n * Global is used here to maintain a cached connection across hot reloads\n * in development. This prevents connections growing exponentially\n * during API Route usage.\n */\ninterface MongooseCache {\n  conn: typeof mongoose | null;\n  promise: Promise<typeof mongoose> | null;\n}\n\ndeclare global {\n  var mongoose: MongooseCache | undefined;\n}\n\nlet cached: MongooseCache = global.mongoose || { conn: null, promise: null };\n\nif (!global.mongoose) {\n  global.mongoose = cached;\n}\n\nasync function connectDB(): Promise<typeof mongoose> {\n  if (cached.conn) {\n    return cached.conn;\n  }\n\n  if (!cached.promise) {\n    const opts = {\n      bufferCommands: false,\n      serverSelectionTimeoutMS: 30000,\n      socketTimeoutMS: 75000,\n      connectTimeoutMS: 30000,\n      maxPoolSize: 10,\n      minPoolSize: 1,\n      retryWrites: true,\n      retryReads: true,\n      // Disable TLS validation to fix Node.js 22 SSL error\n      tls: true,\n      tlsAllowInvalidCertificates: true,\n      tlsAllowInvalidHostnames: true,\n    };\n\n    cached.promise = mongoose.connect(MONGODB_URI, opts).then((mongoose) => {\n      console.log(' MongoDB connected successfully');\n      return mongoose;\n    }).catch((err) => {\n      console.error(' MongoDB connection error:', err.message);\n      cached.promise = null;\n      throw err;\n    });\n  }\n\n  try {\n    cached.conn = await cached.promise;\n  } catch (e) {\n    cached.promise = null;\n    console.error(' MongoDB connection error:', e);\n    throw e;\n  }\n\n  return cached.conn;\n}\n\nexport default connectDB;\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,cAAc,QAAQ,GAAG,CAAC,WAAW;AAE3C,IAAI,CAAC,aAAa;IAChB,MAAM,IAAI,MACR;AAEJ;AAgBA,IAAI,SAAwB,OAAO,QAAQ,IAAI;IAAE,MAAM;IAAM,SAAS;AAAK;AAE3E,IAAI,CAAC,OAAO,QAAQ,EAAE;IACpB,OAAO,QAAQ,GAAG;AACpB;AAEA,eAAe;IACb,IAAI,OAAO,IAAI,EAAE;QACf,OAAO,OAAO,IAAI;IACpB;IAEA,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,MAAM,OAAO;YACX,gBAAgB;YAChB,0BAA0B;YAC1B,iBAAiB;YACjB,kBAAkB;YAClB,aAAa;YACb,aAAa;YACb,aAAa;YACb,YAAY;YACZ,qDAAqD;YACrD,KAAK;YACL,6BAA6B;YAC7B,0BAA0B;QAC5B;QAEA,OAAO,OAAO,GAAG,oHAAQ,CAAC,OAAO,CAAC,aAAa,MAAM,IAAI,CAAC,CAAC;YACzD,QAAQ,GAAG,CAAC;YACZ,OAAO;QACT,GAAG,KAAK,CAAC,CAAC;YACR,QAAQ,KAAK,CAAC,+BAA+B,IAAI,OAAO;YACxD,OAAO,OAAO,GAAG;YACjB,MAAM;QACR;IACF;IAEA,IAAI;QACF,OAAO,IAAI,GAAG,MAAM,OAAO,OAAO;IACpC,EAAE,OAAO,GAAG;QACV,OAAO,OAAO,GAAG;QACjB,QAAQ,KAAK,CAAC,+BAA+B;QAC7C,MAAM;IACR;IAEA,OAAO,OAAO,IAAI;AACpB;uCAEe"}},
    {"offset": {"line": 2094, "column": 0}, "map": {"version":3,"sources":["file:///E:/projects/edu-bridge-ai-platform/app/api/principal/stats/route.ts"],"sourcesContent":["import { authenticateAndAuthorize } from '@/lib/auth-middleware'\nimport { Class, Course, User } from '@/lib/models'\nimport School from '@/lib/models/School'\nimport connectDB from '@/lib/mongodb'\nimport { NextRequest, NextResponse } from 'next/server'\n\nexport async function GET(request: NextRequest) {\n  try {\n    const authResult = authenticateAndAuthorize(request, {\n      requiredRoles: ['principal', 'super-admin'],\n      resource: 'stats',\n      action: 'read'\n    })\n\n    if (authResult instanceof NextResponse) {\n      return authResult\n    }\n\n    const user = authResult\n    await connectDB()\n\n    if (user.role === 'principal' && !user.schoolId) {\n      return NextResponse.json(\n        { success: false, error: 'School information missing' },\n        { status: 400 }\n      )\n    }\n\n    const schoolId = user.schoolId\n\n    // Get counts\n    const [totalStudents, totalTeachers, totalClasses, totalCourses, school] = await Promise.all([\n      User.countDocuments({ schoolId, role: 'student' }),\n      User.countDocuments({ schoolId, role: 'teacher' }),\n      Class.countDocuments({ schoolId }),\n      Course.countDocuments({ schoolId }),\n      School.findById(schoolId)\n    ])\n\n    return NextResponse.json({\n      success: true,\n      stats: {\n        totalStudents,\n        totalTeachers,\n        totalClasses,\n        totalCourses,\n        schoolName: school?.name,\n        schoolCode: school?.code\n      }\n    })\n\n  } catch (error: any) {\n    console.error('Stats API Error:', error)\n    return NextResponse.json(\n      { success: false, error: error.message },\n      { status: 500 }\n    )\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;;;;;;AAEO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,aAAa,IAAA,uJAAwB,EAAC,SAAS;YACnD,eAAe;gBAAC;gBAAa;aAAc;YAC3C,UAAU;YACV,QAAQ;QACV;QAEA,IAAI,sBAAsB,+QAAY,EAAE;YACtC,OAAO;QACT;QAEA,MAAM,OAAO;QACb,MAAM,IAAA,2HAAS;QAEf,IAAI,KAAK,IAAI,KAAK,eAAe,CAAC,KAAK,QAAQ,EAAE;YAC/C,OAAO,+QAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,OAAO;YAA6B,GACtD;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,WAAW,KAAK,QAAQ;QAE9B,aAAa;QACb,MAAM,CAAC,eAAe,eAAe,cAAc,cAAc,OAAO,GAAG,MAAM,QAAQ,GAAG,CAAC;YAC3F,kKAAI,CAAC,cAAc,CAAC;gBAAE;gBAAU,MAAM;YAAU;YAChD,kKAAI,CAAC,cAAc,CAAC;gBAAE;gBAAU,MAAM;YAAU;YAChD,qKAAK,CAAC,cAAc,CAAC;gBAAE;YAAS;YAChC,wKAAM,CAAC,cAAc,CAAC;gBAAE;YAAS;YACjC,oIAAM,CAAC,QAAQ,CAAC;SACjB;QAED,OAAO,+QAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,OAAO;gBACL;gBACA;gBACA;gBACA;gBACA,YAAY,QAAQ;gBACpB,YAAY,QAAQ;YACtB;QACF;IAEF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,oBAAoB;QAClC,OAAO,+QAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAO,OAAO,MAAM,OAAO;QAAC,GACvC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}