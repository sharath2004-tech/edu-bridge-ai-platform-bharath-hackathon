{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///E:/projects/edu-bridge-ai-platform/lib/auth.ts"],"sourcesContent":["import { cookies } from 'next/headers';\n\nexport type Session = { id: string; role: 'student'|'teacher'|'admin'; name: string; email: string }\n\nexport async function getSession(): Promise<Session | null> {\n  const cookieStore = await cookies()\n  const c = cookieStore.get('edubridge_session')?.value\n  if (!c) return null\n  try {\n    return JSON.parse(c)\n  } catch {\n    return null\n  }\n}\n\nexport async function requireRole(role: Session['role']): Promise<Session | null> {\n  const s = await getSession()\n  if (!s || s.role !== role) {\n    return null\n  }\n  return s\n}\n"],"names":[],"mappings":";;;;;;AAAA;;AAIO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,2QAAO;IACjC,MAAM,IAAI,YAAY,GAAG,CAAC,sBAAsB;IAChD,IAAI,CAAC,GAAG,OAAO;IACf,IAAI;QACF,OAAO,KAAK,KAAK,CAAC;IACpB,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAEO,eAAe,YAAY,IAAqB;IACrD,MAAM,IAAI,MAAM;IAChB,IAAI,CAAC,KAAK,EAAE,IAAI,KAAK,MAAM;QACzB,OAAO;IACT;IACA,OAAO;AACT"}},
    {"offset": {"line": 81, "column": 0}, "map": {"version":3,"sources":["file:///E:/projects/edu-bridge-ai-platform/lib/models/School.ts"],"sourcesContent":["import mongoose, { Document, Model, Schema } from 'mongoose';\n\nexport interface ISchool extends Document {\n  _id: string;\n  name: string;\n  code: string; // Unique school code for registration\n  email: string;\n  phone?: string;\n  address: {\n    street?: string;\n    city: string;\n    state: string;\n    country: string;\n    zipCode?: string;\n  };\n  principal?: {\n    name: string;\n    email: string;\n    phone?: string;\n  };\n  logo?: string;\n  website?: string;\n  established?: Date;\n  type: 'primary' | 'secondary' | 'higher-secondary' | 'university' | 'institute';\n  board?: string; // CBSE, ICSE, State Board, etc.\n  isActive: boolean;\n  subscription?: {\n    plan: 'free' | 'basic' | 'premium' | 'enterprise';\n    startDate: Date;\n    endDate?: Date;\n    maxStudents?: number;\n    maxTeachers?: number;\n  };\n  stats?: {\n    totalStudents: number;\n    totalTeachers: number;\n    totalCourses: number;\n  };\n  createdAt: Date;\n  updatedAt: Date;\n}\n\nconst SchoolSchema = new Schema<ISchool>(\n  {\n    name: {\n      type: String,\n      required: [true, 'School name is required'],\n      trim: true,\n      maxlength: [200, 'School name cannot exceed 200 characters'],\n    },\n    code: {\n      type: String,\n      required: [true, 'School code is required'],\n      unique: true,\n      uppercase: true,\n      trim: true,\n      match: [/^[A-Z0-9]{4,10}$/, 'School code must be 4-10 alphanumeric characters'],\n    },\n    email: {\n      type: String,\n      required: [true, 'School email is required'],\n      unique: true,\n      lowercase: true,\n      trim: true,\n      match: [\n        /^\\w+([\\.-]?\\w+)*@\\w+([\\.-]?\\w+)*(\\.\\w{2,3})+$/,\n        'Please provide a valid email',\n      ],\n    },\n    phone: {\n      type: String,\n      trim: true,\n    },\n    address: {\n      street: String,\n      city: {\n        type: String,\n        required: [true, 'City is required'],\n      },\n      state: {\n        type: String,\n        required: [true, 'State is required'],\n      },\n      country: {\n        type: String,\n        required: [true, 'Country is required'],\n        default: 'India',\n      },\n      zipCode: String,\n    },\n    principal: {\n      name: String,\n      email: String,\n      phone: String,\n    },\n    logo: {\n      type: String,\n      default: '',\n    },\n    website: {\n      type: String,\n      trim: true,\n    },\n    established: {\n      type: Date,\n    },\n    type: {\n      type: String,\n      enum: ['primary', 'secondary', 'higher-secondary', 'university', 'institute'],\n      default: 'secondary',\n      required: true,\n    },\n    board: {\n      type: String,\n      default: 'CBSE',\n    },\n    isActive: {\n      type: Boolean,\n      default: true,\n    },\n    subscription: {\n      plan: {\n        type: String,\n        enum: ['free', 'basic', 'premium', 'enterprise'],\n        default: 'free',\n      },\n      startDate: {\n        type: Date,\n        default: Date.now,\n      },\n      endDate: Date,\n      maxStudents: {\n        type: Number,\n        default: 100,\n      },\n      maxTeachers: {\n        type: Number,\n        default: 10,\n      },\n    },\n    stats: {\n      totalStudents: {\n        type: Number,\n        default: 0,\n      },\n      totalTeachers: {\n        type: Number,\n        default: 0,\n      },\n      totalCourses: {\n        type: Number,\n        default: 0,\n      },\n    },\n  },\n  {\n    timestamps: true,\n  }\n);\n\n// Indexes for better query performance\n// Note: code and email already have indexes from schema definitions\nSchoolSchema.index({ isActive: 1 });\nSchoolSchema.index({ 'subscription.plan': 1 });\n\nconst School: Model<ISchool> =\n  mongoose.models.School || mongoose.model<ISchool>('School', SchoolSchema);\n\nexport default School;\n"],"names":[],"mappings":";;;;AAAA;;AA0CA,MAAM,eAAe,IAAI,mHAAM,CAC7B;IACE,MAAM;QACJ,MAAM;QACN,UAAU;YAAC;YAAM;SAA0B;QAC3C,MAAM;QACN,WAAW;YAAC;YAAK;SAA2C;IAC9D;IACA,MAAM;QACJ,MAAM;QACN,UAAU;YAAC;YAAM;SAA0B;QAC3C,QAAQ;QACR,WAAW;QACX,MAAM;QACN,OAAO;YAAC;YAAoB;SAAmD;IACjF;IACA,OAAO;QACL,MAAM;QACN,UAAU;YAAC;YAAM;SAA2B;QAC5C,QAAQ;QACR,WAAW;QACX,MAAM;QACN,OAAO;YACL;YACA;SACD;IACH;IACA,OAAO;QACL,MAAM;QACN,MAAM;IACR;IACA,SAAS;QACP,QAAQ;QACR,MAAM;YACJ,MAAM;YACN,UAAU;gBAAC;gBAAM;aAAmB;QACtC;QACA,OAAO;YACL,MAAM;YACN,UAAU;gBAAC;gBAAM;aAAoB;QACvC;QACA,SAAS;YACP,MAAM;YACN,UAAU;gBAAC;gBAAM;aAAsB;YACvC,SAAS;QACX;QACA,SAAS;IACX;IACA,WAAW;QACT,MAAM;QACN,OAAO;QACP,OAAO;IACT;IACA,MAAM;QACJ,MAAM;QACN,SAAS;IACX;IACA,SAAS;QACP,MAAM;QACN,MAAM;IACR;IACA,aAAa;QACX,MAAM;IACR;IACA,MAAM;QACJ,MAAM;QACN,MAAM;YAAC;YAAW;YAAa;YAAoB;YAAc;SAAY;QAC7E,SAAS;QACT,UAAU;IACZ;IACA,OAAO;QACL,MAAM;QACN,SAAS;IACX;IACA,UAAU;QACR,MAAM;QACN,SAAS;IACX;IACA,cAAc;QACZ,MAAM;YACJ,MAAM;YACN,MAAM;gBAAC;gBAAQ;gBAAS;gBAAW;aAAa;YAChD,SAAS;QACX;QACA,WAAW;YACT,MAAM;YACN,SAAS,KAAK,GAAG;QACnB;QACA,SAAS;QACT,aAAa;YACX,MAAM;YACN,SAAS;QACX;QACA,aAAa;YACX,MAAM;YACN,SAAS;QACX;IACF;IACA,OAAO;QACL,eAAe;YACb,MAAM;YACN,SAAS;QACX;QACA,eAAe;YACb,MAAM;YACN,SAAS;QACX;QACA,cAAc;YACZ,MAAM;YACN,SAAS;QACX;IACF;AACF,GACA;IACE,YAAY;AACd;AAGF,uCAAuC;AACvC,oEAAoE;AACpE,aAAa,KAAK,CAAC;IAAE,UAAU;AAAE;AACjC,aAAa,KAAK,CAAC;IAAE,qBAAqB;AAAE;AAE5C,MAAM,SACJ,oHAAQ,CAAC,MAAM,CAAC,MAAM,IAAI,oHAAQ,CAAC,KAAK,CAAU,UAAU;uCAE/C"}},
    {"offset": {"line": 250, "column": 0}, "map": {"version":3,"sources":["file:///E:/projects/edu-bridge-ai-platform/lib/models/User.ts"],"sourcesContent":["import mongoose, { Document, Model, Schema } from 'mongoose';\n\nexport interface IUser extends Document {\n  _id: string;\n  name: string;\n  email: string;\n  password: string;\n  role: 'super-admin' | 'principal' | 'teacher' | 'student';\n  schoolId?: mongoose.Types.ObjectId;\n  avatar?: string;\n  bio?: string;\n  phone?: string;\n  isActive: boolean;\n  // Teacher-specific fields\n  subjectSpecialization?: string;\n  teacherRole?: 'Teacher' | 'HOD' | 'Vice Principal';\n  assignedClasses?: mongoose.Types.ObjectId[]; // Array of Class IDs\n  assignedSubjects?: mongoose.Types.ObjectId[]; // Array of Subject IDs\n  // Student-specific fields\n  classId?: mongoose.Types.ObjectId; // Reference to Class model\n  rollNo?: number;\n  parentName?: string;\n  parentPhone?: string;\n  // Legacy fields (for backward compatibility)\n  className?: string; // e.g., '10-A'\n  section?: string; // e.g., 'A', 'B', 'C', 'D', 'E'\n  rollNumber?: string;\n  enrolledCourses?: mongoose.Types.ObjectId[];\n  // Teacher fields\n  createdCourses?: mongoose.Types.ObjectId[];\n  progress?: {\n    courseId: mongoose.Types.ObjectId;\n    completedLessons: number;\n    totalLessons: number;\n    lastAccessed: Date;\n  }[];\n  createdAt: Date;\n  updatedAt: Date;\n}\n\nconst UserSchema = new Schema<IUser>(\n  {\n    name: {\n      type: String,\n      required: [true, 'Please provide a name'],\n      trim: true,\n      maxlength: [100, 'Name cannot be more than 100 characters'],\n    },\n    email: {\n      type: String,\n      required: [true, 'Please provide an email'],\n      unique: true,\n      lowercase: true,\n      trim: true,\n      match: [\n        /^\\w+([\\.-]?\\w+)*@\\w+([\\.-]?\\w+)*(\\.\\w{2,3})+$/,\n        'Please provide a valid email',\n      ],\n    },\n    password: {\n      type: String,\n      required: [true, 'Please provide a password'],\n      minlength: [6, 'Password must be at least 6 characters'],\n      select: false, // Don't return password by default\n    },\n    role: {\n      type: String,\n      enum: ['super-admin', 'principal', 'teacher', 'student'],\n      default: 'student',\n      required: true,\n    },\n    schoolId: {\n      type: Schema.Types.ObjectId,\n      ref: 'School',\n    },\n    avatar: {\n      type: String,\n      default: '',\n    },\n    bio: {\n      type: String,\n      maxlength: [500, 'Bio cannot be more than 500 characters'],\n    },\n    phone: {\n      type: String,\n      trim: true,\n    },\n    isActive: {\n      type: Boolean,\n      default: true,\n    },\n    // Teacher-specific fields\n    subjectSpecialization: {\n      type: String,\n      trim: true,\n    },\n    teacherRole: {\n      type: String,\n      enum: ['Teacher', 'HOD', 'Vice Principal'],\n    },\n    assignedClasses: [\n      {\n        type: Schema.Types.ObjectId,\n        ref: 'Class',\n      },\n    ],\n    assignedSubjects: [\n      {\n        type: Schema.Types.ObjectId,\n        ref: 'Subject',\n      },\n    ],\n    // Student-specific fields\n    classId: {\n      type: Schema.Types.ObjectId,\n      ref: 'Class',\n      index: true,\n    },\n    rollNo: {\n      type: Number,\n      min: 1,\n    },\n    parentName: {\n      type: String,\n      trim: true,\n    },\n    parentPhone: {\n      type: String,\n      trim: true,\n    },\n    // Legacy fields (backward compatibility)\n    className: {\n      type: String,\n      trim: true,\n    },\n    section: {\n      type: String,\n      trim: true,\n    },\n    rollNumber: {\n      type: String,\n      trim: true,\n    },\n    enrolledCourses: [\n      {\n        type: Schema.Types.ObjectId,\n        ref: 'Course',\n      },\n    ],\n    createdCourses: [\n      {\n        type: Schema.Types.ObjectId,\n        ref: 'Course',\n      },\n    ],\n    progress: [\n      {\n        courseId: {\n          type: Schema.Types.ObjectId,\n          ref: 'Course',\n        },\n        completedLessons: {\n          type: Number,\n          default: 0,\n        },\n        totalLessons: {\n          type: Number,\n          default: 0,\n        },\n        lastAccessed: {\n          type: Date,\n          default: Date.now,\n        },\n      },\n    ],\n  },\n  {\n    timestamps: true,\n  }\n);\n\n// Indexes for better query performance\nUserSchema.index({ role: 1 });\nUserSchema.index({ schoolId: 1, role: 1 });\n// email already has unique index from schema definition\n\nconst User: Model<IUser> =\n  mongoose.models.User || mongoose.model<IUser>('User', UserSchema);\n\nexport default User;\n"],"names":[],"mappings":";;;;AAAA;;AAwCA,MAAM,aAAa,IAAI,mHAAM,CAC3B;IACE,MAAM;QACJ,MAAM;QACN,UAAU;YAAC;YAAM;SAAwB;QACzC,MAAM;QACN,WAAW;YAAC;YAAK;SAA0C;IAC7D;IACA,OAAO;QACL,MAAM;QACN,UAAU;YAAC;YAAM;SAA0B;QAC3C,QAAQ;QACR,WAAW;QACX,MAAM;QACN,OAAO;YACL;YACA;SACD;IACH;IACA,UAAU;QACR,MAAM;QACN,UAAU;YAAC;YAAM;SAA4B;QAC7C,WAAW;YAAC;YAAG;SAAyC;QACxD,QAAQ;IACV;IACA,MAAM;QACJ,MAAM;QACN,MAAM;YAAC;YAAe;YAAa;YAAW;SAAU;QACxD,SAAS;QACT,UAAU;IACZ;IACA,UAAU;QACR,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;IACP;IACA,QAAQ;QACN,MAAM;QACN,SAAS;IACX;IACA,KAAK;QACH,MAAM;QACN,WAAW;YAAC;YAAK;SAAyC;IAC5D;IACA,OAAO;QACL,MAAM;QACN,MAAM;IACR;IACA,UAAU;QACR,MAAM;QACN,SAAS;IACX;IACA,0BAA0B;IAC1B,uBAAuB;QACrB,MAAM;QACN,MAAM;IACR;IACA,aAAa;QACX,MAAM;QACN,MAAM;YAAC;YAAW;YAAO;SAAiB;IAC5C;IACA,iBAAiB;QACf;YACE,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;YAC3B,KAAK;QACP;KACD;IACD,kBAAkB;QAChB;YACE,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;YAC3B,KAAK;QACP;KACD;IACD,0BAA0B;IAC1B,SAAS;QACP,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,OAAO;IACT;IACA,QAAQ;QACN,MAAM;QACN,KAAK;IACP;IACA,YAAY;QACV,MAAM;QACN,MAAM;IACR;IACA,aAAa;QACX,MAAM;QACN,MAAM;IACR;IACA,yCAAyC;IACzC,WAAW;QACT,MAAM;QACN,MAAM;IACR;IACA,SAAS;QACP,MAAM;QACN,MAAM;IACR;IACA,YAAY;QACV,MAAM;QACN,MAAM;IACR;IACA,iBAAiB;QACf;YACE,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;YAC3B,KAAK;QACP;KACD;IACD,gBAAgB;QACd;YACE,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;YAC3B,KAAK;QACP;KACD;IACD,UAAU;QACR;YACE,UAAU;gBACR,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;gBAC3B,KAAK;YACP;YACA,kBAAkB;gBAChB,MAAM;gBACN,SAAS;YACX;YACA,cAAc;gBACZ,MAAM;gBACN,SAAS;YACX;YACA,cAAc;gBACZ,MAAM;gBACN,SAAS,KAAK,GAAG;YACnB;QACF;KACD;AACH,GACA;IACE,YAAY;AACd;AAGF,uCAAuC;AACvC,WAAW,KAAK,CAAC;IAAE,MAAM;AAAE;AAC3B,WAAW,KAAK,CAAC;IAAE,UAAU;IAAG,MAAM;AAAE;AACxC,wDAAwD;AAExD,MAAM,OACJ,oHAAQ,CAAC,MAAM,CAAC,IAAI,IAAI,oHAAQ,CAAC,KAAK,CAAQ,QAAQ;uCAEzC"}},
    {"offset": {"line": 435, "column": 0}, "map": {"version":3,"sources":["file:///E:/projects/edu-bridge-ai-platform/lib/mongodb.ts"],"sourcesContent":["import mongoose from 'mongoose';\n\nconst MONGODB_URI = process.env.MONGODB_URI as string;\n\nif (!MONGODB_URI) {\n  throw new Error(\n    'Please define the MONGODB_URI environment variable inside .env.local'\n  );\n}\n\n/**\n * Global is used here to maintain a cached connection across hot reloads\n * in development. This prevents connections growing exponentially\n * during API Route usage.\n */\ninterface MongooseCache {\n  conn: typeof mongoose | null;\n  promise: Promise<typeof mongoose> | null;\n}\n\ndeclare global {\n  var mongoose: MongooseCache | undefined;\n}\n\nlet cached: MongooseCache = global.mongoose || { conn: null, promise: null };\n\nif (!global.mongoose) {\n  global.mongoose = cached;\n}\n\nasync function connectDB(): Promise<typeof mongoose> {\n  if (cached.conn) {\n    return cached.conn;\n  }\n\n  if (!cached.promise) {\n    const opts = {\n      bufferCommands: false,\n      serverSelectionTimeoutMS: 30000,\n      socketTimeoutMS: 75000,\n      connectTimeoutMS: 30000,\n      maxPoolSize: 10,\n      minPoolSize: 1,\n      retryWrites: true,\n      retryReads: true,\n      // Disable TLS validation to fix Node.js 22 SSL error\n      tls: true,\n      tlsAllowInvalidCertificates: true,\n      tlsAllowInvalidHostnames: true,\n    };\n\n    cached.promise = mongoose.connect(MONGODB_URI, opts).then((mongoose) => {\n      console.log('✅ MongoDB connected successfully');\n      return mongoose;\n    }).catch((err) => {\n      console.error('❌ MongoDB connection error:', err.message);\n      cached.promise = null;\n      throw err;\n    });\n  }\n\n  try {\n    cached.conn = await cached.promise;\n  } catch (e) {\n    cached.promise = null;\n    console.error('❌ MongoDB connection error:', e);\n    throw e;\n  }\n\n  return cached.conn;\n}\n\nexport default connectDB;\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,cAAc,QAAQ,GAAG,CAAC,WAAW;AAE3C,IAAI,CAAC,aAAa;IAChB,MAAM,IAAI,MACR;AAEJ;AAgBA,IAAI,SAAwB,OAAO,QAAQ,IAAI;IAAE,MAAM;IAAM,SAAS;AAAK;AAE3E,IAAI,CAAC,OAAO,QAAQ,EAAE;IACpB,OAAO,QAAQ,GAAG;AACpB;AAEA,eAAe;IACb,IAAI,OAAO,IAAI,EAAE;QACf,OAAO,OAAO,IAAI;IACpB;IAEA,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,MAAM,OAAO;YACX,gBAAgB;YAChB,0BAA0B;YAC1B,iBAAiB;YACjB,kBAAkB;YAClB,aAAa;YACb,aAAa;YACb,aAAa;YACb,YAAY;YACZ,qDAAqD;YACrD,KAAK;YACL,6BAA6B;YAC7B,0BAA0B;QAC5B;QAEA,OAAO,OAAO,GAAG,oHAAQ,CAAC,OAAO,CAAC,aAAa,MAAM,IAAI,CAAC,CAAC;YACzD,QAAQ,GAAG,CAAC;YACZ,OAAO;QACT,GAAG,KAAK,CAAC,CAAC;YACR,QAAQ,KAAK,CAAC,+BAA+B,IAAI,OAAO;YACxD,OAAO,OAAO,GAAG;YACjB,MAAM;QACR;IACF;IAEA,IAAI;QACF,OAAO,IAAI,GAAG,MAAM,OAAO,OAAO;IACpC,EAAE,OAAO,GAAG;QACV,OAAO,OAAO,GAAG;QACjB,QAAQ,KAAK,CAAC,+BAA+B;QAC7C,MAAM;IACR;IAEA,OAAO,OAAO,IAAI;AACpB;uCAEe"}},
    {"offset": {"line": 494, "column": 0}, "map": {"version":3,"sources":["file:///E:/projects/edu-bridge-ai-platform/app/api/admin/schools/route.ts"],"sourcesContent":["import { getSession } from '@/lib/auth'\nimport School from '@/lib/models/School'\nimport User from '@/lib/models/User'\nimport connectDB from '@/lib/mongodb'\nimport { NextRequest, NextResponse } from 'next/server'\n\n// GET - Fetch all schools or a specific school\nexport async function GET(request: NextRequest) {\n  try {\n    const session = await getSession()\n    if (!session || session.role !== 'admin') {\n      return NextResponse.json(\n        { success: false, error: 'Unauthorized - Admin access required' },\n        { status: 401 }\n      )\n    }\n\n    await connectDB()\n\n    const { searchParams } = new URL(request.url)\n    const schoolId = searchParams.get('id')\n    const code = searchParams.get('code')\n\n    if (schoolId) {\n      const school = await School.findById(schoolId)\n      if (!school) {\n        return NextResponse.json(\n          { success: false, error: 'School not found' },\n          { status: 404 }\n        )\n      }\n      \n      // Get school statistics\n      const totalStudents = await User.countDocuments({ schoolId: school._id, role: 'student' })\n      const totalTeachers = await User.countDocuments({ schoolId: school._id, role: 'teacher' })\n      \n      school.stats = {\n        totalStudents,\n        totalTeachers,\n        totalCourses: school.stats?.totalCourses || 0\n      }\n      await school.save()\n\n      return NextResponse.json({ success: true, school })\n    }\n\n    if (code) {\n      const school = await School.findOne({ code: code.toUpperCase() })\n      if (!school) {\n        return NextResponse.json(\n          { success: false, error: 'School not found' },\n          { status: 404 }\n        )\n      }\n      return NextResponse.json({ success: true, school })\n    }\n\n    // Fetch all schools with stats\n    const schools = await School.find().sort({ createdAt: -1 })\n    \n    // Update stats for all schools\n    for (const school of schools) {\n      const totalStudents = await User.countDocuments({ schoolId: school._id, role: 'student' })\n      const totalTeachers = await User.countDocuments({ schoolId: school._id, role: 'teacher' })\n      \n      school.stats = {\n        totalStudents,\n        totalTeachers,\n        totalCourses: school.stats?.totalCourses || 0\n      }\n      await school.save()\n    }\n\n    return NextResponse.json({ success: true, schools })\n  } catch (error: any) {\n    console.error('Error fetching schools:', error)\n    return NextResponse.json(\n      { success: false, error: 'Failed to fetch schools', message: error.message },\n      { status: 500 }\n    )\n  }\n}\n\n// POST - Create a new school\nexport async function POST(request: NextRequest) {\n  try {\n    const session = await getSession()\n    if (!session || session.role !== 'admin') {\n      return NextResponse.json(\n        { success: false, error: 'Unauthorized - Admin access required' },\n        { status: 401 }\n      )\n    }\n\n    await connectDB()\n\n    const data = await request.json()\n    const {\n      name,\n      code,\n      email,\n      phone,\n      address,\n      principal,\n      website,\n      established,\n      type,\n      board,\n      subscription\n    } = data\n\n    // Validate required fields\n    if (!name || !code || !email || !address?.city || !address?.state || !address?.country) {\n      return NextResponse.json(\n        { success: false, error: 'Missing required fields' },\n        { status: 400 }\n      )\n    }\n\n    // Check if school code already exists\n    const existingCode = await School.findOne({ code: code.toUpperCase() })\n    if (existingCode) {\n      return NextResponse.json(\n        { success: false, error: 'School code already exists' },\n        { status: 400 }\n      )\n    }\n\n    // Check if email already exists\n    const existingEmail = await School.findOne({ email: email.toLowerCase() })\n    if (existingEmail) {\n      return NextResponse.json(\n        { success: false, error: 'School email already exists' },\n        { status: 400 }\n      )\n    }\n\n    const school = await School.create({\n      name,\n      code: code.toUpperCase(),\n      email: email.toLowerCase(),\n      phone,\n      address,\n      principal,\n      website,\n      established,\n      type: type || 'secondary',\n      board,\n      isActive: true,\n      subscription: subscription || {\n        plan: 'free',\n        startDate: new Date(),\n        maxStudents: 100,\n        maxTeachers: 10\n      },\n      stats: {\n        totalStudents: 0,\n        totalTeachers: 0,\n        totalCourses: 0\n      }\n    })\n\n    return NextResponse.json(\n      { success: true, school, message: 'School registered successfully' },\n      { status: 201 }\n    )\n  } catch (error: any) {\n    console.error('Error creating school:', error)\n    return NextResponse.json(\n      { success: false, error: 'Failed to create school', message: error.message },\n      { status: 500 }\n    )\n  }\n}\n\n// PUT - Update a school\nexport async function PUT(request: NextRequest) {\n  try {\n    const session = await getSession()\n    if (!session || session.role !== 'admin') {\n      return NextResponse.json(\n        { success: false, error: 'Unauthorized - Admin access required' },\n        { status: 401 }\n      )\n    }\n\n    await connectDB()\n\n    const data = await request.json()\n    const { schoolId, ...updateData } = data\n\n    if (!schoolId) {\n      return NextResponse.json(\n        { success: false, error: 'School ID is required' },\n        { status: 400 }\n      )\n    }\n\n    const school = await School.findByIdAndUpdate(\n      schoolId,\n      { $set: updateData },\n      { new: true, runValidators: true }\n    )\n\n    if (!school) {\n      return NextResponse.json(\n        { success: false, error: 'School not found' },\n        { status: 404 }\n      )\n    }\n\n    return NextResponse.json(\n      { success: true, school, message: 'School updated successfully' }\n    )\n  } catch (error: any) {\n    console.error('Error updating school:', error)\n    return NextResponse.json(\n      { success: false, error: 'Failed to update school', message: error.message },\n      { status: 500 }\n    )\n  }\n}\n\n// DELETE - Delete a school\nexport async function DELETE(request: NextRequest) {\n  try {\n    const session = await getSession()\n    if (!session || session.role !== 'admin') {\n      return NextResponse.json(\n        { success: false, error: 'Unauthorized - Admin access required' },\n        { status: 401 }\n      )\n    }\n\n    await connectDB()\n\n    const { searchParams } = new URL(request.url)\n    const schoolId = searchParams.get('id')\n\n    if (!schoolId) {\n      return NextResponse.json(\n        { success: false, error: 'School ID is required' },\n        { status: 400 }\n      )\n    }\n\n    // Check if school has users\n    const usersCount = await User.countDocuments({ schoolId })\n    if (usersCount > 0) {\n      return NextResponse.json(\n        { success: false, error: `Cannot delete school with ${usersCount} active users` },\n        { status: 400 }\n      )\n    }\n\n    const school = await School.findByIdAndDelete(schoolId)\n\n    if (!school) {\n      return NextResponse.json(\n        { success: false, error: 'School not found' },\n        { status: 404 }\n      )\n    }\n\n    return NextResponse.json(\n      { success: true, message: 'School deleted successfully' }\n    )\n  } catch (error: any) {\n    console.error('Error deleting school:', error)\n    return NextResponse.json(\n      { success: false, error: 'Failed to delete school', message: error.message },\n      { status: 500 }\n    )\n  }\n}\n"],"names":[],"mappings":"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"}}]
}